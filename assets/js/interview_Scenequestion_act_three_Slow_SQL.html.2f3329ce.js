"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9399],{6262:(e,t)=>{t.A=(e,t)=>{const l=e.__vccOpts||e;for(const[e,o]of t)l[e]=o;return l}},3952:(e,t,l)=>{l.r(t),l.d(t,{comp:()=>r,data:()=>s});var o=l(641);const p=[(0,o.Fv)('<h1 id="三、提问-如何定位慢sql" tabindex="-1"><a class="header-anchor" href="#三、提问-如何定位慢sql"><span>三、提问：如何定位慢sql?</span></a></h1><p>慢查询定位总结</p><p>1、介绍一下当时产生问题的场景（我们当时的一个接口测试的时候非常的慢，压测的结果大概5秒钟/做数据计算查询数据很慢导致任计算任务执行超时）</p><p>2、我们系统中当时采用了运维工具（ Skywalking /ps数据库自带监控系统查看sql执行时间），可以监测出哪个接口，最终因为是sql的问题</p><p>3、在mysql/postgresql中开启了慢日志查询，我们设置的值就是2秒，一旦sql执行超过2秒就会记录到日志中（调试阶段）</p><p>4、上线前的压力测试，观察相关的指标 tps / qps / rt / io / cpu</p><blockquote><p>sql问题排查思路：</p><p>如果已知是sql问题，直接找dba查询日志，查看执行计划或者sql执行日志，如果sql没有到数据库执行，那么需要找网络组进行抓包处理，看某个一时间段网络情况，如果网络也没有问题，那么就只能查看代码或者配置导致连接泄露。</p></blockquote><p>发现:</p><ol><li>系统监控:基于 arthars 运维工具、promethues 、skywalking mysql</li><li>慢日志: 会影响一部分系统性能</li></ol><p>慢 SQL 处理 由宏观到微观</p><ol><li>检查 系统相关性能 top / mpstat / pidstat / vmstat 检查 CPU / IO 占比，由进程到线程</li><li>检查 MySQL 性能情况，show processlist 查看相关进程 | 基于 MySQL Workbench 进行分析</li><li>检查 SQL 语句索引执行情况，explain 关注 type key extra rows 等关键字</li><li>检查是否由于 SQL 编写不当造成的不走索引，例如 使用函数、not in、%like%、or 等</li><li>其他情况: 深分页、数据字段查询过多、Join 连表不当、业务大事物问题、死锁、索引建立过多</li><li>对于热点数据进行前置，降低 MySQL 的压力 redis、mongodb、memory</li><li>更改 MySQL 配置 ， 处理线程设置一般是 cpu * 核心数 的 2 倍，日志大小 bin-log</li><li>升级机器性能 or 加机器</li><li>分表策略，分库策略</li><li>数据归档</li></ol>',11)],i={},r=(0,l(6262).A)(i,[["render",function(e,t){return(0,o.uX)(),(0,o.CE)("div",null,p)}]]),s=JSON.parse('{"path":"/interview/Scenequestion/act_three_Slow_SQL.html","title":"三、提问：如何定位慢sql?","lang":"zh-CN","frontmatter":{"icon":"file","order":3,"author":"bugcode","date":"2020-01-01T00:00:00.000Z","category":["面试"],"tag":["面试","场景"],"sticky":false,"star":true,"footer":"分布式","copyright":"bugcode","description":"三、提问：如何定位慢sql? 慢查询定位总结 1、介绍一下当时产生问题的场景（我们当时的一个接口测试的时候非常的慢，压测的结果大概5秒钟/做数据计算查询数据很慢导致任计算任务执行超时） 2、我们系统中当时采用了运维工具（ Skywalking /ps数据库自带监控系统查看sql执行时间），可以监测出哪个接口，最终因为是sql的问题 3、在mysql/p...","head":[["meta",{"property":"og:url","content":"https://www.bugcode.online/interview/Scenequestion/act_three_Slow_SQL.html"}],["meta",{"property":"og:site_name","content":"bugcode 的架构之路"}],["meta",{"property":"og:title","content":"三、提问：如何定位慢sql?"}],["meta",{"property":"og:description","content":"三、提问：如何定位慢sql? 慢查询定位总结 1、介绍一下当时产生问题的场景（我们当时的一个接口测试的时候非常的慢，压测的结果大概5秒钟/做数据计算查询数据很慢导致任计算任务执行超时） 2、我们系统中当时采用了运维工具（ Skywalking /ps数据库自带监控系统查看sql执行时间），可以监测出哪个接口，最终因为是sql的问题 3、在mysql/p..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-23T07:40:31.000Z"}],["meta",{"property":"article:author","content":"bugcode"}],["meta",{"property":"article:tag","content":"面试"}],["meta",{"property":"article:tag","content":"场景"}],["meta",{"property":"article:published_time","content":"2020-01-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-23T07:40:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"三、提问：如何定位慢sql?\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2020-01-01T00:00:00.000Z\\",\\"dateModified\\":\\"2024-10-23T07:40:31.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"bugcode\\"}]}"]]},"headers":[],"git":{"createdTime":1729669231000,"updatedTime":1729669231000,"contributors":[{"name":"不爱打代码的程序员","email":"2284609302@qq.com","commits":1}]},"readingTime":{"minutes":2.31,"words":692},"filePathRelative":"interview/Scenequestion/act_three_Slow_SQL.md","localizedDate":"2020年1月1日","excerpt":"\\n<p>慢查询定位总结</p>\\n<p>1、介绍一下当时产生问题的场景（我们当时的一个接口测试的时候非常的慢，压测的结果大概5秒钟/做数据计算查询数据很慢导致任计算任务执行超时）</p>\\n<p>2、我们系统中当时采用了运维工具（ Skywalking /ps数据库自带监控系统查看sql执行时间），可以监测出哪个接口，最终因为是sql的问题</p>\\n<p>3、在mysql/postgresql中开启了慢日志查询，我们设置的值就是2秒，一旦sql执行超过2秒就会记录到日志中（调试阶段）</p>\\n<p>4、上线前的压力测试，观察相关的指标 tps / qps / rt / io / cpu</p>\\n<blockquote>\\n<p>sql问题排查思路：</p>\\n<p>如果已知是sql问题，直接找dba查询日志，查看执行计划或者sql执行日志，如果sql没有到数据库执行，那么需要找网络组进行抓包处理，看某个一时间段网络情况，如果网络也没有问题，那么就只能查看代码或者配置导致连接泄露。</p>\\n</blockquote>","autoDesc":true}')}}]);