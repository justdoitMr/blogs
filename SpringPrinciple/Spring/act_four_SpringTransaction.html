<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.47" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.bugcode.online/SpringPrinciple/Spring/act_four_SpringTransaction.html"><meta property="og:site_name" content="bugcode 的架构之路"><meta property="og:title" content="4、Spring Transaction"><meta property="og:description" content="4、Spring Transaction 4.1、JdbcTemplate 4.1.1、简介 Spring 框架对 JDBC 进行封装，使用 JdbcTemplate 方便实现对数据库操作 4.1.2、准备工作 ①加入依赖 ②创建jdbc.properties ③配置Spring的配置文件 4.1.3、测试 ①在测试类装配 JdbcTemplate ②..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-10T12:48:31.000Z"><meta property="article:author" content="Mr.bugcode"><meta property="article:tag" content="Spring"><meta property="article:tag" content="jAVA"><meta property="article:tag" content="Transaction"><meta property="article:published_time" content="2024-06-04T00:00:00.000Z"><meta property="article:modified_time" content="2024-06-10T12:48:31.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"4、Spring Transaction","image":[""],"datePublished":"2024-06-04T00:00:00.000Z","dateModified":"2024-06-10T12:48:31.000Z","author":[{"@type":"Person","name":"Mr.bugcode","url":"intro.md"}]}</script><meta name="robots" content="all"><meta name="author" content="bugcode"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="Java, Java基础, 并发编程, JVM, 虚拟机, 数据库, MySQL, Spring, Redis, MyBatis, SpringBoot, IDEA, 求职面试, 面渣逆袭, 学习路线"><meta name="apple-mobile-web-app-capable" content="yes"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4570931_i3acfllzyt.css"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><title>4、Spring Transaction | bugcode 的架构之路</title><meta name="description" content="4、Spring Transaction 4.1、JdbcTemplate 4.1.1、简介 Spring 框架对 JDBC 进行封装，使用 JdbcTemplate 方便实现对数据库操作 4.1.2、准备工作 ①加入依赖 ②创建jdbc.properties ③配置Spring的配置文件 4.1.3、测试 ①在测试类装配 JdbcTemplate ②...">
    <link rel="stylesheet" href="/assets/css/styles.6b04e72b.css">
    <link rel="preload" href="/assets/js/runtime~app.6307d164.js" as="script"><link rel="preload" href="/assets/css/styles.6b04e72b.css" as="style"><link rel="preload" href="/assets/js/9547.c8ff98a9.js" as="script"><link rel="preload" href="/assets/js/app.da879f88.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://vscodepic.oss-cn-beijing.aliyuncs.com/blog/log.jpg" alt><!----><span class="vp-site-name hide-in-pad">bugcode 的架构之路</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/introduction/" aria-label="导读"><!--[--><span class="font-icon icon iconfont icon-book" style=""></span><!--]-->导读<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="算法"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>算法<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/algor/" aria-label="算法专题"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->算法专题<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/dataStructure/" aria-label="数据结构专题"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->数据结构专题<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="设计模式"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>设计模式<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/designPrinciple/" aria-label="设计原则"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->设计原则<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/creational/" aria-label="创建型"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->创建型<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/Behavior/" aria-label="行为型"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->行为型<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/structural/" aria-label="结构型"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->结构型<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="源码"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>源码<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/frameDesignAndSourceCode/springSourceCode/" aria-label="Spring源码实现"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Spring源码实现<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/frameDesignAndSourceCode/mybatisSourceCode/" aria-label="Mybatis框架实现"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Mybatis框架实现<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/engineeringArchitectureDesign/" aria-label="架构专题"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->架构专题<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="精选博文"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>精选博文<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">业务知识</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/excellentBook/business/" aria-label="金融业务"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->金融业务<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">项目经验</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/excellentBook/project/" aria-label="K8S部署项目"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->K8S部署项目<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/excellentBook/" aria-label="通用数据设计"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->通用数据设计<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/excellentBook/scence.html" aria-label="业务场景设计"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->业务场景设计<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/home.html" aria-label="基础归档"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->基础归档<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="面试篇"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->面试篇<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/KnowledgePlanet/" aria-label="知识星球"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->知识星球<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/KnowledgePlanet/" aria-label="B站"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->B站<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/about/" aria-label="关于我"><!--[--><span class="font-icon icon iconfont icon-book" style=""></span><!--]-->关于我<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/justdoitMr/blogs/" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">一、导读</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">二、java核心</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">三、Spring篇</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">1、Spring</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/SpringPrinciple/Spring/act_one_SpringAopPrinciple.html" aria-label="1、Spring AOP原理"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->1、Spring AOP原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/SpringPrinciple/Spring/act_two_SpringAnnotation.html" aria-label="2、Spring 注解"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->2、Spring 注解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/SpringPrinciple/Spring/act_three_SpringAopBasic.html" aria-label="3、Spring AOP"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->3、Spring AOP<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/SpringPrinciple/Spring/act_four_SpringTransaction.html" aria-label="4、Spring Transaction"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->4、Spring Transaction<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2、SpringMvc</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">3、SpringBoot</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">四、大数据篇</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、云原生</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、前端篇</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>4、Spring Transaction</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="intro.md" target="_blank" rel="noopener noreferrer">Mr.bugcode</a></span><span property="author" content="Mr.bugcode"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-04T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 13 分钟</span><meta property="timeRequired" content="PT13M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7 clickable" role="navigation">Spring -</span><!--]--><meta property="articleSection" content="Spring -"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color1 clickable" role="navigation">Spring</span><span class="page-tag-item color6 clickable" role="navigation">jAVA</span><span class="page-tag-item color8 clickable" role="navigation">Transaction</span><!--]--><meta property="keywords" content="Spring,jAVA,Transaction"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-1、jdbctemplate">4.1、JdbcTemplate</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-1、简介">4.1.1、简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-2、准备工作">4.1.2、准备工作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1加入依赖">①加入依赖</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2创建jdbc-properties">②创建jdbc.properties</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3配置spring的配置文件">③配置Spring的配置文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-3、测试">4.1.3、测试</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1在测试类装配-jdbctemplate">①在测试类装配 JdbcTemplate</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2测试增删改功能">②测试增删改功能</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3查询一条数据为实体类对象">③查询一条数据为实体类对象</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4查询多条数据为一个list集合">④查询多条数据为一个list集合</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5查询单行单列的值">⑤查询单行单列的值</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-2、声明式事务概念">4.2、声明式事务概念</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-1、编程式事务">4.2.1、编程式事务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-2、声明式事务">4.2.2、声明式事务</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-3、基于注解的声明式事务">4.3、基于注解的声明式事务</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-1、准备工作">4.3.1、准备工作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1加入依赖-1">①加入依赖</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2创建jdbc-properties-1">②创建jdbc.properties</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3配置spring的配置文件-1">③配置Spring的配置文件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4创建表">④创建表</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5创建组件">⑤创建组件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-2、测试无事务情况">4.3.2、测试无事务情况</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1创建测试类">①创建测试类</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2模拟场景">②模拟场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3观察结果">③观察结果</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-3、加入事务">4.3.3、加入事务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1添加事务配置">①添加事务配置</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2添加事务注解">②添加事务注解</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3观察结果-1">③观察结果</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-4、-transactional注解标识的位置">4.3.4、@Transactional注解标识的位置</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-5、事务属性-只读">4.3.5、事务属性：只读</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1介绍">①介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2使用方式">②使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3注意">③注意</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-6、事务属性-超时">4.3.6、事务属性：超时</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1介绍-1">①介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2使用方式-1">②使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3观察结果-2">③观察结果</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-7、事务属性-回滚策略">4.3.7、事务属性：回滚策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1介绍-2">①介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2使用方式-2">②使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3观察结果-3">③观察结果</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-8、事务属性-事务隔离级别">4.3.8、事务属性：事务隔离级别</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1介绍-3">①介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2使用方式-3">②使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-9、事务属性-事务传播行为">4.3.9、事务属性：事务传播行为</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1介绍-4">①介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2测试">②测试</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3观察结果-4">③观察结果</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-4、基于xml的声明式事务">4.4、基于XML的声明式事务</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-1、场景模拟">4.3.1、场景模拟</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3-2、修改spring配置文件">4.3.2、修改Spring配置文件</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="_4、spring-transaction" tabindex="-1"><a class="header-anchor" href="#_4、spring-transaction"><span>4、Spring Transaction</span></a></h1><h2 id="_4-1、jdbctemplate" tabindex="-1"><a class="header-anchor" href="#_4-1、jdbctemplate"><span><strong>4.1、JdbcTemplate</strong></span></a></h2><h3 id="_4-1-1、简介" tabindex="-1"><a class="header-anchor" href="#_4-1-1、简介"><span><strong>4.1.1、简介</strong></span></a></h3><p>Spring 框架对 JDBC 进行封装，使用 JdbcTemplate 方便实现对数据库操作</p><h3 id="_4-1-2、准备工作" tabindex="-1"><a class="header-anchor" href="#_4-1-2、准备工作"><span><strong>4.1.2、准备工作</strong></span></a></h3><h3 id="_1加入依赖" tabindex="-1"><a class="header-anchor" href="#_1加入依赖"><span><strong>①加入依赖</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;dependencies&gt;</span></span>
<span class="line"><span>     &lt;!-- 基于Maven依赖传递性，导入spring-context依赖即可导入当前所需所有jar包 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- Spring 持久化层支持jar包 --&gt;</span></span>
<span class="line"><span>     &lt;!-- Spring 在执行持久化层操作、与持久化层技术进行整合过程中，需要使用orm、jdbc、tx三个jar包 --&gt;</span></span>
<span class="line"><span>     &lt;!-- 导入 orm 包就可以通过 Maven 的依赖传递性把其他两个也导入 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- Spring 测试相关 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- junit测试 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;junit&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;junit&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;4.12&lt;/version&gt;</span></span>
<span class="line"><span>         &lt;scope&gt;test&lt;/scope&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- MySQL驱动 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;mysql&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;8.0.16&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- 数据源 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;druid&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;1.0.31&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span> &lt;/dependencies&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2创建jdbc-properties" tabindex="-1"><a class="header-anchor" href="#_2创建jdbc-properties"><span><strong>②创建jdbc.properties</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> jdbc.user=root</span></span>
<span class="line"><span> jdbc.password=atguigu</span></span>
<span class="line"><span> jdbc.url=jdbc:mysql://localhost:3306/ssm</span></span>
<span class="line"><span> jdbc.driver=com.mysql.cj.jdbc.Driver</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3配置spring的配置文件" tabindex="-1"><a class="header-anchor" href="#_3配置spring的配置文件"><span><strong>③配置Spring的配置文件</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;!-- 导入外部属性文件 --&gt;</span></span>
<span class="line"><span> &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot; /&gt;</span></span>
<span class="line"><span> &lt;!-- 配置数据源 --&gt;</span></span>
<span class="line"><span> &lt;bean id=&quot;druidDataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;url&quot; value=&quot;${atguigu.url}&quot;/&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;driverClassName&quot; value=&quot;${atguigu.driver}&quot;/&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;username&quot; value=&quot;${atguigu.username}&quot;/&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;password&quot; value=&quot;${atguigu.password}&quot;/&gt;</span></span>
<span class="line"><span> &lt;/bean&gt;</span></span>
<span class="line"><span> &lt;!-- 配置 JdbcTemplate --&gt;</span></span>
<span class="line"><span> &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span></span>
<span class="line"><span>     &lt;!-- 装配数据源 --&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;dataSource&quot; ref=&quot;druidDataSource&quot;/&gt;</span></span>
<span class="line"><span> &lt;/bean&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-3、测试" tabindex="-1"><a class="header-anchor" href="#_4-1-3、测试"><span><strong>4.1.3、测试</strong></span></a></h3><h3 id="_1在测试类装配-jdbctemplate" tabindex="-1"><a class="header-anchor" href="#_1在测试类装配-jdbctemplate"><span><strong>①在测试类装配 JdbcTemplate</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @RunWith(SpringJUnit4ClassRunner.class)</span></span>
<span class="line"><span> @ContextConfiguration(&quot;classpath:spring-jdbc.xml&quot;)</span></span>
<span class="line"><span> public class JDBCTemplateTest {</span></span>
<span class="line"><span>     @Autowired</span></span>
<span class="line"><span>     private JdbcTemplate jdbcTemplate;</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2测试增删改功能" tabindex="-1"><a class="header-anchor" href="#_2测试增删改功能"><span><strong>②测试增删改功能</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Test</span></span>
<span class="line"><span> //测试增删改功能</span></span>
<span class="line"><span> public void testUpdate(){</span></span>
<span class="line"><span>     String sql = &quot;insert into t_emp values(null,?,?,?)&quot;;</span></span>
<span class="line"><span>     int result = jdbcTemplate.update(sql, &quot;张三&quot;, 23, &quot;男&quot;);</span></span>
<span class="line"><span>     System.out.println(result);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3查询一条数据为实体类对象" tabindex="-1"><a class="header-anchor" href="#_3查询一条数据为实体类对象"><span><strong>③查询一条数据为实体类对象</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Test</span></span>
<span class="line"><span> //查询一条数据为一个实体类对象</span></span>
<span class="line"><span> public void testSelectEmpById(){</span></span>
<span class="line"><span>     String sql = &quot;select * from t_emp where id = ?&quot;;</span></span>
<span class="line"><span>     Emp emp = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;&gt;(Emp.class), 1);</span></span>
<span class="line"><span>     System.out.println(emp);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4查询多条数据为一个list集合" tabindex="-1"><a class="header-anchor" href="#_4查询多条数据为一个list集合"><span><strong>④查询多条数据为一个list集合</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Test</span></span>
<span class="line"><span> //查询多条数据为一个list集合</span></span>
<span class="line"><span> public void testSelectList(){</span></span>
<span class="line"><span>     String sql = &quot;select * from t_emp&quot;;</span></span>
<span class="line"><span>     List&lt;Emp&gt; list = jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt;(Emp.class));</span></span>
<span class="line"><span>     list.forEach(emp -&gt; System.out.println(emp));</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5查询单行单列的值" tabindex="-1"><a class="header-anchor" href="#_5查询单行单列的值"><span><strong>⑤查询单行单列的值</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Test</span></span>
<span class="line"><span> //查询单行单列的值</span></span>
<span class="line"><span> public void selectCount(){</span></span>
<span class="line"><span>     String sql = &quot;select count(id) from t_emp&quot;;</span></span>
<span class="line"><span>     Integer count = jdbcTemplate.queryForObject(sql, Integer.class);</span></span>
<span class="line"><span>     System.out.println(count);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-2、声明式事务概念" tabindex="-1"><a class="header-anchor" href="#_4-2、声明式事务概念"><span><strong>4.2、声明式事务概念</strong></span></a></h2><h3 id="_4-2-1、编程式事务" tabindex="-1"><a class="header-anchor" href="#_4-2-1、编程式事务"><span><strong>4.2.1、编程式事务</strong></span></a></h3><p>事务功能的相关操作全部通过自己编写代码来实现：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> Connection conn = ...;</span></span>
<span class="line"><span> try {</span></span>
<span class="line"><span>     // 开启事务：关闭事务的自动提交</span></span>
<span class="line"><span>     conn.setAutoCommit(false);</span></span>
<span class="line"><span>     // 核心操作</span></span>
<span class="line"><span>     // 提交事务</span></span>
<span class="line"><span>     conn.commit();</span></span>
<span class="line"><span> }catch(Exception e){</span></span>
<span class="line"><span>     // 回滚事务</span></span>
<span class="line"><span>     conn.rollBack();</span></span>
<span class="line"><span> }finally{</span></span>
<span class="line"><span>     // 释放数据库连接</span></span>
<span class="line"><span>     conn.close();</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编程式的实现方式存在缺陷：</p><ul><li>细节没有被屏蔽：具体操作过程中，所有细节都需要程序员自己来完成，比较繁琐。</li><li>代码复用性不高：如果没有有效抽取出来，每次实现功能都需要自己编写代码，代码就没有得到复用。</li></ul><h3 id="_4-2-2、声明式事务" tabindex="-1"><a class="header-anchor" href="#_4-2-2、声明式事务"><span><strong>4.2.2、声明式事务</strong></span></a></h3><p>既然事务控制的代码有规律可循，代码的结构基本是确定的，所以框架就可以将固定模式的代码抽取出来，进行相关的封装。</p><p>封装起来后，我们只需要在配置文件中进行简单的配置即可完成操作。</p><ul><li>好处1：提高开发效率</li><li>好处2：消除了冗余的代码</li><li>好处3：框架会综合考虑相关领域中在实际开发环境下有可能遇到的各种问题，进行了健壮性、性</li></ul><p>能等各个方面的优化</p><p>所以，我们可以总结下面两个概念：</p><ul><li><strong>编程式</strong>：<strong>自己写代码</strong>实现功能</li><li><strong>声明式</strong>：通过<strong>配置</strong>让<strong>框架</strong>实现功能</li></ul><h2 id="_4-3、基于注解的声明式事务" tabindex="-1"><a class="header-anchor" href="#_4-3、基于注解的声明式事务"><span><strong>4.3、基于注解的声明式事务</strong></span></a></h2><h3 id="_4-3-1、准备工作" tabindex="-1"><a class="header-anchor" href="#_4-3-1、准备工作"><span><strong>4.3.1、准备工作</strong></span></a></h3><h3 id="_1加入依赖-1" tabindex="-1"><a class="header-anchor" href="#_1加入依赖-1"><span><strong>①加入依赖</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;dependencies&gt;</span></span>
<span class="line"><span>     &lt;!-- 基于Maven依赖传递性，导入spring-context依赖即可导入当前所需所有jar包 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- Spring 持久化层支持jar包 --&gt;</span></span>
<span class="line"><span>     &lt;!-- Spring 在执行持久化层操作、与持久化层技术进行整合过程中，需要使用orm、jdbc、tx三个jar包 --&gt;</span></span>
<span class="line"><span>     &lt;!-- 导入 orm 包就可以通过 Maven 的依赖传递性把其他两个也导入 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- Spring 测试相关 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- junit测试 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;junit&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;junit&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;4.12&lt;/version&gt;</span></span>
<span class="line"><span>         &lt;scope&gt;test&lt;/scope&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- MySQL驱动 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;mysql&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;8.0.16&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span>     &lt;!-- 数据源 --&gt;</span></span>
<span class="line"><span>     &lt;dependency&gt;</span></span>
<span class="line"><span>         &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span>
<span class="line"><span>         &lt;artifactId&gt;druid&lt;/artifactId&gt;</span></span>
<span class="line"><span>         &lt;version&gt;1.0.31&lt;/version&gt;</span></span>
<span class="line"><span>     &lt;/dependency&gt;</span></span>
<span class="line"><span> &lt;/dependencies&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2创建jdbc-properties-1" tabindex="-1"><a class="header-anchor" href="#_2创建jdbc-properties-1"><span><strong>②创建jdbc.properties</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> jdbc.user=root</span></span>
<span class="line"><span> jdbc.password=atguigu</span></span>
<span class="line"><span> jdbc.url=jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC</span></span>
<span class="line"><span> jdbc.driver=com.mysql.cj.jdbc.Driver</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3配置spring的配置文件-1" tabindex="-1"><a class="header-anchor" href="#_3配置spring的配置文件-1"><span><strong>③配置Spring的配置文件</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;!--扫描组件--&gt;</span></span>
<span class="line"><span> &lt;context:component-scan base-package=&quot;com.atguigu.spring.tx.annotation&quot;&gt;</span></span>
<span class="line"><span> &lt;/context:component-scan&gt;</span></span>
<span class="line"><span> &lt;!-- 导入外部属性文件 --&gt;</span></span>
<span class="line"><span> &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot; /&gt;</span></span>
<span class="line"><span> &lt;!-- 配置数据源 --&gt;</span></span>
<span class="line"><span> &lt;bean id=&quot;druidDataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;/&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;</span></span>
<span class="line"><span> &lt;/bean&gt;</span></span>
<span class="line"><span> &lt;!-- 配置 JdbcTemplate --&gt;</span></span>
<span class="line"><span> &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span></span>
<span class="line"><span>     &lt;!-- 装配数据源 --&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;dataSource&quot; ref=&quot;druidDataSource&quot;/&gt;</span></span>
<span class="line"><span> &lt;/bean&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4创建表" tabindex="-1"><a class="header-anchor" href="#_4创建表"><span><strong>④创建表</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> CREATE TABLE `t_book` (</span></span>
<span class="line"><span>     `book_id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#39;主键&#39;,</span></span>
<span class="line"><span>     `book_name` varchar(20) DEFAULT NULL COMMENT &#39;图书名称&#39;,</span></span>
<span class="line"><span>     `price` int(11) DEFAULT NULL COMMENT &#39;价格&#39;,</span></span>
<span class="line"><span>     `stock` int(10) unsigned DEFAULT NULL COMMENT &#39;库存（无符号）&#39;,</span></span>
<span class="line"><span>     PRIMARY KEY (`book_id`)</span></span>
<span class="line"><span> ) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;</span></span>
<span class="line"><span> insert into `t_book`(`book_id`,`book_name`,`price`,`stock`) values (1,&#39;斗破苍穹&#39;,80,100),(2,&#39;斗罗大陆&#39;,50,100);</span></span>
<span class="line"><span> CREATE TABLE `t_user` (</span></span>
<span class="line"><span>     `user_id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#39;主键&#39;,</span></span>
<span class="line"><span>     `username` varchar(20) DEFAULT NULL COMMENT &#39;用户名&#39;,</span></span>
<span class="line"><span>     `balance` int(10) unsigned DEFAULT NULL COMMENT &#39;余额（无符号）&#39;,</span></span>
<span class="line"><span>     PRIMARY KEY (`user_id`)</span></span>
<span class="line"><span> ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</span></span>
<span class="line"><span> insert into `t_user`(`user_id`,`username`,`balance`) values (1,&#39;admin&#39;,50);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5创建组件" tabindex="-1"><a class="header-anchor" href="#_5创建组件"><span><strong>⑤创建组件</strong></span></a></h3><p>创建BookController：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Controller</span></span>
<span class="line"><span> public class BookController {</span></span>
<span class="line"><span>     @Autowired</span></span>
<span class="line"><span>     private BookService bookService;</span></span>
<span class="line"><span>     public void buyBook(Integer bookId, Integer userId){</span></span>
<span class="line"><span>         bookService.buyBook(bookId, userId);</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建接口BookService：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> public interface BookService {</span></span>
<span class="line"><span>   void buyBook(Integer bookId, Integer userId);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建实现类BookServiceImpl：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Service</span></span>
<span class="line"><span> public class BookServiceImpl implements BookService {</span></span>
<span class="line"><span>     @Autowired</span></span>
<span class="line"><span>     private BookDao bookDao;</span></span>
<span class="line"><span>     @Override</span></span>
<span class="line"><span>     public void buyBook(Integer bookId, Integer userId) {</span></span>
<span class="line"><span>         //查询图书的价格</span></span>
<span class="line"><span>         Integer price = bookDao.getPriceByBookId(bookId);</span></span>
<span class="line"><span>         //更新图书的库存</span></span>
<span class="line"><span>         bookDao.updateStock(bookId);</span></span>
<span class="line"><span>         //更新用户的余额</span></span>
<span class="line"><span>         bookDao.updateBalance(userId, price);</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建接口BookDao：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> public interface BookDao {</span></span>
<span class="line"><span>     Integer getPriceByBookId(Integer bookId);</span></span>
<span class="line"><span>     void updateStock(Integer bookId);</span></span>
<span class="line"><span>     void updateBalance(Integer userId, Integer price);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建实现类BookDaoImpl：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Repository</span></span>
<span class="line"><span> public class BookDaoImpl implements BookDao {</span></span>
<span class="line"><span>     @Autowired</span></span>
<span class="line"><span>     private JdbcTemplate jdbcTemplate;</span></span>
<span class="line"><span>     @Override</span></span>
<span class="line"><span>     public Integer getPriceByBookId(Integer bookId) {</span></span>
<span class="line"><span>         String sql = &quot;select price from t_book where book_id = ?&quot;;</span></span>
<span class="line"><span>         return jdbcTemplate.queryForObject(sql, Integer.class, bookId);</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span>     @Override</span></span>
<span class="line"><span>     public void updateStock(Integer bookId) {</span></span>
<span class="line"><span>         String sql = &quot;update t_book set stock = stock - 1 where book_id = ?&quot;;</span></span>
<span class="line"><span>         jdbcTemplate.update(sql, bookId);</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span>     @Override</span></span>
<span class="line"><span>     public void updateBalance(Integer userId, Integer price) {</span></span>
<span class="line"><span>         String sql = &quot;update t_user set balance = balance - ? where user_id =?&quot;;</span></span>
<span class="line"><span>             jdbcTemplate.update(sql, price, userId);</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-2、测试无事务情况" tabindex="-1"><a class="header-anchor" href="#_4-3-2、测试无事务情况"><span><strong>4.3.2、测试无事务情况</strong></span></a></h3><h3 id="_1创建测试类" tabindex="-1"><a class="header-anchor" href="#_1创建测试类"><span><strong>①创建测试类</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @RunWith(SpringJUnit4ClassRunner.class)</span></span>
<span class="line"><span> @ContextConfiguration(&quot;classpath:tx-annotation.xml&quot;)</span></span>
<span class="line"><span> public class TxByAnnotationTest {</span></span>
<span class="line"><span>     @Autowired</span></span>
<span class="line"><span>     private BookController bookController;</span></span>
<span class="line"><span>     @Test</span></span>
<span class="line"><span>     public void testBuyBook(){</span></span>
<span class="line"><span>         bookController.buyBook(1, 1);</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2模拟场景" tabindex="-1"><a class="header-anchor" href="#_2模拟场景"><span><strong>②模拟场景</strong></span></a></h3><p>用户购买图书，先查询图书的价格，再更新图书的库存和用户的余额</p><p>假设用户id为1的用户，购买id为1的图书</p><p>用户余额为50，而图书价格为80</p><p>购买图书之后，用户的余额为-30，数据库中余额字段设置了无符号，因此无法将-30插入到余额字段</p><p>此时执行sql语句会抛出SQLException</p><h3 id="_3观察结果" tabindex="-1"><a class="header-anchor" href="#_3观察结果"><span><strong>③观察结果</strong></span></a></h3><p>因为没有添加事务，图书的库存更新了，但是用户的余额没有更新</p><p>显然这样的结果是错误的，购买图书是一个完整的功能，更新库存和更新余额要么都成功要么都失败</p><h3 id="_4-3-3、加入事务" tabindex="-1"><a class="header-anchor" href="#_4-3-3、加入事务"><span><strong>4.3.3、加入事务</strong></span></a></h3><h3 id="_1添加事务配置" tabindex="-1"><a class="header-anchor" href="#_1添加事务配置"><span><strong>①添加事务配置</strong></span></a></h3><p>在Spring的配置文件中添加配置：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;bean id=&quot;transactionManager&quot;</span></span>
<span class="line"><span>       class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span></span>
<span class="line"><span>     &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span> &lt;/bean&gt;</span></span>
<span class="line"><span> &lt;!--</span></span>
<span class="line"><span>     开启事务的注解驱动</span></span>
<span class="line"><span>     通过注解@Transactional所标识的方法或标识的类中所有的方法，都会被事务管理器管理事务</span></span>
<span class="line"><span> --&gt;</span></span>
<span class="line"><span> &lt;!-- transaction-manager属性的默认值是transactionManager，如果事务管理器bean的id正好就</span></span>
<span class="line"><span> 是这个默认值，则可以省略这个属性 --&gt;</span></span>
<span class="line"><span> &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; /&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：导入的名称空间需要 <strong>tx</strong> <strong>结尾</strong>的那个。</p><h3 id="_2添加事务注解" tabindex="-1"><a class="header-anchor" href="#_2添加事务注解"><span><strong>②添加事务注解</strong></span></a></h3><p>因为service层表示业务逻辑层，一个方法表示一个完成的功能，因此处理事务一般在service层处理</p><p>在BookServiceImpl的buybook()添加注解@Transactional</p><h3 id="_3观察结果-1" tabindex="-1"><a class="header-anchor" href="#_3观察结果-1"><span><strong>③观察结果</strong></span></a></h3><p>由于使用了Spring的声明式事务，更新库存和更新余额都没有执行</p><h3 id="_4-3-4、-transactional注解标识的位置" tabindex="-1"><a class="header-anchor" href="#_4-3-4、-transactional注解标识的位置"><span><strong>4.3.4、@Transactional注解标识的位置</strong></span></a></h3><p>@Transactional标识在方法上，咋只会影响该方法</p><p>@Transactional标识的类上，咋会影响类中所有的方法</p><h3 id="_4-3-5、事务属性-只读" tabindex="-1"><a class="header-anchor" href="#_4-3-5、事务属性-只读"><span><strong>4.3.5、事务属性：只读</strong></span></a></h3><h3 id="_1介绍" tabindex="-1"><a class="header-anchor" href="#_1介绍"><span><strong>①介绍</strong></span></a></h3><p>对一个查询操作来说，如果我们把它设置成只读，就能够明确告诉数据库，这个操作不涉及写操作。这样数据库就能够针对查询操作来进行优化。</p><h3 id="_2使用方式" tabindex="-1"><a class="header-anchor" href="#_2使用方式"><span><strong>②使用方式</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Transactional(readOnly = true)</span></span>
<span class="line"><span> public void buyBook(Integer bookId, Integer userId) {</span></span>
<span class="line"><span>     //查询图书的价格</span></span>
<span class="line"><span>     Integer price = bookDao.getPriceByBookId(bookId);</span></span>
<span class="line"><span>     //更新图书的库存</span></span>
<span class="line"><span>     bookDao.updateStock(bookId);</span></span>
<span class="line"><span>     //更新用户的余额</span></span>
<span class="line"><span>     bookDao.updateBalance(userId, price);</span></span>
<span class="line"><span>     //System.out.println(1/0);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3注意" tabindex="-1"><a class="header-anchor" href="#_3注意"><span><strong>③注意</strong></span></a></h3><p>对增删改操作设置只读会抛出下面异常：</p><p>Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification</p><p>are not allowed</p><h3 id="_4-3-6、事务属性-超时" tabindex="-1"><a class="header-anchor" href="#_4-3-6、事务属性-超时"><span><strong>4.3.6、事务属性：超时</strong></span></a></h3><h3 id="_1介绍-1" tabindex="-1"><a class="header-anchor" href="#_1介绍-1"><span><strong>①介绍</strong></span></a></h3><p>事务在执行过程中，有可能因为遇到某些问题，导致程序卡住，从而长时间占用数据库资源。而长时间占用资源，大概率是因为程序运行出现了问题（可能是Java程序或MySQL数据库或网络连接等等）。</p><p>此时这个很可能出问题的程序应该被回滚，撤销它已做的操作，事务结束，把资源让出来，让其他正常程序可以执行。</p><p>概括来说就是一句话：超时回滚，释放资源。</p><h3 id="_2使用方式-1" tabindex="-1"><a class="header-anchor" href="#_2使用方式-1"><span><strong>②使用方式</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Transactional(timeout = 3)</span></span>
<span class="line"><span> public void buyBook(Integer bookId, Integer userId) {</span></span>
<span class="line"><span>     try {</span></span>
<span class="line"><span>         TimeUnit.SECONDS.sleep(5);</span></span>
<span class="line"><span>     } catch (InterruptedException e) {</span></span>
<span class="line"><span>         e.printStackTrace();</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span>     //查询图书的价格</span></span>
<span class="line"><span>     Integer price = bookDao.getPriceByBookId(bookId);</span></span>
<span class="line"><span>     //更新图书的库存</span></span>
<span class="line"><span>     bookDao.updateStock(bookId);</span></span>
<span class="line"><span>     //更新用户的余额</span></span>
<span class="line"><span>     bookDao.updateBalance(userId, price);</span></span>
<span class="line"><span>     //System.out.println(1/0);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3观察结果-2" tabindex="-1"><a class="header-anchor" href="#_3观察结果-2"><span><strong>③观察结果</strong></span></a></h3><p>执行过程中抛出异常：</p><p>org.springframework.transaction.<strong>TransactionTimedOutException</strong>: Transaction timed out:</p><p>deadline was Fri Jun 04 16:25:39 CST 2022</p><h3 id="_4-3-7、事务属性-回滚策略" tabindex="-1"><a class="header-anchor" href="#_4-3-7、事务属性-回滚策略"><span><strong>4.3.7、事务属性：回滚策略</strong></span></a></h3><h3 id="_1介绍-2" tabindex="-1"><a class="header-anchor" href="#_1介绍-2"><span><strong>①介绍</strong></span></a></h3><p>声明式事务默认只针对运行时异常回滚，编译时异常不回滚。</p><p>可以通过@Transactional中相关属性设置回滚策略</p><ul><li>rollbackFor属性：需要设置一个Class类型的对象</li><li>rollbackForClassName属性：需要设置一个字符串类型的全类名</li><li>noRollbackFor属性：需要设置一个Class类型的对象</li><li>rollbackFor属性：需要设置一个字符串类型的全类名</li></ul><h3 id="_2使用方式-2" tabindex="-1"><a class="header-anchor" href="#_2使用方式-2"><span><strong>②使用方式</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Transactional(noRollbackFor = ArithmeticException.class)</span></span>
<span class="line"><span> //@Transactional(noRollbackForClassName = &quot;java.lang.ArithmeticException&quot;)</span></span>
<span class="line"><span> public void buyBook(Integer bookId, Integer userId) {</span></span>
<span class="line"><span>     //查询图书的价格</span></span>
<span class="line"><span>     Integer price = bookDao.getPriceByBookId(bookId);</span></span>
<span class="line"><span>     //更新图书的库存</span></span>
<span class="line"><span>     bookDao.updateStock(bookId);</span></span>
<span class="line"><span>     //更新用户的余额</span></span>
<span class="line"><span>     bookDao.updateBalance(userId, price);</span></span>
<span class="line"><span>     System.out.println(1/0);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3观察结果-3" tabindex="-1"><a class="header-anchor" href="#_3观察结果-3"><span><strong>③观察结果</strong></span></a></h3><p>虽然购买图书功能中出现了数学运算异常（ArithmeticException），但是我们设置的回滚策略是，当</p><p>出现ArithmeticException不发生回滚，因此购买图书的操作正常执行</p><h3 id="_4-3-8、事务属性-事务隔离级别" tabindex="-1"><a class="header-anchor" href="#_4-3-8、事务属性-事务隔离级别"><span><strong>4.3.8、事务属性：事务隔离级别</strong></span></a></h3><h3 id="_1介绍-3" tabindex="-1"><a class="header-anchor" href="#_1介绍-3"><span><strong>①介绍</strong></span></a></h3><p>数据库系统必须具有隔离并发运行各个事务的能力，使它们不会相互影响，避免各种并发问题。一个事</p><p>务与其他事务隔离的程度称为隔离级别。SQL标准中规定了多种事务隔离级别，不同隔离级别对应不同</p><p>的干扰程度，隔离级别越高，数据一致性就越好，但并发性越弱。</p><p>隔离级别一共有四种：</p><ul><li>读未提交：READ UNCOMMITTED</li></ul><p>允许Transaction01读取Transaction02未提交的修改。</p><ul><li>读已提交：READ COMMITTED、</li></ul><p>要求Transaction01只能读取Transaction02已提交的修改。</p><ul><li>可重复读：REPEATABLE READ</li></ul><p>确保Transaction01可以多次从一个字段中读取到相同的值，即Transaction01执行期间禁止其它</p><p>事务对这个字段进行更新。</p><ul><li>串行化：SERIALIZABLE</li></ul><p>确保Transaction01可以多次从一个表中读取到相同的行，在Transaction01执行期间，禁止其它</p><p>事务对这个表进行添加、更新、删除操作。可以避免任何并发问题，但性能十分低下。</p><p>各个隔离级别解决并发问题的能力见下表：</p><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>READ UNCOMMITTED</td><td>有</td><td>有</td><td>有</td></tr><tr><td>READ COMMITTED</td><td>无</td><td>有</td><td>有</td></tr><tr><td>REPEATABLE READ</td><td>无</td><td>无</td><td>有</td></tr><tr><td>SERIALIZABLE</td><td>无</td><td>无</td><td>无</td></tr></tbody></table><p>各种数据库产品对事务隔离级别的支持程度：</p><table><thead><tr><th>隔离级别</th><th>Oracle</th><th>MySQL</th></tr></thead><tbody><tr><td>READ UNCOMMITTED</td><td>×</td><td>√</td></tr><tr><td>READ COMMITTED</td><td>√(默认)</td><td>√</td></tr><tr><td>REPEATABLE READ</td><td>×</td><td>√(默认)</td></tr><tr><td>SERIALIZABLE</td><td>√</td><td>√</td></tr></tbody></table><h3 id="_2使用方式-3" tabindex="-1"><a class="header-anchor" href="#_2使用方式-3"><span><strong>②使用方式</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Transactional(isolation = Isolation.DEFAULT)//使用数据库默认的隔离级别</span></span>
<span class="line"><span> @Transactional(isolation = Isolation.READ_UNCOMMITTED)//读未提交</span></span>
<span class="line"><span> @Transactional(isolation = Isolation.READ_COMMITTED)//读已提交</span></span>
<span class="line"><span> @Transactional(isolation = Isolation.REPEATABLE_READ)//可重复读</span></span>
<span class="line"><span> @Transactional(isolation = Isolation.SERIALIZABLE)//串行化</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-9、事务属性-事务传播行为" tabindex="-1"><a class="header-anchor" href="#_4-3-9、事务属性-事务传播行为"><span><strong>4.3.9、事务属性：事务传播行为</strong></span></a></h3><h3 id="_1介绍-4" tabindex="-1"><a class="header-anchor" href="#_1介绍-4"><span><strong>①介绍</strong></span></a></h3><p>当事务方法被另一个事务方法调用时，必须指定事务应该如何传播。例如：方法可能继续在现有事务中运行，也可能开启一个新事务，并在自己的事务中运行。</p><h3 id="_2测试" tabindex="-1"><a class="header-anchor" href="#_2测试"><span><strong>②测试</strong></span></a></h3><p>创建接口CheckoutService：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> public interface CheckoutService {</span></span>
<span class="line"><span>   void checkout(Integer[] bookIds, Integer userId);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建实现类CheckoutServiceImpl：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Service</span></span>
<span class="line"><span> public class CheckoutServiceImpl implements CheckoutService {</span></span>
<span class="line"><span>     @Autowired</span></span>
<span class="line"><span>     private BookService bookService;</span></span>
<span class="line"><span>     @Override</span></span>
<span class="line"><span>     @Transactional</span></span>
<span class="line"><span>     //一次购买多本图书</span></span>
<span class="line"><span>     public void checkout(Integer[] bookIds, Integer userId) {</span></span>
<span class="line"><span>         for (Integer bookId : bookIds) {</span></span>
<span class="line"><span>             bookService.buyBook(bookId, userId);</span></span>
<span class="line"><span>         }</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在BookController中添加方法：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> @Autowired</span></span>
<span class="line"><span> private CheckoutService checkoutService;</span></span>
<span class="line"><span> public void checkout(Integer[] bookIds, Integer userId){</span></span>
<span class="line"><span>     checkoutService.checkout(bookIds, userId);</span></span>
<span class="line"><span> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在数据库中将用户的余额修改为100元</p><h3 id="_3观察结果-4" tabindex="-1"><a class="header-anchor" href="#_3观察结果-4"><span><strong>③观察结果</strong></span></a></h3><p>可以通过@Transactional中的propagation属性设置事务传播行为</p><p>修改BookServiceImpl中buyBook()上，注解@Transactional的propagation属性</p><p>@Transactional(propagation = Propagation.REQUIRED)，默认情况，表示如果当前线程上有已经开</p><p>启的事务可用，那么就在这个事务中运行。经过观察，购买图书的方法buyBook()在checkout()中被调</p><p>用，checkout()上有事务注解，因此在此事务中执行。所购买的两本图书的价格为80和50，而用户的余额为100，因此在购买第二本图书时余额不足失败，导致整个checkout()回滚，即只要有一本书买不</p><p>了，就都买不了</p><p>@Transactional(propagation = Propagation.REQUIRES_NEW)，表示不管当前线程上是否有已经开启的事务，都要开启新事务。同样的场景，每次购买图书都是在buyBook()的事务中执行，因此第一本图书购买成功，事务结束，第二本图书购买失败，只在第二次的buyBook()中回滚，购买第一本图书不受影响，即能买几本就买几本</p><h2 id="_4-4、基于xml的声明式事务" tabindex="-1"><a class="header-anchor" href="#_4-4、基于xml的声明式事务"><span><strong>4.4、基于XML的声明式事务</strong></span></a></h2><h3 id="_4-3-1、场景模拟" tabindex="-1"><a class="header-anchor" href="#_4-3-1、场景模拟"><span><strong>4.3.1、场景模拟</strong></span></a></h3><p>参考基于注解的声明式事务</p><h3 id="_4-3-2、修改spring配置文件" tabindex="-1"><a class="header-anchor" href="#_4-3-2、修改spring配置文件"><span><strong>4.3.2、修改Spring配置文件</strong></span></a></h3><p>将Spring配置文件中去掉tx:annotation-driven 标签，并添加配置：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;aop:config&gt;</span></span>
<span class="line"><span>     &lt;!-- 配置事务通知和切入点表达式 --&gt;</span></span>
<span class="line"><span>     &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut=&quot;execution(*com.atguigu.spring.tx.xml.service.impl.*.*(..))&quot;&gt;&lt;/aop:advisor&gt;</span></span>
<span class="line"><span> &lt;/aop:config&gt;</span></span>
<span class="line"><span> &lt;!-- tx:advice标签：配置事务通知 --&gt;</span></span>
<span class="line"><span> &lt;!-- id属性：给事务通知标签设置唯一标识，便于引用 --&gt;</span></span>
<span class="line"><span> &lt;!-- transaction-manager属性：关联事务管理器 --&gt;</span></span>
<span class="line"><span> &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</span></span>
<span class="line"><span>     &lt;tx:attributes&gt;</span></span>
<span class="line"><span>         &lt;!-- tx:method标签：配置具体的事务方法 --&gt;</span></span>
<span class="line"><span>         &lt;!-- name属性：指定方法名，可以使用星号代表多个字符 --&gt;</span></span>
<span class="line"><span>         &lt;tx:method name=&quot;get*&quot; read-only=&quot;true&quot;/&gt;</span></span>
<span class="line"><span>         &lt;tx:method name=&quot;query*&quot; read-only=&quot;true&quot;/&gt;</span></span>
<span class="line"><span>         &lt;tx:method name=&quot;find*&quot; read-only=&quot;true&quot;/&gt;</span></span>
<span class="line"><span>         &lt;!-- read-only属性：设置只读属性 --&gt;</span></span>
<span class="line"><span>         &lt;!-- rollback-for属性：设置回滚的异常 --&gt;</span></span>
<span class="line"><span>         &lt;!-- no-rollback-for属性：设置不回滚的异常 --&gt;</span></span>
<span class="line"><span>         &lt;!-- isolation属性：设置事务的隔离级别 --&gt;</span></span>
<span class="line"><span>         &lt;!-- timeout属性：设置事务的超时属性 --&gt;</span></span>
<span class="line"><span>         &lt;!-- propagation属性：设置事务的传播行为 --&gt;</span></span>
<span class="line"><span>         &lt;tx:method name=&quot;save*&quot; read-only=&quot;false&quot; rollback-for=&quot;java.lang.Exception&quot; propagation=&quot;REQUIRES_NEW&quot;/&gt;</span></span>
<span class="line"><span>         &lt;tx:method name=&quot;update*&quot; read-only=&quot;false&quot; rollback-for=&quot;java.lang.Exception&quot; propagation=&quot;REQUIRES_NEW&quot;/&gt;</span></span>
<span class="line"><span>         &lt;tx:method name=&quot;delete*&quot; read-only=&quot;false&quot; rollback-for=&quot;java.lang.Exception&quot; propagation=&quot;REQUIRES_NEW&quot;/&gt;</span></span>
<span class="line"><span>     &lt;/tx:attributes&gt;</span></span>
<span class="line"><span> &lt;/tx:advice&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：基于xml实现的声明式事务，必须引入aspectJ的依赖</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> &lt;dependency&gt;</span></span>
<span class="line"><span>  &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></span>
<span class="line"><span>  &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span></span>
<span class="line"><span>  &lt;version&gt;5.3.1&lt;/version&gt;</span></span>
<span class="line"><span> &lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/justdoitMr/blogs//edit/master/themeHope/SpringPrinciple/Spring/act_four_SpringTransaction.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2284609302@qq.com">不爱打代码的程序员</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/SpringPrinciple/Spring/act_three_SpringAopBasic.html" aria-label="3、Spring AOP"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>3、Spring AOP</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">豫ICP备20230606088</a><img src="https://vscodepic.oss-cn-beijing.aliyuncs.com/blog/202406112054052.png" height="15px" width="15px" /><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41030502000411"><span>豫公网安备 41080552980273号</span></a></div><div class="vp-copyright">Copyright © 2024 Mr.bugcode </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.6307d164.js" defer></script><script src="/assets/js/9547.c8ff98a9.js" defer></script><script src="/assets/js/app.da879f88.js" defer></script>
  </body>
</html>
