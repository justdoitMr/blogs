<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.47" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.bugcode.online/ContainerCloud/docker/act_two_docker_two.html"><meta property="og:site_name" content="bugcode 的架构之路"><meta property="og:title" content="2、Docker复杂安装详说"><meta property="og:description" content="2 Docker复杂安装详说 1.1 安装MySQL主从复制 1.1.1 主从复制原理 MySQL主从复制原理_牛奔的博客-CSDN博客 1.1.2 主从搭建步骤 新建主服务器容器实例3307 进入/mydata/mysql-master/conf目录下新建my.cnf 修改完配置后重启master实例 进入mysql-master容器 master容..."><meta property="og:type" content="article"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995661799-39e995e2-73e0-4e7d-bc9d-59c1fa0b8e3c.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-08-12T07:44:04.000Z"><meta property="article:author" content="bugcode"><meta property="article:tag" content="docker"><meta property="article:tag" content="云原生"><meta property="article:published_time" content="2024-01-01T00:00:00.000Z"><meta property="article:modified_time" content="2024-08-12T07:44:04.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"2、Docker复杂安装详说","image":["https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995661799-39e995e2-73e0-4e7d-bc9d-59c1fa0b8e3c.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995728716-90fc0143-7a4d-465e-83c1-a17bad83823e.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995798230-fbe9f08c-af5d-4e83-915d-62302a5ad1a1.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995805394-60a39a9a-8be4-43b7-9489-84afd4ef0310.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658996785793-2ca8867b-2254-45ee-8bc7-8f566d737db2.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999862145-25f18b54-2e15-47f3-a873-a5d44a16f866.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999891472-39767eb6-5396-4b43-9cfb-71103e0758ec.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999908647-d6826cc9-9435-4701-8e42-9aaf09cee0be.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999941543-94276993-0b80-4c0d-8804-662831456bc2.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000035920-385ef89f-50cc-497a-9954-b91df3b4e84a.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000055531-fe1191aa-34b3-46d8-9981-b7ff2ad7f2a7.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000479815-61ec964c-ad1b-4a75-a379-a5aa680199f1.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000487455-b7174e19-35ee-472e-8884-2fad95f1edbc.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000531546-75739be6-1aee-4165-9dfb-6ac727deddf6.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000521473-2a5a3350-1bd4-4394-b4dd-496f4e024034.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660012864805-18937b87-0167-4c81-9d75-f485a61c5304.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013094449-a1af09f8-c696-4f09-a5de-6ee1844fb424.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013238837-86e640c5-49ef-424a-81d0-bc702f35389b.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013257101-5b63a752-99eb-4678-b2de-a527717ccbcc.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013470341-d8868461-36e0-412b-9763-233d14746823.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013529609-d6979855-7c7d-4782-803c-43b2d6c871c0.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013524209-af8d1240-9240-4fa7-8582-78e3e6704212.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013696660-44f47c05-55ed-49ea-b01b-d5c5ceaad1f9.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013728508-f1d618bc-11f9-4fc2-acdd-c5b111ee1804.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013737191-54f5780e-bc5f-419a-92e5-95f980e7cb7d.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013973533-8d49c0c9-0ea4-45a0-b2e3-14d3f28a33a0.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013999567-eea06f1d-f9ac-425e-a851-c5dda92b5ce5.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014531015-748a0daa-758a-44ea-9496-34d5e34810e0.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014469696-1c74ba76-2119-4031-8337-4ab9880aec14.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014597535-9bd29a0a-3a5e-4e51-bad4-df136dd6c0fd.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014603485-ae9f7bae-798e-4538-9a35-05ddd6226cc5.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014631293-415ef8b0-d5c7-4107-9c47-19b58f568931.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014653132-0f14d9d0-133d-436f-93ec-4a4dc6625ff4.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014736138-8bb82a47-f06e-458d-b445-24077db9bdcd.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014743652-1ed51439-61d8-4641-b75d-529e8bc74eb6.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014763642-61295eb3-d313-4f8b-873c-ca674dff3b4d.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014788578-6dfe4fa8-d48d-402a-8c88-0ec91503aa7a.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014827592-6677a045-601e-40ae-b864-752c300a67ec.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015228582-d53dce4a-89a7-4f66-bbc1-4efc307f24d3.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015279664-11ace734-3cac-448d-acf2-415ff4618e8e.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015379854-488ba2d7-ee4a-4e28-8b07-9fa24f239263.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015407249-1b8e1153-a117-406c-bc76-f9688c909e0d.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015422129-27734091-90d4-43cf-8725-27c4eef8548e.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660016500199-9bfcce87-7c5d-4ac4-8d40-3e9e9491a0fd.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660016581784-bbd7401b-0304-40e5-b3d4-143e1b6adbcd.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660016611099-39c73410-3a1c-4576-b566-48234db9c1bc.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660020074503-4a28db4d-8a0f-4f21-ab74-0b999e579207.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660020104133-dbc519f6-d0e1-4bec-af0c-40ec9db8d1e4.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028923163-79ad77b4-a9ae-4dd6-8786-aacd45788733.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028984092-3cd2b316-73da-4072-b045-de7fbcb392a3.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028988258-aa1db7cd-2f6f-4e08-b991-875723ee24de.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028995174-805d3a36-8f02-4c56-a753-0048a859cd73.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660032915706-ca6ff6ae-5f12-4932-9a51-934cd86d5222.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033430938-9526470c-089a-4cde-8ee9-5bd3328f32fb.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033444646-6696d6a3-ca9b-4546-88a4-89909eddf89d.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033451033-300878aa-e6ba-42f1-9264-be57d65b87b3.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033457920-8e9618b2-6979-4d7c-8071-a2a098dc1128.png","https://cdn.nlark.com/yuque/0/2022/png/27791237/1660034195809-591c7f4b-dd7b-46a2-9865-7e2c01ae8239.png"],"datePublished":"2024-01-01T00:00:00.000Z","dateModified":"2024-08-12T07:44:04.000Z","author":[{"@type":"Person","name":"bugcode"}]}</script><meta name="robots" content="all"><meta name="author" content="bugcode"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="Java, Java基础, 并发编程, JVM, 虚拟机, 数据库, MySQL, Spring, Redis, MyBatis, SpringBoot, IDEA, 求职面试, 面渣逆袭, 学习路线"><meta name="apple-mobile-web-app-capable" content="yes"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4570931_i3acfllzyt.css"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><title>2、Docker复杂安装详说 | bugcode 的架构之路</title><meta name="description" content="2 Docker复杂安装详说 1.1 安装MySQL主从复制 1.1.1 主从复制原理 MySQL主从复制原理_牛奔的博客-CSDN博客 1.1.2 主从搭建步骤 新建主服务器容器实例3307 进入/mydata/mysql-master/conf目录下新建my.cnf 修改完配置后重启master实例 进入mysql-master容器 master容...">
    <link rel="stylesheet" href="/assets/css/styles.6b04e72b.css">
    <link rel="preload" href="/assets/js/runtime~app.e972e9bb.js" as="script"><link rel="preload" href="/assets/css/styles.6b04e72b.css" as="style"><link rel="preload" href="/assets/js/9547.c8ff98a9.js" as="script"><link rel="preload" href="/assets/js/app.8a0774db.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://vscodepic.oss-cn-beijing.aliyuncs.com/blog/log.jpg" alt><!----><span class="vp-site-name hide-in-pad">bugcode 的架构之路</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/introduction/" aria-label="导读"><!--[--><span class="font-icon icon iconfont icon-book" style=""></span><!--]-->导读<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="算法"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>算法<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/algor/" aria-label="算法专题"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->算法专题<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/dataStructure/" aria-label="数据结构专题"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->数据结构专题<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="设计模式"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>设计模式<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/designPrinciple/" aria-label="设计原则"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->设计原则<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/creational/" aria-label="创建型"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->创建型<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/Behavior/" aria-label="行为型"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->行为型<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/structural/" aria-label="结构型"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->结构型<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="源码"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>源码<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/frameDesignAndSourceCode/springSourceCode/" aria-label="Spring源码实现"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Spring源码实现<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/frameDesignAndSourceCode/mybatisSourceCode/" aria-label="Mybatis框架实现"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Mybatis框架实现<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="架构专题"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>架构专题<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/engineeringArchitectureDesign/" aria-label="MVC和DDD"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->MVC和DDD<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="精选博文"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>精选博文<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">业务知识</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/excellentBook/business/" aria-label="金融业务"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->金融业务<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">项目经验</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/excellentBook/project/" aria-label="K8S部署项目"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->K8S部署项目<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/excellentBook/" aria-label="通用数据设计"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->通用数据设计<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/excellentBook/scence.html" aria-label="业务场景设计"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->业务场景设计<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/home.html" aria-label="基础归档"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->基础归档<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/k8s/" aria-label="面试篇"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->面试篇<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/KnowledgePlanet/" aria-label="知识星球"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->知识星球<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/KnowledgePlanet/" aria-label="B站"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->B站<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/about/" aria-label="关于我"><!--[--><span class="font-icon icon iconfont icon-book" style=""></span><!--]-->关于我<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/justdoitMr/blogs/" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">一、导读</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">二、java核心</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">三、Spring篇</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">四、大数据篇</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">五、云原生</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">1、Docker</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ContainerCloud/docker/act_one_docker_one.html" aria-label="1、Docker基础"><!--[--><span class="font-icon icon iconfont icon-file" style=""></span><!--]-->1、Docker基础<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/ContainerCloud/docker/act_two_docker_two.html" aria-label="2、Docker复杂安装详说"><!--[--><span class="font-icon icon iconfont icon-file" style=""></span><!--]-->2、Docker复杂安装详说<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">2、K8S</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、前端篇</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-file" style=""></span>2、Docker复杂安装详说</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">bugcode</span></span><span property="author" content="bugcode"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-01-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 31 分钟</span><meta property="timeRequired" content="PT31M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2 clickable" role="navigation">DOCKER</span><span class="page-category-item color5 clickable" role="navigation">云原生</span><!--]--><meta property="articleSection" content="DOCKER,云原生"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">docker</span><span class="page-tag-item color5 clickable" role="navigation">云原生</span><!--]--><meta property="keywords" content="docker,云原生"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-1-安装mysql主从复制">1.1 安装MySQL主从复制</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-1-主从复制原理">1.1.1 主从复制原理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-2-主从搭建步骤">1.1.2 主从搭建步骤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题">1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-1-面试题">1.2.1 面试题</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-2-3主3从redis集群扩缩容配置案例架构说明">1.2.2 3主3从redis集群扩缩容配置案例架构说明</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-3-开打步骤">1.2.3 开打步骤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-1-是什么">2.1 是什么</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-2-dockerfile构建过程解析">2.2 DockerFile构建过程解析</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-1-dockerfile内容基础知识">2.2.1 Dockerfile内容基础知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-2-docker执行dockerfile的大致流程">2.2.2 Docker执行Dockerfile的大致流程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-3-小总结">2.2.3 小总结</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-3-dockerfile常用保留字指令">2.3 DockerFile常用保留字指令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-4-案例">2.4 案例</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-1-自定义镜像mycentosjava8">2.4.1 自定义镜像mycentosjava8</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-2-虚悬镜像">2.4.2 虚悬镜像</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-3-家庭作业-自定义镜像myubuntu">2.4.3 家庭作业-自定义镜像myubuntu</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-5-小总结">2.5 小总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-通过idea新建一个普通微服务模块">3.1 通过IDEA新建一个普通微服务模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-2-通过dockerfile发布微服务部署到docker容器">3.2 通过dockerfile发布微服务部署到docker容器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#是什么">是什么</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#常用基本命令">常用基本命令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#能干嘛">能干嘛</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#网络模式">网络模式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#docker平台架构图解">Docker平台架构图解</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#是什么-1">是什么</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装">安装</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#登陆并演示介绍常用操作case">登陆并演示介绍常用操作case</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="_2-docker复杂安装详说" tabindex="-1"><a class="header-anchor" href="#_2-docker复杂安装详说"><span>2 Docker复杂安装详说</span></a></h1><h2 id="_1-1-安装mysql主从复制" tabindex="-1"><a class="header-anchor" href="#_1-1-安装mysql主从复制"><span>1.1 安装MySQL主从复制</span></a></h2><h3 id="_1-1-1-主从复制原理" tabindex="-1"><a class="header-anchor" href="#_1-1-1-主从复制原理"><span>1.1.1 主从复制原理</span></a></h3><p><a href="https://blog.csdn.net/Guzarish/article/details/123244487" target="_blank" rel="noopener noreferrer">MySQL主从复制原理_牛奔的博客-CSDN博客</a></p><h3 id="_1-1-2-主从搭建步骤" tabindex="-1"><a class="header-anchor" href="#_1-1-2-主从搭建步骤"><span>1.1.2 主从搭建步骤</span></a></h3><ol><li>新建主服务器容器实例3307</li></ol><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -p 3307:3306 --name mysql-master \</span></span>
<span class="line"><span>-v /mydata/mysql-master/log:/var/log/mysql \</span></span>
<span class="line"><span>-v /mydata/mysql-master/data:/var/lib/mysql \</span></span>
<span class="line"><span>-v /mydata/mysql-master/conf:/etc/mysql \</span></span>
<span class="line"><span>-e MYSQL_ROOT_PASSWORD=root  \</span></span>
<span class="line"><span>-d mysql:5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>进入/mydata/mysql-master/conf目录下新建my.cnf</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>vim my.cnf</span></span>
<span class="line"><span>[mysqld]</span></span>
<span class="line"><span>## 设置server_id，同一局域网中需要唯一</span></span>
<span class="line"><span>server_id=101 </span></span>
<span class="line"><span>## 指定不需要同步的数据库名称</span></span>
<span class="line"><span>binlog-ignore-db=mysql  </span></span>
<span class="line"><span>## 开启二进制日志功能</span></span>
<span class="line"><span>log-bin=mall-mysql-bin  </span></span>
<span class="line"><span>## 设置二进制日志使用内存大小（事务）</span></span>
<span class="line"><span>binlog_cache_size=1M  </span></span>
<span class="line"><span>## 设置使用的二进制日志格式（mixed,statement,row）</span></span>
<span class="line"><span>binlog_format=mixed  </span></span>
<span class="line"><span>## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span>
<span class="line"><span>expire_logs_days=7  </span></span>
<span class="line"><span>## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span>
<span class="line"><span>## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span>slave_skip_errors=1062</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>修改完配置后重启master实例</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker restart mysql-master</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>进入mysql-master容器</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it mysql-master /bin/bash</span></span>
<span class="line"><span>mysql -uroot -proot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>master容器实例内创建数据同步用户</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;</span></span>
<span class="line"><span>GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;slave&#39;@&#39;%&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>新建从服务器容器实例3308</li></ol><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -p 3308:3306 --name mysql-slave \</span></span>
<span class="line"><span>-v /mydata/mysql-slave/log:/var/log/mysql \</span></span>
<span class="line"><span>-v /mydata/mysql-slave/data:/var/lib/mysql \</span></span>
<span class="line"><span>-v /mydata/mysql-slave/conf:/etc/mysql \</span></span>
<span class="line"><span>-e MYSQL_ROOT_PASSWORD=root  \</span></span>
<span class="line"><span>-d mysql:5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>进入/mydata/mysql-slave/conf目录下新建my.cnf</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>vim my.cnf</span></span>
<span class="line"><span>[mysqld]</span></span>
<span class="line"><span>## 设置server_id，同一局域网中需要唯一</span></span>
<span class="line"><span>server_id=102</span></span>
<span class="line"><span>## 指定不需要同步的数据库名称</span></span>
<span class="line"><span>binlog-ignore-db=mysql  </span></span>
<span class="line"><span>## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span>
<span class="line"><span>log-bin=mall-mysql-slave1-bin  </span></span>
<span class="line"><span>## 设置二进制日志使用内存大小（事务）</span></span>
<span class="line"><span>binlog_cache_size=1M  </span></span>
<span class="line"><span>## 设置使用的二进制日志格式（mixed,statement,row）</span></span>
<span class="line"><span>binlog_format=mixed  </span></span>
<span class="line"><span>## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span>
<span class="line"><span>expire_logs_days=7  </span></span>
<span class="line"><span>## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span>
<span class="line"><span>## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span>slave_skip_errors=1062  </span></span>
<span class="line"><span>## relay_log配置中继日志</span></span>
<span class="line"><span>relay_log=mall-mysql-relay-bin  </span></span>
<span class="line"><span>## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span>
<span class="line"><span>log_slave_updates=1  </span></span>
<span class="line"><span>## slave设置为只读（具有super权限的用户除外）</span></span>
<span class="line"><span>read_only=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>修改完配置后重启slave实例</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker restart mysql-slave</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>在主数据库中查看主从同步状态</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>show master status;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>进入mysql-slave容器</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it mysql-slave /bin/bash</span></span>
<span class="line"><span>mysql -uroot -proot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>在从数据库中配置主从复制</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">change</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master_host=&#39;宿主机ip&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master_user=&#39;slave&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master_password=&#39;123456&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">master_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">3307,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> master_log_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;mall-mysql-bin.000001&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> master_log_pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">617,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> master_connect_retry</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995661799-39e995e2-73e0-4e7d-bc9d-59c1fa0b8e3c.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>主从复制命令参数说明</p><p>master_host：主数据库的IP地址；</p><p>master_port：主数据库的运行端口；</p><p>master_user：在主数据库创建的用于同步数据的用户账号；</p><p>master_password：在主数据库创建的用于同步数据的用户密码；</p><p>master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</p><p>master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</p><p>master_connect_retry：连接失败重试的时间间隔，单位为秒。</p><ol><li>在从数据库中查看主从同步状态</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>show slave status \G;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995728716-90fc0143-7a4d-465e-83c1-a17bad83823e.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li>在从数据库中开启主从同步</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>start slave;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995798230-fbe9f08c-af5d-4e83-915d-62302a5ad1a1.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li>查看从数据库状态发现已经同步</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995805394-60a39a9a-8be4-43b7-9489-84afd4ef0310.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><p>主从复制测试</p></li><li><ol><li>主机新建库-使用库-新建表-插入数据，ok</li></ol></li><li><p>从机使用库-查看记录，ok</p></li></ol><h2 id="_1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题" tabindex="-1"><a class="header-anchor" href="#_1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题"><span>1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)</span></a></h2><p>cluster(集群)模式-docker版</p><p>哈希槽分区进行亿级数据存储</p><h3 id="_1-2-1-面试题" tabindex="-1"><a class="header-anchor" href="#_1-2-1-面试题"><span>1.2.1 面试题</span></a></h3><p>1~2亿条数据需要缓存，请问如何设计这个存储案例？</p><p>回答：单机单台100%不可能，肯定是分布式存储，用redis如何落地？</p><p>上述问题阿里P6~P7工程案例和场景设计类必考题目， 一般业界有3种解决方案</p><ol><li>哈希取余分区</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658996785793-2ca8867b-2254-45ee-8bc7-8f566d737db2.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：</p><p>hash(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</p><p>优点：</p><p>简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。</p><p>缺点：</p><p>原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key) /?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。</p><p>某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。</p><ol><li><p>一致性哈希算法分区</p></li><li><ol><li>是什么</li></ol></li></ol><p>一致性Hash算法背景</p><p>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。</p><ol><li><ol><li>能干嘛</li></ol></li></ol><p>提出一致性Hash解决方案。 目的是当服务器个数发生变动时， 尽量减少影响客户端到服务器的映射关系</p><ol><li><ol><li>3大步骤</li></ol></li><li><ol><li><ol><li>算法构建一致性哈希环</li></ol></li></ol></li></ol><p>一致性哈希环</p><p>​ 一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。</p><p>​ 它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32取模，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2^32-1（即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间按顺时针方向组织，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32-1，也就是说0点左侧的第一个点代表2^32-1， 0和2^32-1在零点中方向重合，我们把这个由2^32个点组成的圆环称为Hash环。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999862145-25f18b54-2e15-47f3-a873-a5d44a16f866.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><ol><li><ol><li>服务器IP节点映射</li></ol></li></ol></li></ol><p>节点映射</p><p>将集群中各个IP节点映射到环上的某一个位置。</p><p>将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999891472-39767eb6-5396-4b43-9cfb-71103e0758ec.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><ol><li><ol><li>key落到服务器的落键规则</li></ol></li></ol></li></ol><p>当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，从此位置沿环顺时针“行走”，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。</p><p>如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999908647-d6826cc9-9435-4701-8e42-9aaf09cee0be.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><ol><li>优点</li></ol></li><li><ol><li><ol><li>一致性哈希算法的容错性</li></ol></li></ol></li></ol><p>容错性</p><p>假设Node C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999941543-94276993-0b80-4c0d-8804-662831456bc2.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><ol><li><ol><li>一致性哈希算法的扩展性</li></ol></li></ol></li></ol><p>数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，</p><p>不会导致hash取余全部数据重新洗牌。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000035920-385ef89f-50cc-497a-9954-b91df3b4e84a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><ol><li>缺点</li></ol></li></ol><p>一致性哈希算法的数据倾斜问题</p><p>Hash环的数据倾斜问题</p><p>一致性Hash算法在服务节点太少时，容易因为节点分布不均匀而造成数据倾斜（被缓存的对象大部分集中缓存在某一台服务器上）问题，</p><p>例如系统中只有两台服务器：</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000055531-fe1191aa-34b3-46d8-9981-b7ff2ad7f2a7.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><ol><li>小总结</li></ol></li></ol><p>为了在节点数目发生改变时尽可能少的迁移数据</p><p>将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会顺时针找到临近的存储节点存放。</p><p>而当有节点加入或退出时仅影响该节点在Hash环上顺时针相邻的后续节点。</p><p>优点</p><p>加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。</p><p>缺点</p><p>数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</p><ol><li><p>哈希槽分区</p></li><li><ol><li>是什么</li></ol></li></ol><p>1 为什么出现</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000479815-61ec964c-ad1b-4a75-a379-a5aa680199f1.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p><p>2 能干什么</p><p>解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000487455-b7174e19-35ee-472e-8884-2fad95f1edbc.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。</p><p>哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。</p><p>3 多少个hash槽</p><p>一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。可以指定哪些编号的槽分配给哪个主节点。集群会记录节点和槽的对应关系。解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取余，余数是几key就落入对应的槽里。slot = CRC16(key) % 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。</p><ol><li><ol><li>哈希槽计算</li></ol></li></ol><p>Redis 集群中内置了 16384 个哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。当需要在 Redis 集群中放置一个 key-value时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000531546-75739be6-1aee-4165-9dfb-6ac727deddf6.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000521473-2a5a3350-1bd4-4394-b4dd-496f4e024034.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="_1-2-2-3主3从redis集群扩缩容配置案例架构说明" tabindex="-1"><a class="header-anchor" href="#_1-2-2-3主3从redis集群扩缩容配置案例架构说明"><span>1.2.2 3主3从redis集群扩缩容配置案例架构说明</span></a></h3><p>见自己的processon笔记</p><h3 id="_1-2-3-开打步骤" tabindex="-1"><a class="header-anchor" href="#_1-2-3-开打步骤"><span>1.2.3 开打步骤</span></a></h3><p>/todo</p><p>3主3从redis集群配置</p><p>关闭防火墙+启动docker后台服务</p><p>systemctl start docker</p><p>新建6个docker容器redis实例</p><p>命令分步解释</p><p>docker run</p><p>创建并运行docker容器实例</p><p>--name redis-node-6</p><p>容器名字</p><p>--net host</p><p>使用宿主机的IP和端口，默认</p><p>--privileged=true</p><p>获取宿主机root用户权限</p><p>-v /data/redis/share/redis-node-6:/data</p><p>容器卷，宿主机地址:docker内部地址</p><p>redis:6.0.8</p><p>redis镜像和版本号</p><p>--cluster-enabled yes</p><p>开启redis集群</p><p>--appendonly yes</p><p>开启持久化</p><p>--port 6386</p><p>redis端口号</p><p>进入容器redis-node-1并为6台机器构建集群关系</p><p>进入容器</p><p>docker exec -it redis-node-1 /bin/bash</p><p>构建主从关系</p><p>一切OK的话，3主3从搞定</p><p>链接进入6381作为切入点，查看集群状态</p><p>链接进入6381作为切入点，查看节点状态</p><p>cluster info</p><p>cluster nodes</p><p>主从容错切换迁移案例</p><p>数据读写存储</p><p>启动6机构成的集群并通过exec进入</p><p>对6381新增两个key</p><p>防止路由失效加参数-c并新增两个key</p><p>查看集群信息</p><p>容错切换迁移</p><p>主6381和从机切换，先停止主机6381</p><p>6381主机停了，对应的真实从机上位</p><p>6381作为1号主机分配的从机以实际情况为准，具体是几号机器就是几号</p><p>再次查看集群信息</p><p>先还原之前的3主3从</p><p>先启6381</p><p>docker start redis-node-1</p><p>再停6385</p><p>docker stop redis-node-5</p><p>再启6385</p><p>docker start redis-node-5</p><p>主从机器分配情况以实际情况为准</p><p>查看集群状态</p><p>redis-cli --cluster check 自己IP:6381</p><p>主从扩容案例</p><p>新建6387、6388两个节点+新建后启动+查看是否8节点</p><p>进入6387容器实例内部</p><p>docker exec -it redis-node-7 /bin/bash</p><p>将新增的6387节点(空槽号)作为master节点加入原集群</p><p>检查集群情况第1次</p><p>重新分派槽号</p><p>检查集群情况第2次</p><p>槽号分派说明</p><p>为主节点6387分配从节点6388</p><p>检查集群情况第3次</p><p>主从缩容案例</p><p>目的：6387和6388下线</p><p>检查集群情况1获得6388的节点ID</p><p>将6388删除 从集群中将4号从节点6388删除</p><p>将6387的槽号清空，重新分配，本例将清出来的槽号都给6381</p><p>检查集群情况第二次</p><p>将6387删除</p><p>检查集群情况第三次</p><h1 id="_2-dockerfile解析" tabindex="-1"><a class="header-anchor" href="#_2-dockerfile解析"><span>2 DockerFile解析</span></a></h1><h2 id="_2-1-是什么" tabindex="-1"><a class="header-anchor" href="#_2-1-是什么"><span>2.1 是什么</span></a></h2><p>Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。</p><p><strong>概述</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660012864805-18937b87-0167-4c81-9d75-f485a61c5304.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>官网</strong></p><p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/reference/builder/</a></p><p><strong>构建三步骤</strong></p><ol><li>编写Dockerfile文件</li><li>docker build 命令构建镜像</li><li>docker run 镜像 运行容器实例</li></ol><h2 id="_2-2-dockerfile构建过程解析" tabindex="-1"><a class="header-anchor" href="#_2-2-dockerfile构建过程解析"><span>2.2 DockerFile构建过程解析</span></a></h2><h3 id="_2-2-1-dockerfile内容基础知识" tabindex="-1"><a class="header-anchor" href="#_2-2-1-dockerfile内容基础知识"><span>2.2.1 Dockerfile内容基础知识</span></a></h3><ol><li>每条保留字指令都必须为大写字母且后面要跟随至少一个参数</li><li>指令按照从上到下，顺序执行</li><li>#表示注释</li><li>每条指令都会创建一个新的镜像层并对镜像进行提交</li></ol><h3 id="_2-2-2-docker执行dockerfile的大致流程" tabindex="-1"><a class="header-anchor" href="#_2-2-2-docker执行dockerfile的大致流程"><span>2.2.2 Docker执行Dockerfile的大致流程</span></a></h3><ol><li>docker从基础镜像运行一个容器</li><li>执行一条指令并对容器作出修改</li><li>执行类似docker commit的操作提交一个新的镜像层</li><li>docker再基于刚提交的镜像运行一个新容器</li><li>执行dockerfile中的下一条指令直到所有指令都执行完成</li></ol><h3 id="_2-2-3-小总结" tabindex="-1"><a class="header-anchor" href="#_2-2-3-小总结"><span>2.2.3 小总结</span></a></h3><p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</p><ul><li>Dockerfile是软件的原材料</li><li>Docker镜像是软件的交付品</li><li>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例</li></ul><p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013094449-a1af09f8-c696-4f09-a5de-6ee1844fb424.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</li><li>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;</li><li>Docker容器，容器是直接提供服务的。</li></ol><h2 id="_2-3-dockerfile常用保留字指令" tabindex="-1"><a class="header-anchor" href="#_2-3-dockerfile常用保留字指令"><span>2.3 DockerFile常用保留字指令</span></a></h2><p><strong>参考tomcat8的dockerfile入门</strong></p><p><a href="https://github.com/docker-library/tomcat" target="_blank" rel="noopener noreferrer">https://github.com/docker-library/tomcat</a></p><p><strong>FROM</strong></p><p>基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</p><p><strong>MAINTAINER</strong></p><p>镜像维护者的姓名和邮箱地址</p><p><strong>RUN</strong></p><p>容器构建时需要运行的命令</p><p>两种格式</p><ol><li>shell格式</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013238837-86e640c5-49ef-424a-81d0-bc702f35389b.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>RUN yum -y install vim</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>exec格式</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013257101-5b63a752-99eb-4678-b2de-a527717ccbcc.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>RUN是在 docker build时运行</p><p><strong>EXPOSE</strong></p><p>当前容器对外暴露出的端口</p><p><strong>WORKDIR</strong></p><p>指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</p><p><strong>USER</strong></p><p>指定该镜像以什么样的用户去执行，如果都不指定，默认是root</p><p><strong>ENV</strong></p><p>用来在构建镜像过程中设置环境变量</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ENV MY_PATH /usr/mytest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样；</p><p>也可以在其它指令中直接使用这些环境变量。</p><p>比如：<code>WORKDIR $MY_PATH</code></p><p><strong>ADD</strong></p><p>将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</p><p><strong>COPY</strong></p><p>类似ADD，拷贝文件和目录到镜像中。</p><p>将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>COPY src dest</span></span>
<span class="line"><span>COPY [&quot;src&quot;, &quot;dest&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>&lt;src源路径&gt;：源文件或者源目录</p><p>&lt;dest目标路径&gt;：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</p><p><strong>VOLUME</strong></p><p>容器数据卷，用于数据保存和持久化工作</p><p><strong>CMD</strong></p><p>指定容器启动后的要干的事情</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013470341-d8868461-36e0-412b-9763-233d14746823.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>注意：</strong></p><p>Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换。</p><p>参考官网Tomcat的dockerfile演示讲解：</p><p>官网最后一行命令</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013529609-d6979855-7c7d-4782-803c-43b2d6c871c0.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>我们演示自己的覆盖操作</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013524209-af8d1240-9240-4fa7-8582-78e3e6704212.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>它和前面RUN命令的区别</p><ul><li>CMD是在docker run 时运行。</li><li>RUN是在 docker build 时运行。</li></ul><p><strong>ENTRYPOINT</strong></p><p>也是用来指定一个容器启动时要运行的命令</p><p>类似于 CMD 指令，但是ENTRYPOINT不会被docker run后面的命令覆盖， 而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p><p>命令格式和案例说明</p><p>命令格式：</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013696660-44f47c05-55ed-49ea-b01b-d5c5ceaad1f9.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ENTRYPOINT可以和CMD一起用，一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参。</p><p>当指定了ENTRYPOINT后，CMD的含义就发生了变化，不再是直接运行其命令而是将CMD的内容作为参数传递给ENTRYPOINT指令，他两个组合会变成</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013728508-f1d618bc-11f9-4fc2-acdd-c5b111ee1804.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>案例如下：假设已通过 Dockerfile 构建了 nginx:test 镜像：</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013737191-54f5780e-bc5f-419a-92e5-95f980e7cb7d.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013973533-8d49c0c9-0ea4-45a0-b2e3-14d3f28a33a0.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>优点：在执行docker run的时候可以指定 ENTRYPOINT 运行所需的参数。</p><p>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p><p><strong>小总结</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013999567-eea06f1d-f9ac-425e-a851-c5dda92b5ce5.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="_2-4-案例" tabindex="-1"><a class="header-anchor" href="#_2-4-案例"><span>2.4 案例</span></a></h2><h3 id="_2-4-1-自定义镜像mycentosjava8" tabindex="-1"><a class="header-anchor" href="#_2-4-1-自定义镜像mycentosjava8"><span>2.4.1 自定义镜像mycentosjava8</span></a></h3><p><strong>要求</strong></p><p>Centos7镜像具备vim+ifconfig+jdk8</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014531015-748a0daa-758a-44ea-9496-34d5e34810e0.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>JDK的下载镜像地址：<a href="https://www.oracle.com/java/technologies/downloads/#java8" target="_blank" rel="noopener noreferrer">https://www.oracle.com/java/technologies/downloads/#java8</a></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014469696-1c74ba76-2119-4031-8337-4ab9880aec14.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><a href="https://mirrors.yangxingzhen.com/jdk/" target="_blank" rel="noopener noreferrer">https://mirrors.yangxingzhen.com/jdk/</a></p><p><strong>编写</strong></p><p>准备编写Dockerfile文件</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> centos</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> zzyy&lt;zzyybs@126.com&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> MYPATH /usr/local</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $MYPATH</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#安装vim编辑器</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> yum -y install vim</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#安装ifconfig命令查看网络IP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> yum -y install net-tools</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#安装java8及lib库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> yum -y install glibc.i686</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> mkdir /usr/local/java</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#ADD 是相对路径jar,把jdk-8u171-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> jdk-8u171-linux-x64.tar.gz /usr/local/java/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#配置java环境变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> JAVA_HOME /usr/local/java/jdk1.8.0_171</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> JRE_HOME $JAVA_HOME/jre</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> PATH $JAVA_HOME/bin:$PATH</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> echo $MYPATH</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;success--------------ok&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /bin/bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>大写字母D</p><p><strong>构建</strong></p><p>docker build -t 新镜像名字:TAG .</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker build -t centosjava8:1.5 .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014597535-9bd29a0a-3a5e-4e51-bad4-df136dd6c0fd.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014603485-ae9f7bae-798e-4538-9a35-05ddd6226cc5.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>注意，上面TAG后面有个空格，有个点</p><p><strong>运行</strong></p><p>docker run -it 新镜像名字:TAG</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -it centosjava8:1.5 /bin/bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014631293-415ef8b0-d5c7-4107-9c47-19b58f568931.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>再体会下UnionFS（联合文件系统）</strong></p><p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014653132-0f14d9d0-133d-436f-93ec-4a4dc6625ff4.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p><h3 id="_2-4-2-虚悬镜像" tabindex="-1"><a class="header-anchor" href="#_2-4-2-虚悬镜像"><span>2.4.2 虚悬镜像</span></a></h3><p><strong>是什么</strong></p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>仓库名、标签都是&lt;none&gt;的镜像，俗称dangling image</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Dockerfile写一个</p><ol><li><code>vim Dockerfile</code></li></ol><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>from ubuntu</span></span>
<span class="line"><span>CMD echo &#39;action is success&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><code>docker build .</code></li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014736138-8bb82a47-f06e-458d-b445-24077db9bdcd.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>查看</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker image ls -f dangling=true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>命令结果</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014743652-1ed51439-61d8-4641-b75d-529e8bc74eb6.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>删除</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker image prune</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>虚悬镜像已经失去存在价值，可以删除</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014763642-61295eb3-d313-4f8b-873c-ca674dff3b4d.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="_2-4-3-家庭作业-自定义镜像myubuntu" tabindex="-1"><a class="header-anchor" href="#_2-4-3-家庭作业-自定义镜像myubuntu"><span>2.4.3 家庭作业-自定义镜像myubuntu</span></a></h3><p><strong>编写</strong></p><p>准备编写DockerFile文件</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014788578-6dfe4fa8-d48d-402a-8c88-0ec91503aa7a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ubuntu</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> zzyy&lt;zzyybs@126.com&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> MYPATH /usr/local</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $MYPATH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> apt-get update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> apt-get install net-tools</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#RUN apt-get install -y iproute2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#RUN apt-get install -y inetutils-ping</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> echo $MYPATH</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;install inconfig cmd into ubuntu success--------------ok&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /bin/bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>构建</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker build -t 新镜像名字:TAG .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>运行</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -it 新镜像名字:TAG</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2-5-小总结" tabindex="-1"><a class="header-anchor" href="#_2-5-小总结"><span>2.5 小总结</span></a></h2><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014827592-6677a045-601e-40ae-b864-752c300a67ec.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="_3-docker微服务实战" tabindex="-1"><a class="header-anchor" href="#_3-docker微服务实战"><span>3 Docker微服务实战</span></a></h1><h2 id="_3-1-通过idea新建一个普通微服务模块" tabindex="-1"><a class="header-anchor" href="#_3-1-通过idea新建一个普通微服务模块"><span>3.1 通过IDEA新建一个普通微服务模块</span></a></h2><p><strong>建Module</strong></p><p>docker_boot</p><p><strong>改POM</strong></p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span></span>
<span class="line"><span>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></span>
<span class="line"><span>  &lt;parent&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;2.5.6&lt;/version&gt;</span></span>
<span class="line"><span>    &lt;relativePath/&gt;</span></span>
<span class="line"><span>  &lt;/parent&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  &lt;groupId&gt;com.atguigu.docker&lt;/groupId&gt;</span></span>
<span class="line"><span>  &lt;artifactId&gt;docker_boot&lt;/artifactId&gt;</span></span>
<span class="line"><span>  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  &lt;properties&gt;</span></span>
<span class="line"><span>    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span></span>
<span class="line"><span>    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span></span>
<span class="line"><span>    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span></span>
<span class="line"><span>    &lt;junit.version&gt;4.12&lt;/junit.version&gt;</span></span>
<span class="line"><span>    &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt;</span></span>
<span class="line"><span>    &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt;</span></span>
<span class="line"><span>    &lt;mysql.version&gt;5.1.47&lt;/mysql.version&gt;</span></span>
<span class="line"><span>    &lt;druid.version&gt;1.1.16&lt;/druid.version&gt;</span></span>
<span class="line"><span>    &lt;mapper.version&gt;4.1.5&lt;/mapper.version&gt;</span></span>
<span class="line"><span>    &lt;mybatis.spring.boot.version&gt;1.3.0&lt;/mybatis.spring.boot.version&gt;</span></span>
<span class="line"><span>  &lt;/properties&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  &lt;dependencies&gt;</span></span>
<span class="line"><span>    &lt;!--SpringBoot通用依赖模块--&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>      &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;!--test--&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span></span>
<span class="line"><span>      &lt;scope&gt;test&lt;/scope&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>  &lt;/dependencies&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  &lt;build&gt;</span></span>
<span class="line"><span>    &lt;plugins&gt;</span></span>
<span class="line"><span>      &lt;plugin&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span></span>
<span class="line"><span>      &lt;/plugin&gt;</span></span>
<span class="line"><span>      &lt;plugin&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</span></span>
<span class="line"><span>        &lt;version&gt;3.1.0&lt;/version&gt;</span></span>
<span class="line"><span>      &lt;/plugin&gt;</span></span>
<span class="line"><span>    &lt;/plugins&gt;</span></span>
<span class="line"><span>  &lt;/build&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>&lt;/project&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>写YML</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>server.port=6001</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>主启动</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.atguigu.docker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.boot.SpringApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.boot.autoconfigure.SpringBootApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> DockerBootApplication</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">DockerBootApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>业务类</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.atguigu.docker.controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.beans.factory.annotation.Value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RequestMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RestController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @auther zzyy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @create 2021-10-25 17:43</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> OrderController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;${server.port}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/order/docker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> helloDocker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;hello docker&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/order/index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">method</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> RequestMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;服务端口号: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2-通过dockerfile发布微服务部署到docker容器" tabindex="-1"><a class="header-anchor" href="#_3-2-通过dockerfile发布微服务部署到docker容器"><span>3.2 通过dockerfile发布微服务部署到docker容器</span></a></h2><p><strong>IDEA工具里面搞定微服务jar包</strong></p><p>docker_boot-0.0.1-SNAPSHOT.jar</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015228582-d53dce4a-89a7-4f66-bbc1-4efc307f24d3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>编写Dockerfile</strong></p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 基础镜像使用java</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> java:8</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 作者</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> zzyy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">VOLUME</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /tmp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将jar包添加到容器中并更名为zzyy_docker.jar</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 运行jar包</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> bash -c </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;touch /zzyy_docker.jar&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;java&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/zzyy_docker.jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#暴露6001端口作为微服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> 6001</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将微服务jar包和Dockerfile文件上传到同一个目录下/mydocker</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015279664-11ace734-3cac-448d-acf2-415ff4618e8e.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker build -t zzyy_docker:1.6 .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>构建镜像</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker build -t zzyy_docker:1.6 .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>打包成镜像文件</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015379854-488ba2d7-ee4a-4e28-8b07-9fa24f239263.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>运行容器</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span> docker run -d -p 6001:6001 zzyy_docker:1.6</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015407249-1b8e1153-a117-406c-bc76-f9688c909e0d.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>访问测试</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660015422129-27734091-90d4-43cf-8725-27c4eef8548e.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="_4-docker网络" tabindex="-1"><a class="header-anchor" href="#_4-docker网络"><span>4 Docker网络</span></a></h1><h2 id="是什么" tabindex="-1"><a class="header-anchor" href="#是什么"><span>是什么</span></a></h2><p><strong>docker不启动，默认网络情况</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660016500199-9bfcce87-7c5d-4ac4-8d40-3e9e9491a0fd.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ens33</p><p>lo</p><p>virbr0</p><p>在CentOS7的安装过程中如果有选择相关虚拟化的的服务安装系统后，启动网卡时会发现有一个以网桥连接的私网地址的virbr0网卡(virbr0网卡：它还有一个固定的默认IP地址192.168.122.1)，是做虚拟机网桥的使用的，其作用是为连接其上的虚机网卡提供 NAT访问外网的功能。</p><p>我们之前学习Linux安装，勾选安装系统的时候附带了libvirt服务才会生成的一个东西，如果不需要可以直接将libvirtd服务卸载，</p><p>yum remove libvirt-libs.x86_64</p><p><strong>docker启动后，网络情况</strong></p><p>会产生一个名为docker0的虚拟网桥</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660016581784-bbd7401b-0304-40e5-b3d4-143e1b6adbcd.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>查看docker网络模式命令，默认创建3大网络模式。</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660016611099-39c73410-3a1c-4576-b566-48234db9c1bc.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="常用基本命令" tabindex="-1"><a class="header-anchor" href="#常用基本命令"><span>常用基本命令</span></a></h2><p><strong>All命令</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660020074503-4a28db4d-8a0f-4f21-ab74-0b999e579207.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>查看网络</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker network ls</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>查看网络源数据</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker network inspect XXX网络名字</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>删除网络</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker network rm XXX网络名字</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>案例</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660020104133-dbc519f6-d0e1-4bec-af0c-40ec9db8d1e4.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="能干嘛" tabindex="-1"><a class="header-anchor" href="#能干嘛"><span>能干嘛</span></a></h2><p>容器间的互联和通信以及端口映射</p><p>容器IP变动时候可以通过服务名直接网络通信而不受到影响</p><h2 id="网络模式" tabindex="-1"><a class="header-anchor" href="#网络模式"><span>网络模式</span></a></h2><p><strong>总体介绍</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028923163-79ad77b4-a9ae-4dd6-8786-aacd45788733.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>bridge模式：使用--network bridge指定，默认使用docker0</p><p>host模式：使用--network host指定</p><p>none模式：使用--network none指定</p><p>container模式：使用--network container:NAME或者容器ID指定</p><p><strong>容器实例内默认网络IP生产规则</strong></p><ol><li>先启动两个ubuntu容器实例</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028984092-3cd2b316-73da-4072-b045-de7fbcb392a3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li>docker inspect 容器ID or 容器名字</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028988258-aa1db7cd-2f6f-4e08-b991-875723ee24de.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li>关闭u2实例，新建u3，查看ip变化</li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660028995174-805d3a36-8f02-4c56-a753-0048a859cd73.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>结论</p><p>docker容器内部的ip是有可能会发生改变的</p><p><strong>案例说明</strong></p><p>todo</p><p>案例说明</p><p>bridge</p><p>是什么</p><p>案例</p><p>说明</p><p>代码</p><p>docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8</p><p>docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8</p><p>两两匹配验证</p><p>host</p><p>是什么</p><p>案例</p><p>说明</p><p>代码</p><p>警告</p><p>docker run -d -p 8083:8080 --network host --name tomcat83 billygoo/tomcat8-jdk8</p><p>正确</p><p>docker run -d --network host --name tomcat83 billygoo/tomcat8-jdk8</p><p>无之前的配对显示了，看容器实例内部</p><p>没有设置-p的端口映射了，如何访问启动的tomcat83？？</p><p>none</p><p>是什么</p><p>禁用网络功能，只有lo标识(就是127.0.0.1表示本地回环)</p><p>案例</p><p>docker run -d -p 8084:8080 --network none --name tomcat84 billygoo/tomcat8-jdk8</p><p>container</p><p>是什么</p><p>案例</p><p>docker run -d -p 8085:8080 --name tomcat85 billygoo/tomcat8-jdk8</p><p>docker run -d -p 8086:8080 --network container:tomcat85 --name tomcat86 billygoo/tomcat8-jdk8</p><p>运行结果</p><p>案例2</p><p>Alpine操作系统是一个面向安全的轻型 Linux发行版</p><p>docker run -it --name alpine1 alpine /bin/sh</p><p>docker run -it --network container:alpine1 --name alpine2 alpine /bin/sh</p><p>运行结果，验证共用搭桥</p><p>假如此时关闭alpine1，再看看alpine2</p><p>自定义网络</p><p>过时的link</p><p>是什么</p><p>案例</p><p>before</p><p>案例</p><p>docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8</p><p>docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8</p><p>上述成功启动并用docker exec进入各自容器实例内部</p><p>问题</p><p>按照IP地址ping是OK的</p><p>按照服务名ping结果???</p><p>after</p><p>案例</p><p>自定义桥接网络,自定义网络默认使用的是桥接网络bridge</p><p>新建自定义网络</p><p>新建容器加入上一步新建的自定义网络</p><p>docker run -d -p 8081:8080 --network zzyy_network --name tomcat81 billygoo/tomcat8-jdk8</p><p>docker run -d -p 8082:8080 --network zzyy_network --name tomcat82 billygoo/tomcat8-jdk8</p><p>互相ping测试</p><p>问题结论</p><p>自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</p><p>自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</p><p>自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</p><h2 id="docker平台架构图解" tabindex="-1"><a class="header-anchor" href="#docker平台架构图解"><span>Docker平台架构图解</span></a></h2><p><strong>整体说明</strong></p><p>从其架构和运行流程来看，Docker 是一个 C/S 模式的架构，后端是一个松耦合架构，众多模块各司其职。</p><p>Docker 运行的基本流程为：</p><p>1 用户是使用 Docker Client 与 Docker Daemon 建立通信，并发送请求给后者。</p><p>2 Docker Daemon 作为 Docker 架构中的主体部分，首先提供 Docker Server 的功能使其可以接受 Docker Client 的请求。</p><p>3 Docker Engine 执行 Docker 内部的一系列工作，每一项工作都是以一个 Job 的形式的存在。</p><p>4 Job 的运行过程中，当需要容器镜像时，则从 Docker Registry 中下载镜像，并通过镜像管理驱动 Graph driver将下载镜像以Graph的形式存储。</p><p>5 当需要为 Docker 创建网络环境时，通过网络管理驱动 Network driver 创建并配置 Docker 容器网络环境。</p><p>6 当需要限制 Docker 容器运行资源或执行用户指令等操作时，则通过 Execdriver 来完成。</p><p>7 Libcontainer是一项独立的容器管理包，Network driver以及Exec driver都是通过Libcontainer来实现具体对容器进行的操作。</p><p><strong>整体架构</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660032915706-ca6ff6ae-5f12-4932-9a51-934cd86d5222.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="_5-docker-compose容器编排" tabindex="-1"><a class="header-anchor" href="#_5-docker-compose容器编排"><span>5 Docker-compose容器编排</span></a></h1><p>Docker-compose容器编排</p><p>是什么</p><p>Docker-Compose是Docker官方的开源项目， 负责实现对Docker容器集群的快速编排。</p><p>能干嘛</p><p>去哪下</p><p>官网</p><p><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p><p>官网下载</p><p><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/install/</a></p><p>安装步骤</p><p>卸载步骤</p><p>Compose核心概念</p><p>一文件</p><p>docker-compose.yml</p><p>两要素</p><p>服务（service）</p><p>一个个应用容器实例，比如订单微服务、库存微服务、mysql容器、nginx容器或者redis容器</p><p>工程（project）</p><p>由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</p><p>Compose使用的三个步骤</p><p>编写Dockerfile定义各个微服务应用并构建出对应的镜像文件</p><p>使用 docker-compose.yml 定义一个完整业务单元，安排好整体应用中的各个容器服务。</p><p>最后，执行docker-compose up命令 来启动并运行整个应用程序，完成一键部署上线</p><p>Compose常用命令</p><p>Compose编排微服务</p><p>改造升级微服务工程docker_boot</p><p>以前的基础版</p><p>SQL建表建库</p><p>一键生成说明</p><p>改POM</p><p>写YML</p><p>主启动</p><p>业务类</p><p>mvn package命令将微服务形成新的jar包 并上传到Linux服务器/mydocker目录下</p><p>编写Dockerfile</p><p>构建镜像</p><p>docker build -t zzyy_docker:1.6 .</p><p>不用Compose</p><p>单独的mysql容器实例</p><p>新建mysql容器实例</p><p>进入mysql容器实例并新建库db2021+新建表t_user</p><p>单独的redis容器实例</p><p>微服务工程</p><p>上面三个容器实例依次顺序启动成功</p><p>swagger测试</p><p><a href="http://localhost" target="_blank" rel="noopener noreferrer">http://localhost</a>:你的微服务端口/swagger-ui.html#/</p><p>上面成功了，有哪些问题?</p><p>先后顺序要求固定，先mysql+redis才能微服务访问成功</p><p>多个run命令......</p><p>容器间的启停或宕机，有可能导致IP地址对应的容器实例变化，映射出错， 要么生产IP写死(可以但是不推荐)，要么通过服务调用</p><p>使用Compose</p><p>服务编排，一套带走，安排</p><p>编写docker-compose.yml文件</p><p>第二次修改微服务工程docker_boot</p><p>写YML</p><p>通过服务名访问，IP无关</p><p>mvn package命令将微服务形成新的jar包 并上传到Linux服务器/mydocker目录下</p><p>编写Dockerfile</p><p>构建镜像</p><p>docker build -t zzyy_docker:1.6 .</p><p>执行 docker-compose up 或者 执行 docker-compose up -d</p><p>进入mysql容器实例并新建库db2021+新建表t_user</p><p>测试通过</p><p>Compose常用命令</p><p>关停</p><h1 id="_6-docker轻量级可视化工具portainer" tabindex="-1"><a class="header-anchor" href="#_6-docker轻量级可视化工具portainer"><span>6 Docker轻量级可视化工具Portainer</span></a></h1><h2 id="是什么-1" tabindex="-1"><a class="header-anchor" href="#是什么-1"><span>是什么</span></a></h2><p>Portainer 是一款轻量级的应用，它提供了图形化界面，用于方便地管理Docker环境，包括单机环境和集群环境。</p><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p><strong>官网</strong></p><p><a href="https://www.portainer.io/" target="_blank" rel="noopener noreferrer">https://www.portainer.io/</a></p><p><a href="https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux" target="_blank" rel="noopener noreferrer">https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux</a></p><p><strong>步骤</strong></p><ol><li><strong>docker命令安装</strong></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 8000:8000</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 9000:9000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">--name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> portainer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">always</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-v</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/run/docker.sock:/var/run/docker.sock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-v</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> portainer_data:/data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">portainer/portainer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><strong>第一次登录需创建admin，访问地址：<a href="http://xxx.xxx.xxx.xxx:9000" target="_blank" rel="noopener noreferrer">xxx.xxx.xxx.xxx:9000</a></strong></li></ol><p>用户名，直接用默认admin</p><p>密码记得8位，随便你写</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033430938-9526470c-089a-4cde-8ee9-5bd3328f32fb.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><strong>设置admin用户和密码后首次登陆</strong></li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033444646-6696d6a3-ca9b-4546-88a4-89909eddf89d.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><strong>选择local选项卡后本地docker详细信息展示</strong></li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033451033-300878aa-e6ba-42f1-9264-be57d65b87b3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><strong>上一步的图形展示，能想得起对应命令吗？</strong></li></ol><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660033457920-8e9618b2-6979-4d7c-8071-a2a098dc1128.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="登陆并演示介绍常用操作case" tabindex="-1"><a class="header-anchor" href="#登陆并演示介绍常用操作case"><span>登陆并演示介绍常用操作case</span></a></h2><h1 id="_7-docker容器监控之-cadvisor-influxdb-granfana" tabindex="-1"><a class="header-anchor" href="#_7-docker容器监控之-cadvisor-influxdb-granfana"><span>7 Docker容器监控之 CAdvisor+InfluxDB+Granfana</span></a></h1><p>Docker容器监控之 CAdvisor+InfluxDB+Granfana</p><p>原生命令</p><p>操作</p><p>问题</p><p>是什么</p><p>容器监控3剑客</p><p>一句话</p><p>CAdvisor监控收集+InfluxDB存储数据+Granfana展示图表</p><p>CAdvisor</p><p>InfluxDB</p><p>Granfana</p><p>总结</p><p>compose容器编排，一套带走</p><p>新建目录</p><p>新建3件套组合的 docker-compose.yml</p><p>启动docker-compose文件</p><p>docker-compose up</p><p>查看三个服务容器是否启动</p><p>测试</p><p>浏览cAdvisor收集服务，<a href="http://ip:8080/" target="_blank" rel="noopener noreferrer">http://ip:8080/</a></p><p>第一次访问慢，请稍等</p><p>cadvisor也有基础的图形展现功能，这里主要用它来作数据采集</p><p>浏览influxdb存储服务，<a href="http://ip:8083/" target="_blank" rel="noopener noreferrer">http://ip:8083/</a></p><p>浏览grafana展现服务，<a href="http://ip:3000" target="_blank" rel="noopener noreferrer">http://ip:3000</a></p><p>ip+3000端口的方式访问,默认帐户密码（admin/admin）</p><p>配置步骤</p><p>配置数据源</p><p>选择influxdb数据源</p><p>配置细节</p><p>1</p><p>2</p><p>配置面板panel</p><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>到这里cAdvisor+InfluxDB+Grafana容器监控系统就部署完成了</p><h1 id="_8-终章の总结" tabindex="-1"><a class="header-anchor" href="#_8-终章の总结"><span>8 终章の总结</span></a></h1><p>知识回顾简单串讲和总结</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660034195809-591c7f4b-dd7b-46a2-9865-7e2c01ae8239.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>进阶篇：雷丰阳老师的K8S</p><p>参考：</p><p><a href="https://www.yuque.com/li.xx/open/mw2ahb" target="_blank" rel="noopener noreferrer">https://www.yuque.com/li.xx/open/mw2ahb</a></p><p><a href="https://www.yuque.com/tmfl/cloud/cmnbme" target="_blank" rel="noopener noreferrer">https://www.yuque.com/tmfl/cloud/cmnbme</a></p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/justdoitMr/blogs//edit/master/themeHope/ContainerCloud/docker/act_two_docker_two.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2284609302@qq.com">不爱打代码的程序员</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/ContainerCloud/docker/act_one_docker_one.html" aria-label="1、Docker基础"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon iconfont icon-file" style=""></span>1、Docker基础</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">云原生</div><div class="vp-copyright">bugcode</div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.e972e9bb.js" defer></script><script src="/assets/js/9547.c8ff98a9.js" defer></script><script src="/assets/js/app.8a0774db.js" defer></script>
  </body>
</html>
