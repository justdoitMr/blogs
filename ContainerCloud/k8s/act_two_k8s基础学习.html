<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.47" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.bugcode.online/ContainerCloud/k8s/act_two_k8s%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0.html"><meta property="og:site_name" content="bugcode çš„æ¶æ„ä¹‹è·¯"><meta property="og:title" content="3ã€K8SåŸºç¡€å­¦ä¹ "><meta property="og:description" content="3ã€K8SåŸºç¡€å­¦ä¹  1.1 kubernetesç»„ä»¶ ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±æ§åˆ¶èŠ‚ç‚¹(master)ã€**å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚ masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† ) ApiServer : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ Sche..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-08-13T07:13:35.000Z"><meta property="article:author" content="bugcode"><meta property="article:tag" content="DOCKER"><meta property="article:tag" content="äº‘åŸç”Ÿ"><meta property="article:tag" content="K8S"><meta property="article:published_time" content="2020-01-01T00:00:00.000Z"><meta property="article:modified_time" content="2024-08-13T07:13:35.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"3ã€K8SåŸºç¡€å­¦ä¹ ","image":[""],"datePublished":"2020-01-01T00:00:00.000Z","dateModified":"2024-08-13T07:13:35.000Z","author":[{"@type":"Person","name":"bugcode"}]}</script><meta name="robots" content="all"><meta name="author" content="bugcode"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="Java, JavaåŸºç¡€, å¹¶å‘ç¼–ç¨‹, JVM, è™šæ‹Ÿæœº, æ•°æ®åº“, MySQL, Spring, Redis, MyBatis, SpringBoot, IDEA, æ±‚èŒé¢è¯•, é¢æ¸£é€†è¢­, å­¦ä¹ è·¯çº¿"><meta name="apple-mobile-web-app-capable" content="yes"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4570931_i3acfllzyt.css"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><title>3ã€K8SåŸºç¡€å­¦ä¹  | bugcode çš„æ¶æ„ä¹‹è·¯</title><meta name="description" content="3ã€K8SåŸºç¡€å­¦ä¹  1.1 kubernetesç»„ä»¶ ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±æ§åˆ¶èŠ‚ç‚¹(master)ã€**å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚ masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† ) ApiServer : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ Sche...">
    <link rel="stylesheet" href="/assets/css/styles.6b04e72b.css">
    <link rel="preload" href="/assets/js/runtime~app.5e82dcee.js" as="script"><link rel="preload" href="/assets/css/styles.6b04e72b.css" as="style"><link rel="preload" href="/assets/js/9547.c8ff98a9.js" as="script"><link rel="preload" href="/assets/js/app.318c5c67.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://vscodepic.oss-cn-beijing.aliyuncs.com/blog/log.jpg" alt><!----><span class="vp-site-name hide-in-pad">bugcode çš„æ¶æ„ä¹‹è·¯</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/introduction/" aria-label="å¯¼è¯»"><!--[--><span class="font-icon icon iconfont icon-book" style=""></span><!--]-->å¯¼è¯»<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç®—æ³•"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>ç®—æ³•<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/algor/" aria-label="ç®—æ³•ä¸“é¢˜"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->ç®—æ³•ä¸“é¢˜<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/dataStructure/" aria-label="æ•°æ®ç»“æ„ä¸“é¢˜"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->æ•°æ®ç»“æ„ä¸“é¢˜<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="è®¾è®¡æ¨¡å¼"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>è®¾è®¡æ¨¡å¼<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/designPrinciple/" aria-label="è®¾è®¡åŸåˆ™"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->è®¾è®¡åŸåˆ™<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/creational/" aria-label="åˆ›å»ºå‹"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->åˆ›å»ºå‹<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/Behavior/" aria-label="è¡Œä¸ºå‹"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->è¡Œä¸ºå‹<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/designpattern/structural/" aria-label="ç»“æ„å‹"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->ç»“æ„å‹<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æºç "><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>æºç <!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/frameDesignAndSourceCode/springSourceCode/" aria-label="Springæºç å®ç°"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Springæºç å®ç°<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/frameDesignAndSourceCode/mybatisSourceCode/" aria-label="Mybatisæ¡†æ¶å®ç°"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->Mybatisæ¡†æ¶å®ç°<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ¶æ„ä¸“é¢˜"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>æ¶æ„ä¸“é¢˜<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/engineeringArchitectureDesign/" aria-label="MVCå’ŒDDD"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->MVCå’ŒDDD<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç²¾é€‰åšæ–‡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>ç²¾é€‰åšæ–‡<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">ä¸šåŠ¡çŸ¥è¯†</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/excellentBook/business/" aria-label="é‡‘èä¸šåŠ¡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->é‡‘èä¸šåŠ¡<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">é¡¹ç›®ç»éªŒ</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/excellentBook/project/" aria-label="K8Séƒ¨ç½²é¡¹ç›®"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->K8Séƒ¨ç½²é¡¹ç›®<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/excellentBook/" aria-label="é€šç”¨æ•°æ®è®¾è®¡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->é€šç”¨æ•°æ®è®¾è®¡<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/excellentBook/scence.html" aria-label="ä¸šåŠ¡åœºæ™¯è®¾è®¡"><!--[--><span class="font-icon icon iconfont icon-pen-to-square" style=""></span><!--]-->ä¸šåŠ¡åœºæ™¯è®¾è®¡<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/home.html" aria-label="åŸºç¡€å½’æ¡£"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->åŸºç¡€å½’æ¡£<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/k8s/" aria-label="é¢è¯•ç¯‡"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->é¢è¯•ç¯‡<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/KnowledgePlanet/" aria-label="çŸ¥è¯†æ˜Ÿçƒ"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->çŸ¥è¯†æ˜Ÿçƒ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/KnowledgePlanet/" aria-label="Bç«™"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->Bç«™<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/about/" aria-label="å…³äºæˆ‘"><!--[--><span class="font-icon icon iconfont icon-book" style=""></span><!--]-->å…³äºæˆ‘<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/justdoitMr/blogs/" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ä¸€ã€å¯¼è¯»</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">äºŒã€javaæ ¸å¿ƒ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ä¸‰ã€Springç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å››ã€å¤§æ•°æ®ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">äº”ã€äº‘åŸç”Ÿ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">1ã€Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">2ã€K8S</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ContainerCloud/k8s/act_one_k8s%E4%B8%AD%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8E%9F%E7%90%86.md.html" aria-label="1ã€K8sä¸­è´Ÿè½½å‡è¡¡åŸç†"><!--[--><span class="font-icon icon iconfont icon-file" style=""></span><!--]-->1ã€K8sä¸­è´Ÿè½½å‡è¡¡åŸç†<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ContainerCloud/k8s/act_none_pod%E5%BC%82%E5%B8%B8%E7%8A%B6%E6%80%81%E6%8E%92%E6%9F%A5.html" aria-label="2ã€Podå¼‚å¸¸çŠ¶æ€æ’é”™"><!--[--><span class="font-icon icon iconfont icon-file" style=""></span><!--]-->2ã€Podå¼‚å¸¸çŠ¶æ€æ’é”™<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/ContainerCloud/k8s/act_two_k8s%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0.html" aria-label="3ã€K8SåŸºç¡€å­¦ä¹ "><!--[--><span class="font-icon icon iconfont icon-file" style=""></span><!--]-->3ã€K8SåŸºç¡€å­¦ä¹ <!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">äº”ã€å‰ç«¯ç¯‡</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-file" style=""></span>3ã€K8SåŸºç¡€å­¦ä¹ </h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">bugcode</span></span><span property="author" content="bugcode"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2020-01-01T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 93 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT93M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color0 clickable" role="navigation">K8S</span><span class="page-category-item color2 clickable" role="navigation">DOCKER</span><span class="page-category-item color5 clickable" role="navigation">JAVA</span><!--]--><meta property="articleSection" content="K8S,DOCKER,JAVA"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">DOCKER</span><span class="page-tag-item color5 clickable" role="navigation">äº‘åŸç”Ÿ</span><span class="page-tag-item color0 clickable" role="navigation">K8S</span><!--]--><meta property="keywords" content="DOCKER,äº‘åŸç”Ÿ,K8S"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-1-kubernetesç»„ä»¶">1.1 kubernetesç»„ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-kubernetesæ¦‚å¿µ">1.2 kubernetesæ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-1-èµ„æºç®¡ç†ä»‹ç»">3.1 èµ„æºç®¡ç†ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-2-yamlè¯­è¨€ä»‹ç»">3.2 YAMLè¯­è¨€ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-3-èµ„æºç®¡ç†æ–¹å¼">3.3 èµ„æºç®¡ç†æ–¹å¼</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†">3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®">3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-1-namespace">4.1 Namespace</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-2-pod">4.2 Pod</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-3-label">4.3 Label</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-4-deployment">4.4 Deployment</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-5-service">4.5 Service</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-1-podä»‹ç»">5.1 Podä»‹ç»</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-1-1-podç»“æ„">5.1.1 Podç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-1-2-podå®šä¹‰">5.1.2 Podå®šä¹‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-2-podé…ç½®">5.2 Podé…ç½®</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-1-åŸºæœ¬é…ç½®">5.2.1 åŸºæœ¬é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-2-é•œåƒæ‹‰å–">5.2.2 é•œåƒæ‹‰å–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-3-å¯åŠ¨å‘½ä»¤">5.2.3 å¯åŠ¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-4-ç¯å¢ƒå˜é‡">5.2.4 ç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-5-ç«¯å£è®¾ç½®">5.2.5 ç«¯å£è®¾ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-2-6-èµ„æºé…é¢">5.2.6 èµ„æºé…é¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-3-podç”Ÿå‘½å‘¨æœŸ">5.3 Podç”Ÿå‘½å‘¨æœŸ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-1-åˆ›å»ºå’Œç»ˆæ­¢">5.3.1 åˆ›å»ºå’Œç»ˆæ­¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-2-åˆå§‹åŒ–å®¹å™¨">5.3.2 åˆå§‹åŒ–å®¹å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-3-é’©å­å‡½æ•°">5.3.3 é’©å­å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-4-å®¹å™¨æ¢æµ‹">5.3.4 å®¹å™¨æ¢æµ‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-3-5-é‡å¯ç­–ç•¥">5.3.5 é‡å¯ç­–ç•¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-4-podè°ƒåº¦">5.4 Podè°ƒåº¦</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-4-1-å®šå‘è°ƒåº¦ã€å¼ºåˆ¶ç­–ç•¥ã€‘">5.4.1 å®šå‘è°ƒåº¦ã€å¼ºåˆ¶ç­–ç•¥ã€‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-4-2-äº²å’Œæ€§è°ƒåº¦">5.4.2 äº²å’Œæ€§è°ƒåº¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-4-3-æ±¡ç‚¹å’Œå®¹å¿">5.4.3 æ±¡ç‚¹å’Œå®¹å¿</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-1-podæ§åˆ¶å™¨ä»‹ç»">6.1 Podæ§åˆ¶å™¨ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-2-replicaset-rs">6.2 ReplicaSet(RS)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#replicaset-demo">ReplicaSet Demo</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‰©ç¼©å®¹">æ‰©ç¼©å®¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é•œåƒå‡çº§">é•œåƒå‡çº§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ é™¤replicaset">åˆ é™¤ReplicaSet</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-3-deployment-deploy">6.3 Deployment(Deploy)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‰©ç¼©å®¹-1">æ‰©ç¼©å®¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é•œåƒæ›´æ–°">é•œåƒæ›´æ–°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç‰ˆæœ¬å›é€€">ç‰ˆæœ¬å›é€€</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-4-horizontal-pod-autoscaler-hpa">6.4 Horizontal Pod Autoscaler(HPA)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-5-daemonset-ds">6.5 DaemonSet(DS)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-6-job">6.6 Job</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-7-cronjob-cj">6.7 CronJob(CJ)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-1-serviceä»‹ç»">7.1 Serviceä»‹ç»</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#userspace-æ¨¡å¼">userspace æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#iptables-æ¨¡å¼">iptables æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ipvs-æ¨¡å¼">ipvs æ¨¡å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-2-serviceç±»å‹">7.2 Serviceç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-3-serviceä½¿ç”¨">7.3 Serviceä½¿ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-1-å®éªŒç¯å¢ƒå‡†å¤‡">7.3.1 å®éªŒç¯å¢ƒå‡†å¤‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-2-clusteripç±»å‹çš„service">7.3.2 ClusterIPç±»å‹çš„Service</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-3-headlinessç±»å‹çš„service">7.3.3 HeadLinessç±»å‹çš„Service</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-4-nodeportç±»å‹çš„service">7.3.4 NodePortç±»å‹çš„Service</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-5-loadbalancerç±»å‹çš„service">7.3.5 LoadBalancerç±»å‹çš„Service</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-3-6-externalnameç±»å‹çš„service">7.3.6 ExternalNameç±»å‹çš„Service</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-4-ingressä»‹ç»">7.4 Ingressä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-5-ingressä½¿ç”¨">7.5 Ingressä½¿ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-5-1-ç¯å¢ƒå‡†å¤‡">7.5.1 ç¯å¢ƒå‡†å¤‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-5-2-httpä»£ç†">7.5.2 Httpä»£ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-5-3-httpsä»£ç†">7.5.3 Httpsä»£ç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8-1-åŸºæœ¬å­˜å‚¨">8.1 åŸºæœ¬å­˜å‚¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-1-1-emptydir">8.1.1 EmptyDir</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-1-2-hostpath">8.1.2 HostPath</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-1-3-nfs">8.1.3 NFS</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8-2-é«˜çº§å­˜å‚¨">8.2 é«˜çº§å­˜å‚¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-2-1-pv">8.2.1 PV</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-2-2-pvc">8.2.2 PVC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-2-3-ç”Ÿå‘½å‘¨æœŸ">8.2.3 ç”Ÿå‘½å‘¨æœŸ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8-3-é…ç½®å­˜å‚¨">8.3 é…ç½®å­˜å‚¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-3-1-configmap">8.3.1 ConfigMap</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-3-2-secret">8.3.2 Secret</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9-1-è®¿é—®æ§åˆ¶æ¦‚è¿°">9.1 è®¿é—®æ§åˆ¶æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9-2-è¯ç®¡ç†">9.2 è¯ç®¡ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9-3-æˆæƒç®¡ç†">9.3 æˆæƒç®¡ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9-4-å‡†å…¥æ§åˆ¶">9.4 å‡†å…¥æ§åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10-1-éƒ¨ç½²dashboard">10.1 éƒ¨ç½²Dashboard</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10-2-ä½¿ç”¨dashboard">10.2 ä½¿ç”¨DashBoard</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="_3ã€k8såŸºç¡€å­¦ä¹ " tabindex="-1"><a class="header-anchor" href="#_3ã€k8såŸºç¡€å­¦ä¹ "><span>3ã€K8SåŸºç¡€å­¦ä¹ </span></a></h1><h2 id="_1-1-kubernetesç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-1-kubernetesç»„ä»¶"><span>1.1 kubernetesç»„ä»¶</span></a></h2><p>ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±<strong>æ§åˆ¶èŠ‚ç‚¹(master)</strong>ã€**å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚<br><strong>masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† )</strong></p><ul><li><strong>ApiServer</strong> : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶</li><li><strong>Scheduler</strong> : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„nodeèŠ‚ç‚¹ä¸Š</li><li><strong>ControllerManager</strong> : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰</li><li><strong>Etcd</strong> ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯</li></ul><p><strong>nodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ( å¹²æ´» )</strong></p><ul><li><strong>Kubelet</strong> : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨</li><li><strong>KubeProxy</strong> : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li><li><strong>Docker</strong> : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ</li></ul><h2 id="_1-2-kubernetesæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-2-kubernetesæ¦‚å¿µ"><span>1.2 kubernetesæ¦‚å¿µ</span></a></h2><p><strong>Pod</strong>ï¼škubernetesçš„æœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨podä¸­çš„ï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨<br><strong>Controller</strong>ï¼šæ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ¥å®ç°å¯¹podçš„ç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨podã€åœæ­¢podã€ä¼¸ç¼©podçš„æ•°é‡ç­‰ç­‰<br><strong>Service</strong>ï¼špodå¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä¸‹é¢å¯ä»¥ç»´æŠ¤è€…åŒä¸€ç±»çš„å¤šä¸ªpod<br><strong>Label</strong>ï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹podè¿›è¡Œåˆ†ç±»ï¼ŒåŒä¸€ç±»podä¼šæ‹¥æœ‰ç›¸åŒçš„æ ‡ç­¾<br><strong>NameSpace</strong>ï¼šå‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦»podçš„è¿è¡Œç¯å¢ƒ</p><h1 id="_2-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_2-éƒ¨ç½²"><span>2. éƒ¨ç½²</span></a></h1><p>è§ <a href="http://xn--Linux-vm4i563njxto39a.md" target="_blank" rel="noopener noreferrer">Linuxç¯å¢ƒéƒ¨ç½².md</a></p><h1 id="_3-èµ„æºç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_3-èµ„æºç®¡ç†"><span>3. èµ„æºç®¡ç†</span></a></h1><h2 id="_3-1-èµ„æºç®¡ç†ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-1-èµ„æºç®¡ç†ä»‹ç»"><span>3.1 èµ„æºç®¡ç†ä»‹ç»</span></a></h2><p>åœ¨kubernetesä¸­ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ“ä½œèµ„æºæ¥ç®¡ç†kubernetesã€‚<br> kubernetesçš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å„ç§æœåŠ¡ï¼Œæ‰€è°“çš„éƒ¨ç½²æœåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨kubernetesé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼Œå¹¶å°†æŒ‡å®šçš„ç¨‹åºè·‘åœ¨å®¹å™¨ä¸­ã€‚<br> kubernetesçš„æœ€å°ç®¡ç†å•å…ƒæ˜¯podè€Œä¸æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥åªèƒ½å°†å®¹å™¨æ”¾åœ¨Podä¸­ï¼Œè€Œkubernetesä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥ç®¡ç†Podçš„ã€‚<br> Podå¯ä»¥æä¾›æœåŠ¡ä¹‹åï¼Œå°±è¦è€ƒè™‘å¦‚ä½•è®¿é—®Podä¸­æœåŠ¡ï¼Œkubernetesæä¾›äº†Serviceèµ„æºå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚<br> å½“ç„¶ï¼Œå¦‚æœPodä¸­ç¨‹åºçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œkubernetesè¿˜æä¾›äº†å„ç§å­˜å‚¨ç³»ç»Ÿã€‚<br> å­¦ä¹ kubernetesçš„æ ¸å¿ƒï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•å¯¹é›†ç¾¤ä¸Šçš„Podã€Podæ§åˆ¶å™¨ã€Serviceã€å­˜å‚¨ç­‰å„ç§èµ„æºè¿›è¡Œæ“ä½œ</p><h2 id="_3-2-yamlè¯­è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-2-yamlè¯­è¨€ä»‹ç»"><span>3.2 YAMLè¯­è¨€ä»‹ç»</span></a></h2><p>åŸºæœ¬å˜é‡</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># çº¯é‡, å°±æ˜¯æŒ‡çš„ä¸€ä¸ªç®€å•çš„å€¼ï¼Œå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€Nullã€æ—¶é—´ã€æ—¥æœŸ</span></span>
<span class="line"><span># 1 å¸ƒå°”ç±»å‹</span></span>
<span class="line"><span>c1: true (æˆ–è€…True)</span></span>
<span class="line"><span># 2 æ•´å‹</span></span>
<span class="line"><span>c2: 234</span></span>
<span class="line"><span># 3 æµ®ç‚¹å‹</span></span>
<span class="line"><span>c3: 3.14</span></span>
<span class="line"><span># 4 nullç±»å‹ </span></span>
<span class="line"><span>c4: ~  </span></span>
<span class="line"><span># 5 æ—¥æœŸç±»å‹</span></span>
<span class="line"><span>c5: 2018-02-17    # æ—¥æœŸå¿…é¡»ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œå³yyyy-MM-dd</span></span>
<span class="line"><span># 6 æ—¶é—´ç±»å‹</span></span>
<span class="line"><span>c6: 2018-02-17T15:02:31+08:00  # æ—¶é—´ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œæ—¶é—´å’Œæ—¥æœŸä¹‹é—´ä½¿ç”¨Tè¿æ¥ï¼Œæœ€åä½¿ç”¨+ä»£è¡¨æ—¶åŒº</span></span>
<span class="line"><span># 7 å­—ç¬¦ä¸²ç±»å‹</span></span>
<span class="line"><span>c7: heima     # ç®€å•å†™æ³•ï¼Œç›´æ¥å†™å€¼ , å¦‚æœå­—ç¬¦ä¸²ä¸­é—´æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·åŒ…è£¹ </span></span>
<span class="line"><span>c8: line1</span></span>
<span class="line"><span>    line2     # å­—ç¬¦ä¸²è¿‡å¤šçš„æƒ…å†µå¯ä»¥æ‹†æˆå¤šè¡Œï¼Œæ¯ä¸€è¡Œä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªç©ºæ ¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹è±¡</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å¯¹è±¡</span></span>
<span class="line"><span># å½¢å¼ä¸€(æ¨è):</span></span>
<span class="line"><span>heima:</span></span>
<span class="line"><span>  age: 15</span></span>
<span class="line"><span>  address: Beijing</span></span>
<span class="line"><span># å½¢å¼äºŒ(äº†è§£):</span></span>
<span class="line"><span>heima: {age: 15,address: Beijing}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ•°ç»„</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æ•°ç»„</span></span>
<span class="line"><span># å½¢å¼ä¸€(æ¨è):</span></span>
<span class="line"><span>address:</span></span>
<span class="line"><span>  - é¡ºä¹‰</span></span>
<span class="line"><span>  - æ˜Œå¹³  </span></span>
<span class="line"><span># å½¢å¼äºŒ(äº†è§£):</span></span>
<span class="line"><span>address: [é¡ºä¹‰,æ˜Œå¹³]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-èµ„æºç®¡ç†æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_3-3-èµ„æºç®¡ç†æ–¹å¼"><span>3.3 èµ„æºç®¡ç†æ–¹å¼</span></a></h2><p>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å»æ“ä½œkubernetesèµ„æº<br><strong>kubectl run nginx-pod --image=nginx:1.17.1 --port=80</strong></p><ul><li>å‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤é…ç½®å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº<strong>kubectl create/patch -f nginx-pod.yaml</strong></li><li>å£°æ˜å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡applyå‘½ä»¤å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº<strong>kubectl apply -f nginx-pod.yaml</strong></li></ul><table><thead><tr><th>ç±»å‹</th><th>æ“ä½œå¯¹è±¡</th><th>é€‚ç”¨ç¯å¢ƒ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</td><td>å¯¹è±¡</td><td>æµ‹è¯•</td><td>ç®€å•</td><td>åªèƒ½æ“ä½œæ´»åŠ¨å¯¹è±¡ï¼Œæ— æ³•å®¡è®¡ã€è·Ÿè¸ª</td></tr><tr><td>å‘½ä»¤å¼å¯¹è±¡é…ç½®</td><td>æ–‡ä»¶</td><td>å¼€å‘</td><td>å¯ä»¥å®¡è®¡ã€è·Ÿè¸ª</td><td>é¡¹ç›®å¤§æ—¶ï¼Œé…ç½®æ–‡ä»¶å¤šï¼Œæ“ä½œéº»çƒ¦</td></tr><tr><td>å£°æ˜å¼å¯¹è±¡é…ç½®</td><td>ç›®å½•</td><td>å¼€å‘</td><td>æ”¯æŒç›®å½•æ“ä½œ</td><td>æ„å¤–æƒ…å†µä¸‹éš¾ä»¥è°ƒè¯•</td></tr></tbody></table><h3 id="_3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†"><span>3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</span></a></h3><p><strong>kubectlå‘½ä»¤</strong><br> kubectlæ˜¯kubernetesé›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²ã€‚kubectlå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl [command] [type] [name] [flags]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>comand</strong>ï¼šæŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚createã€getã€delete<br><strong>type</strong>ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼Œæ¯”å¦‚deploymentã€podã€service<br><strong>name</strong>ï¼šæŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ<br><strong>flags</strong>ï¼šæŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æŸ¥çœ‹æ‰€æœ‰pod</span></span>
<span class="line"><span>kubectl get pod --kubecongig config -n namespace</span></span>
<span class="line"><span># æŸ¥çœ‹æŸä¸ªpod</span></span>
<span class="line"><span>kubectl get pod pod_name --kubecongig config -n namespace</span></span>
<span class="line"><span># æŸ¥çœ‹æŸä¸ªpod,ä»¥yamlæ ¼å¼å±•ç¤ºç»“æœ</span></span>
<span class="line"><span>kubectl get pod pod_name -o yaml --kubecongig config -n namespace</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>èµ„æºç±»å‹</strong><br> kubernetesä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl api-resources</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›ï¼š</p><table><thead><tr><th>èµ„æºåˆ†ç±»</th><th>èµ„æºåç§°</th><th>ç¼©å†™</th><th>èµ„æºä½œç”¨</th></tr></thead><tbody><tr><td>é›†ç¾¤çº§åˆ«èµ„æº</td><td>nodes</td><td>no</td><td>é›†ç¾¤ç»„æˆéƒ¨åˆ†</td></tr><tr><td>namespaces</td><td>ns</td><td>éš”ç¦»Pod</td><td></td></tr><tr><td>podèµ„æº</td><td>pods</td><td>po</td><td>è£…è½½å®¹å™¨</td></tr><tr><td>podèµ„æºæ§åˆ¶å™¨</td><td>replicationcontrollers</td><td>rc</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>replicasets</td><td>rs</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>deployments</td><td>deploy</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>daemonsets</td><td>ds</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>jobs</td><td></td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>cronjobs</td><td>cj</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>horizontalpodautoscalers</td><td>hpa</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td></td><td>statefulsets</td><td>sts</td><td>æ§åˆ¶podèµ„æº</td></tr><tr><td>æœåŠ¡å‘ç°èµ„æº</td><td>services</td><td>svc</td><td>ç»Ÿä¸€podå¯¹å¤–æ¥å£</td></tr><tr><td></td><td>ingress</td><td>ing</td><td>ç»Ÿä¸€podå¯¹å¤–æ¥å£</td></tr><tr><td>å­˜å‚¨èµ„æº</td><td>volumeattachments</td><td></td><td>å­˜å‚¨</td></tr><tr><td></td><td>persistentvolumes</td><td>pv</td><td>å­˜å‚¨</td></tr><tr><td>é…ç½®èµ„æº</td><td>configmaps</td><td>cm</td><td>é…ç½®</td></tr><tr><td></td><td>secrets</td><td></td><td>é…ç½®</td></tr></tbody></table><p><strong>æ“ä½œ</strong><br> kuberneteså…è®¸å¯¹èµ„æºè¿›è¡Œå¤šç§æ“ä½œï¼Œå¯ä»¥é€šè¿‡--helpæŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl --help</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç»å¸¸ä½¿ç”¨çš„æ“ä½œæœ‰ä¸‹é¢è¿™äº›ï¼š</p><table><thead><tr><th>å‘½ä»¤åˆ†ç±»</th><th>å‘½ä»¤</th><th>ç¿»è¯‘</th><th>å‘½ä»¤ä½œç”¨</th></tr></thead><tbody><tr><td>åŸºæœ¬å‘½ä»¤</td><td>create</td><td>åˆ›å»º</td><td>åˆ›å»ºä¸€ä¸ªèµ„æº</td></tr><tr><td></td><td>edit</td><td>ç¼–è¾‘</td><td>ç¼–è¾‘ä¸€ä¸ªèµ„æº</td></tr><tr><td></td><td>get</td><td>è·å–</td><td>è·å–ä¸€ä¸ªèµ„æº</td></tr><tr><td></td><td>patch</td><td>æ›´æ–°</td><td>æ›´æ–°ä¸€ä¸ªèµ„æº</td></tr><tr><td></td><td>delete</td><td>åˆ é™¤</td><td>åˆ é™¤ä¸€ä¸ªèµ„æº</td></tr><tr><td></td><td>explain</td><td>è§£é‡Š</td><td>å±•ç¤ºèµ„æºæ–‡æ¡£</td></tr><tr><td>è¿è¡Œå’Œè°ƒè¯•</td><td>run</td><td>è¿è¡Œ</td><td>åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td></tr><tr><td></td><td>expose</td><td>æš´éœ²</td><td>æš´éœ²èµ„æºä¸ºService</td></tr><tr><td></td><td><strong>describe</strong></td><td>æè¿°</td><td>æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯</td></tr><tr><td></td><td>logs</td><td>æ—¥å¿—è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td><td>è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td></tr><tr><td></td><td>attach</td><td>ç¼ ç»•è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td><td>è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td></tr><tr><td></td><td>exec</td><td>æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td><td>æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td></tr><tr><td></td><td>cp</td><td>å¤åˆ¶</td><td>åœ¨Podå†…å¤–å¤åˆ¶æ–‡ä»¶</td></tr><tr><td></td><td>rollout</td><td>é¦–æ¬¡å±•ç¤º</td><td>ç®¡ç†èµ„æºçš„å‘å¸ƒ</td></tr><tr><td></td><td>scale</td><td>è§„æ¨¡</td><td>æ‰©(ç¼©)å®¹Podçš„æ•°é‡</td></tr><tr><td></td><td>autoscale</td><td>è‡ªåŠ¨è°ƒæ•´</td><td>è‡ªåŠ¨è°ƒæ•´Podçš„æ•°é‡</td></tr><tr><td>é«˜çº§å‘½ä»¤</td><td>apply</td><td>rc</td><td>é€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½®</td></tr><tr><td></td><td>label</td><td>æ ‡ç­¾</td><td>æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td></tr><tr><td>å…¶ä»–å‘½ä»¤</td><td>cluster-info</td><td>é›†ç¾¤ä¿¡æ¯</td><td>æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td></tr><tr><td></td><td>version</td><td>ç‰ˆæœ¬</td><td>æ˜¾ç¤ºå½“å‰Serverå’ŒClientçš„ç‰ˆæœ¬</td></tr></tbody></table><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ä¸‹é¢ä»¥ä¸€ä¸ªnamespace / podçš„åˆ›å»ºå’Œåˆ é™¤ç®€å•æ¼”ç¤ºä¸‹å‘½ä»¤çš„ä½¿ç”¨ï¼š</span></span>
<span class="line"><span># åˆ›å»ºä¸€ä¸ªnamespace</span></span>
<span class="line"><span>[root@master ~]# kubectl create namespace dev</span></span>
<span class="line"><span>namespace/dev created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># è·å–namespace</span></span>
<span class="line"><span>[root@master ~]# kubectl get ns</span></span>
<span class="line"><span>NAME              STATUS   AGE</span></span>
<span class="line"><span>default           Active   21h</span></span>
<span class="line"><span>dev               Active   21s</span></span>
<span class="line"><span>kube-node-lease   Active   21h</span></span>
<span class="line"><span>kube-public       Active   21h</span></span>
<span class="line"><span>kube-system       Active   21h</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åœ¨æ­¤namespaceä¸‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªnginxçš„Pod</span></span>
<span class="line"><span>[root@master ~]# kubectl run pod --image=nginx:latest -n dev</span></span>
<span class="line"><span>kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.</span></span>
<span class="line"><span>deployment.apps/pod created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹æ–°åˆ›å»ºçš„pod</span></span>
<span class="line"><span>[root@master ~]# kubectl get pod -n dev</span></span>
<span class="line"><span>NAME  READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pod   1/1     Running   0          21s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ é™¤æŒ‡å®šçš„pod</span></span>
<span class="line"><span>[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x</span></span>
<span class="line"><span>pod &quot;pod&quot; deleted</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ é™¤æŒ‡å®šçš„namespace</span></span>
<span class="line"><span>[root@master ~]# kubectl delete ns dev</span></span>
<span class="line"><span>namespace &quot;dev&quot; deleted</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®"><span>3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®</span></a></h3><p>å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±<strong>åˆ›å»º</strong>ï¼Œç›¸å½“äº kubectl create<br> å¦‚æœèµ„æºå·²å­˜åœ¨ï¼Œå°±<strong>æ›´æ–°</strong>ï¼Œç›¸å½“äº kubectl patch<br> æ‰©å±•ï¼škubectlå¯ä»¥åœ¨nodeèŠ‚ç‚¹ä¸Šè¿è¡Œå— ?<br> kubectlçš„è¿è¡Œæ˜¯éœ€è¦è¿›è¡Œé…ç½®çš„ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶æ˜¯$HOME/.kubeï¼Œå¦‚æœæƒ³è¦åœ¨nodeèŠ‚ç‚¹è¿è¡Œæ­¤å‘½ä»¤ï¼Œéœ€è¦å°†masterä¸Šçš„.kubeæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œå³åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢æ“ä½œï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ä¸»èŠ‚ç‚¹æ‰§è¡Œ</span></span>
<span class="line"><span>scp  -r  ~/.kube   k8s.node2:~/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-å®æˆ˜å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_4-å®æˆ˜å…¥é—¨"><span>4. å®æˆ˜å…¥é—¨</span></a></h1><h2 id="_4-1-namespace" tabindex="-1"><a class="header-anchor" href="#_4-1-namespace"><span>4.1 Namespace</span></a></h2><p>Namespaceæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç°<strong>å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»</strong>æˆ–è€…<strong>å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»</strong>ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># é»˜è®¤åˆ›å»ºçš„namespace</span></span>
<span class="line"><span>NAME              STATUS   AGE</span></span>
<span class="line"><span>default           Active   45h     #  æ‰€æœ‰æœªæŒ‡å®šNamespaceçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨defaultå‘½åç©ºé—´</span></span>
<span class="line"><span>kube-node-lease   Active   45h     #  é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13å¼€å§‹å¼•å…¥</span></span>
<span class="line"><span>kube-public       Active   45h     #  æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰</span></span>
<span class="line"><span>kube-system       Active   45h     #  æ‰€æœ‰ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æŸ¥çœ‹</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 1 æŸ¥çœ‹æ‰€æœ‰çš„ns  å‘½ä»¤ï¼škubectl get ns</span></span>
<span class="line"><span>kubectl get ns</span></span>
<span class="line"><span># 2 æŸ¥çœ‹æŒ‡å®šçš„ns   å‘½ä»¤ï¼škubectl get ns nsåç§°</span></span>
<span class="line"><span>kubectl get ns default</span></span>
<span class="line"><span># 3 æŒ‡å®šè¾“å‡ºæ ¼å¼  å‘½ä»¤ï¼škubectl get ns nsåç§°  -o æ ¼å¼å‚æ•°</span></span>
<span class="line"><span># kubernetesæ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯wideã€jsonã€yaml</span></span>
<span class="line"><span>kubectl get ns default -o yaml  </span></span>
<span class="line"><span># 4 æŸ¥çœ‹nsè¯¦æƒ…  å‘½ä»¤ï¼škubectl describe ns nsåç§°</span></span>
<span class="line"><span>sudo kubectl describe ns default</span></span>
<span class="line"><span># 5 åˆ›å»º&amp;åˆ é™¤</span></span>
<span class="line"><span>kubectl create ns dev</span></span>
<span class="line"><span>kubectl delete ns dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>YAMLè¯­æ³•</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ns-dev.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Namespace</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-2-pod" tabindex="-1"><a class="header-anchor" href="#_4-2-pod"><span>4.2 Pod</span></a></h2><p>Podæ˜¯kubernetesé›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äºPodä¸­ã€‚<br> Podå¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ªPodä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚<br><strong>Podç›¸å…³å‘½ä»¤</strong><br> kubernetesæ²¡æœ‰æä¾›å•ç‹¬è¿è¡ŒPodçš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®ç°çš„</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´</span></span>
<span class="line"><span>kubectl get pod -n kube-system</span></span>
<span class="line"><span># åˆ›å»ºå¹¶è¿è¡Œã€è¿™ç§æ–¹å¼åˆ›å»ºäº†æ§åˆ¶å™¨ï¼Œæƒ³è¦åˆ é™¤è¿˜éœ€è¦åˆ é™¤deploymentã€‘</span></span>
<span class="line"><span>kubectl run nginx --image=nginx:latest --port=80 --namespace dev </span></span>
<span class="line"><span># æŸ¥çœ‹PodåŸºæœ¬ä¿¡æ¯</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹Podçš„è¯¦ç»†ä¿¡æ¯ describe  æœ€åçš„eventsè¾ƒä¸ºé‡è¦ï¼Œç”¨äºæ‹é”™</span></span>
<span class="line"><span>kubectl describe pod nginx -n dev</span></span>
<span class="line"><span># è·å–podIP</span></span>
<span class="line"><span>kubectl get pods -n dev -o wide</span></span>
<span class="line"><span>#è®¿é—®POD</span></span>
<span class="line"><span>curl http://10.244.37.201</span></span>
<span class="line"><span># åˆ é™¤æŒ‡å®šPod</span></span>
<span class="line"><span>kubectl delete pod nginx -n dev</span></span>
<span class="line"><span># æŸ¥è¯¢ä¸€ä¸‹å½“å‰namespaceä¸‹çš„Podæ§åˆ¶å™¨</span></span>
<span class="line"><span>kubectl get deploy -n  dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>YAMLé…ç½®</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - image: nginx:latest</span></span>
<span class="line"><span>    name: pod</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>      protocol: TCP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-3-label" tabindex="-1"><a class="header-anchor" href="#_4-3-label"><span>4.3 Label</span></a></h2><p>ä¸€äº›å¸¸ç”¨çš„Label ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><ul><li>ç‰ˆæœ¬æ ‡ç­¾ï¼š&quot;version&quot;:&quot;release&quot;, &quot;version&quot;:&quot;stable&quot;......</li><li>ç¯å¢ƒæ ‡ç­¾ï¼š&quot;environment&quot;:&quot;dev&quot;ï¼Œ&quot;environment&quot;:&quot;test&quot;ï¼Œ&quot;environment&quot;:&quot;pro&quot;</li><li>æ¶æ„æ ‡ç­¾ï¼š&quot;tier&quot;:&quot;frontend&quot;ï¼Œ&quot;tier&quot;:&quot;backend&quot;</li></ul><p>å½“å‰æœ‰ä¸¤ç§Label Selectorï¼š</p><ul><li><strong>åŸºäºç­‰å¼çš„Label Selector</strong><br> name = slave é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­key=&quot;name&quot;ä¸”value=&quot;slave&quot;çš„å¯¹è±¡env != productioné€‰æ‹©æ‰€æœ‰åŒ…æ‹¬Labelä¸­çš„key=&quot;env&quot;ä¸”valueä¸ç­‰äº&quot;production&quot;çš„å¯¹è±¡</li><li><strong>åŸºäºé›†åˆçš„Label Selector</strong>name in (master, slave) é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key=&quot;name&quot;ä¸”value=&quot;master&quot;æˆ–&quot;slave&quot;çš„å¯¹è±¡name not in (frontend) é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key=&quot;name&quot;ä¸”valueä¸ç­‰äº&quot;frontend&quot;çš„å¯¹è±¡</li></ul><p>æ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ªLabel Selectorè¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å·&quot;,&quot;è¿›è¡Œåˆ†éš”å³å¯ã€‚ä¾‹å¦‚ï¼š<br> name=slave,env!=production<br> name not in (frontend),env!=production<br><strong>Labelç›¸å…³å‘½ä»¤</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ä¸ºpodèµ„æºæ‰“æ ‡ç­¾</span></span>
<span class="line"><span>kubectl label pod nginx-pod version=1.0 -n dev</span></span>
<span class="line"><span># ä¸ºpodèµ„æºæ›´æ–°æ ‡ç­¾</span></span>
<span class="line"><span>kubectl label pod nginx-pod version=2.0 -n dev --overwrite</span></span>
<span class="line"><span># æŸ¥çœ‹æ ‡ç­¾</span></span>
<span class="line"><span>kubectl get pod nginx-pod  -n dev --show-labels</span></span>
<span class="line"><span># ç­›é€‰æ ‡ç­¾</span></span>
<span class="line"><span>kubectl get pod -n dev -l version=2.0  --show-labels</span></span>
<span class="line"><span>kubectl get pod -n dev -l version!=2.0 --show-labels</span></span>
<span class="line"><span>#åˆ é™¤æ ‡ç­¾</span></span>
<span class="line"><span>kubectl label pod nginx-pod version- -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>YAMLé…ç½®</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    version: &quot;3.0&quot; </span></span>
<span class="line"><span>    env: &quot;test&quot;</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - image: nginx:latest</span></span>
<span class="line"><span>    name: pod</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>      protocol: TCP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-4-deployment" tabindex="-1"><a class="header-anchor" href="#_4-4-deployment"><span>4.4 Deployment</span></a></h2><p>åœ¨kubernetesä¸­ï¼ŒPodæ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒï¼Œä½†æ˜¯kuberneteså¾ˆå°‘ç›´æ¥æ§åˆ¶Podï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®Œæˆçš„ã€‚Podæ§åˆ¶å™¨ç”¨äºpodçš„ç®¡ç†ï¼Œç¡®ä¿podèµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“podçš„èµ„æºå‡ºç°æ•…éšœæ—¶ï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»ºpodã€‚</p><p>Podæ§åˆ¶å™¨å…¶ä¸­çš„ä¸€ç§æ˜¯ Deployment</p><p><strong>å‘½ä»¤æ“ä½œ</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å‘½ä»¤æ ¼å¼: kubectl create deployment åç§°  [å‚æ•°] </span></span>
<span class="line"><span># --image  æŒ‡å®špodçš„é•œåƒ</span></span>
<span class="line"><span># --port   æŒ‡å®šç«¯å£</span></span>
<span class="line"><span># --replicas  æŒ‡å®šåˆ›å»ºpodæ•°é‡</span></span>
<span class="line"><span># --namespace  æŒ‡å®šnamespace</span></span>
<span class="line"><span>kubectl create deploy nginx --image=nginx:latest --port=80 --replicas=3 -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹åˆ›å»ºçš„Pod</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹deploymentçš„ä¿¡æ¯</span></span>
<span class="line"><span># UP-TO-DATEï¼šæˆåŠŸå‡çº§çš„å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span># AVAILABLEï¼šå¯ç”¨å‰¯æœ¬çš„æ•°é‡</span></span>
<span class="line"><span>kubectl get deploy -n dev -o wide</span></span>
<span class="line"><span># æŸ¥çœ‹deploymentçš„è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span>kubectl describe deploy nginx -n dev</span></span>
<span class="line"><span># åˆ é™¤ </span></span>
<span class="line"><span>kubectl delete deploy nginx -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®æ“ä½œ</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># deploy-nginx.yaml</span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      run: nginx</span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        run: nginx</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - image: nginx:latest</span></span>
<span class="line"><span>        name: nginx</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 80</span></span>
<span class="line"><span>          protocol: TCP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-5-service" tabindex="-1"><a class="header-anchor" href="#_4-5-service"><span>4.5 Service</span></a></h2><p>Serviceå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±»Pod<strong>å¯¹å¤–çš„è®¿é—®æ¥å£</strong>ã€‚å€ŸåŠ©Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</p><p><strong>æ“ä½œä¸€ï¼šåˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æš´éœ²Service</span></span>
<span class="line"><span>kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹service</span></span>
<span class="line"><span>kubectl get svc  -n dev -o wide</span></span>
<span class="line"><span># è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªCLUSTER-IPï¼Œè¿™å°±æ˜¯serviceçš„IPï¼Œåœ¨Serviceçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸ä¼šå˜åŠ¨çš„</span></span>
<span class="line"><span># å¯ä»¥é€šè¿‡è¿™ä¸ªIPè®¿é—®å½“å‰serviceå¯¹åº”çš„POD</span></span>
<span class="line"><span>curl 10.109.179.231:80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ“ä½œäºŒï¼šåˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ä¸Šé¢åˆ›å»ºçš„Serviceçš„typeç±»å‹ä¸ºClusterIPï¼Œè¿™ä¸ªipåœ°å€åªç”¨é›†ç¾¤å†…éƒ¨å¯è®¿é—®</span></span>
<span class="line"><span># å¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„Serviceï¼Œéœ€è¦ä¿®æ”¹typeä¸ºNodePort</span></span>
<span class="line"><span>kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev</span></span>
<span class="line"><span># æ­¤æ—¶æŸ¥çœ‹ï¼Œä¼šå‘ç°å‡ºç°äº†NodePortç±»å‹çš„Serviceï¼Œè€Œä¸”æœ‰ä¸€å¯¹Portï¼ˆ80:31928/TCï¼‰</span></span>
<span class="line"><span>kubectl get svc  svc-nginx2  -n dev -o wide</span></span>
<span class="line"><span># æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„ä¸»æœºè®¿é—® èŠ‚ç‚¹IP:31928è®¿é—®æœåŠ¡äº†</span></span>
<span class="line"><span># ä¾‹å¦‚åœ¨çš„ç”µè„‘ä¸»æœºä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸‹é¢çš„åœ°å€</span></span>
<span class="line"><span>http://192.168.5.4:31928/</span></span>
<span class="line"><span>#åˆ é™¤Service</span></span>
<span class="line"><span>kubectl delete svc svc-nginx1 -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®æ–¹å¼</strong></p><p>åˆ›å»ºä¸€ä¸ªsvc-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: svc-nginx</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  clusterIP: 10.109.179.231 #å›ºå®šsvcçš„å†…ç½‘ip</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>  - port: 80</span></span>
<span class="line"><span>    protocol: TCP</span></span>
<span class="line"><span>    targetPort: 80</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    run: nginx</span></span>
<span class="line"><span>  type: ClusterIP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_5-podè¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_5-podè¯¦è§£"><span>5. Podè¯¦è§£</span></a></h1><h2 id="_5-1-podä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_5-1-podä»‹ç»"><span>5.1 Podä»‹ç»</span></a></h2><h3 id="_5-1-1-podç»“æ„" tabindex="-1"><a class="header-anchor" href="#_5-1-1-podç»“æ„"><span>5.1.1 Podç»“æ„</span></a></h3><p>æ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><p>ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘</p></li><li><p>Pauseå®¹å™¨ï¼Œè¿™æ˜¯æ¯ä¸ªPodéƒ½ä¼šæœ‰çš„ä¸€ä¸ª<strong>æ ¹å®¹å™¨</strong>ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>å¯ä»¥ä»¥å®ƒä¸ºä¾æ®ï¼Œè¯„ä¼°æ•´ä¸ªPodçš„å¥åº·çŠ¶æ€</p></li><li><p>å¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½®Ipåœ°å€ï¼Œå…¶å®ƒå®¹å™¨éƒ½æ­¤Ipï¼ˆPod IPï¼‰ï¼Œä»¥å®ç°Podå†…éƒ¨çš„ç½‘è·¯é€šä¿¡</p></li></ul></li></ul><h3 id="_5-1-2-podå®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_5-1-2-podå®šä¹‰"><span>5.1.2 Podå®šä¹‰</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1     #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1</span></span>
<span class="line"><span>kind: Pod       ã€€ #å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod</span></span>
<span class="line"><span>metadata:       ã€€ #å¿…é€‰ï¼Œå…ƒæ•°æ®</span></span>
<span class="line"><span>  name: string     #å¿…é€‰ï¼ŒPodåç§°</span></span>
<span class="line"><span>  namespace: string  #Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&quot;default&quot;</span></span>
<span class="line"><span>  labels:       ã€€ã€€  #è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨</span></span>
<span class="line"><span>    - name: string      ã€€          </span></span>
<span class="line"><span>spec:  #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span></span>
<span class="line"><span>  containers:  #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span></span>
<span class="line"><span>  - name: string   #å¿…é€‰ï¼Œå®¹å™¨åç§°</span></span>
<span class="line"><span>    image: string  #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°</span></span>
<span class="line"><span>    imagePullPolicy: [ Always|Never|IfNotPresent ]  #è·å–é•œåƒçš„ç­–ç•¥ </span></span>
<span class="line"><span>    command: [string]   #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span>
<span class="line"><span>    args: [string]      #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span></span>
<span class="line"><span>    workingDir: string  #å®¹å™¨çš„å·¥ä½œç›®å½•</span></span>
<span class="line"><span>    volumeMounts:       #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span></span>
<span class="line"><span>    - name: string      #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span></span>
<span class="line"><span>      mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span></span>
<span class="line"><span>      readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span></span>
<span class="line"><span>    ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span></span>
<span class="line"><span>    - name: string        #ç«¯å£çš„åç§°</span></span>
<span class="line"><span>      containerPort: int  #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span></span>
<span class="line"><span>      hostPort: int       #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span></span>
<span class="line"><span>      protocol: string    #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span></span>
<span class="line"><span>    env:   #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span>
<span class="line"><span>    - name: string  #ç¯å¢ƒå˜é‡åç§°</span></span>
<span class="line"><span>      value: string #ç¯å¢ƒå˜é‡çš„å€¼</span></span>
<span class="line"><span>    resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span></span>
<span class="line"><span>      limits:  #èµ„æºé™åˆ¶çš„è®¾ç½®</span></span>
<span class="line"><span>        cpu: string     #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°</span></span>
<span class="line"><span>        memory: string  #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span></span>
<span class="line"><span>      requests: #èµ„æºè¯·æ±‚çš„è®¾ç½®</span></span>
<span class="line"><span>        cpu: string    #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span>
<span class="line"><span>        memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span>
<span class="line"><span>    lifecycle: #ç”Ÿå‘½å‘¨æœŸé’©å­</span></span>
<span class="line"><span>        postStart: #å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span></span>
<span class="line"><span>        preStop: #å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span></span>
<span class="line"><span>    livenessProbe:  #å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨</span></span>
<span class="line"><span>      exec:       ã€€ #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span></span>
<span class="line"><span>        command: [string]  #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span></span>
<span class="line"><span>      httpGet:       #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port</span></span>
<span class="line"><span>        path: string</span></span>
<span class="line"><span>        port: number</span></span>
<span class="line"><span>        host: string</span></span>
<span class="line"><span>        scheme: string</span></span>
<span class="line"><span>        HttpHeaders:</span></span>
<span class="line"><span>        - name: string</span></span>
<span class="line"><span>          value: string</span></span>
<span class="line"><span>      tcpSocket:     #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span></span>
<span class="line"><span>         port: number</span></span>
<span class="line"><span>       initialDelaySeconds: 0       #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span>
<span class="line"><span>       timeoutSeconds: 0    ã€€ã€€    #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’</span></span>
<span class="line"><span>       periodSeconds: 0     ã€€ã€€    #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡</span></span>
<span class="line"><span>       successThreshold: 0</span></span>
<span class="line"><span>       failureThreshold: 0</span></span>
<span class="line"><span>       securityContext:</span></span>
<span class="line"><span>         privileged: false</span></span>
<span class="line"><span>  restartPolicy: [Always | Never | OnFailure]  #Podçš„é‡å¯ç­–ç•¥</span></span>
<span class="line"><span>  nodeName: &lt;string&gt; #è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span></span>
<span class="line"><span>  nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š</span></span>
<span class="line"><span>  imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š</span></span>
<span class="line"><span>  - name: string</span></span>
<span class="line"><span>  hostNetwork: false   #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span>
<span class="line"><span>  volumes:   #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span></span>
<span class="line"><span>  - name: string    #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span></span>
<span class="line"><span>    emptyDir: {}       #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span></span>
<span class="line"><span>    hostPath: string   #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span></span>
<span class="line"><span>      path: string      ã€€ã€€        #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span></span>
<span class="line"><span>    secret:       ã€€ã€€ã€€#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span></span>
<span class="line"><span>      scretname: string  </span></span>
<span class="line"><span>      items:     </span></span>
<span class="line"><span>      - key: string</span></span>
<span class="line"><span>        path: string</span></span>
<span class="line"><span>    configMap:         #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span></span>
<span class="line"><span>      name: string</span></span>
<span class="line"><span>      items:</span></span>
<span class="line"><span>      - key: string</span></span>
<span class="line"><span>        path: string</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#å°æç¤ºï¼š</span></span>
<span class="line"><span>#   åœ¨è¿™é‡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹æ¯ç§èµ„æºçš„å¯é…ç½®é¡¹</span></span>
<span class="line"><span>#   kubectl explain èµ„æºç±»å‹         æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§å±æ€§</span></span>
<span class="line"><span>#   kubectl explain èµ„æºç±»å‹.å±æ€§     æŸ¥çœ‹å±æ€§çš„å­å±æ€§</span></span>
<span class="line"><span>kubectl explain pod</span></span>
<span class="line"><span>#   apiVersion   &lt;string&gt;</span></span>
<span class="line"><span>#   kind &lt;string&gt;</span></span>
<span class="line"><span>#   metadata     &lt;Object&gt;</span></span>
<span class="line"><span>#   spec &lt;Object&gt;</span></span>
<span class="line"><span>#   status       &lt;Object&gt;</span></span>
<span class="line"><span>kubectl explain pod.metadata</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š</p><ul><li>apiVersion ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ°</li><li>kind ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ°</li><li>metadata å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelsç­‰</li><li>status çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ</li><li><strong>spec</strong> æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿°</li></ul><p>åœ¨ä¸Šé¢çš„å±æ€§ä¸­ï¼Œ<strong>spec</strong>æ˜¯æ¥ä¸‹æ¥ç ”ç©¶çš„é‡ç‚¹ï¼Œå¸¸è§å­å±æ€§ï¼š</p><ul><li>containers &lt;[]Object&gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</li><li>nodeName æ ¹æ®nodeNameçš„å€¼å°†podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Š</li><li>nodeSelector &lt;map[]&gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™äº›labelçš„Node ä¸Š</li><li>hostNetwork æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</li><li>volumes &lt;[]Object&gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰Podä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯</li><li>restartPolicy é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤ºPodåœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥</li></ul><h2 id="_5-2-podé…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-2-podé…ç½®"><span>5.2 Podé…ç½®</span></a></h2><p>ä¸»è¦æ¥ç ”ç©¶pod.spec.containerså±æ€§</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl explain pod.spec.containers</span></span>
<span class="line"><span># KIND:     Pod</span></span>
<span class="line"><span># VERSION:  v1</span></span>
<span class="line"><span># RESOURCE: containers &lt;[]Object&gt;   # æ•°ç»„ï¼Œä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨</span></span>
<span class="line"><span># FIELDS:</span></span>
<span class="line"><span>#    name  &lt;string&gt;     # å®¹å™¨åç§°</span></span>
<span class="line"><span>#    image &lt;string&gt;     # å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€</span></span>
<span class="line"><span>#    imagePullPolicy  &lt;string&gt; # é•œåƒæ‹‰å–ç­–ç•¥ </span></span>
<span class="line"><span>#    command  &lt;[]string&gt; # å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span>
<span class="line"><span>#    args     &lt;[]string&gt; # å®¹å™¨çš„å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span>
<span class="line"><span>#    env      &lt;[]Object&gt; # å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½®</span></span>
<span class="line"><span>#    ports    &lt;[]Object&gt;     # å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£å·åˆ—è¡¨</span></span>
<span class="line"><span>#    resources &lt;Object&gt;      # èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-1-åŸºæœ¬é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-2-1-åŸºæœ¬é…ç½®"><span>5.2.1 åŸºæœ¬é…ç½®</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-base.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-base</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    user: heima</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1 # ç”¨1.17.1ç‰ˆæœ¬çš„nginxé•œåƒåˆ›å»ºï¼Œï¼ˆnginxæ˜¯ä¸€ä¸ªè½»é‡çº§webå®¹å™¨ï¼‰</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30 # ç”¨1.30ç‰ˆæœ¬çš„busyboxé•œåƒåˆ›å»ºï¼Œï¼ˆbusyboxæ˜¯ä¸€ä¸ªå°å·§çš„linuxå‘½ä»¤é›†åˆï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl apply -f pod-base.yaml</span></span>
<span class="line"><span>kubectl get pod -n dev</span></span>
<span class="line"><span># å¯ä»¥é€šè¿‡describeæŸ¥çœ‹å†…éƒ¨çš„è¯¦æƒ…</span></span>
<span class="line"><span># æ­¤æ—¶å·²ç»è¿è¡Œèµ·æ¥äº†ä¸€ä¸ªåŸºæœ¬çš„Podï¼Œè™½ç„¶å®ƒæš‚æ—¶æœ‰é—®é¢˜</span></span>
<span class="line"><span>kubectl describe pod pod-base -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-2-é•œåƒæ‹‰å–" tabindex="-1"><a class="header-anchor" href="#_5-2-2-é•œåƒæ‹‰å–"><span>5.2.2 é•œåƒæ‹‰å–</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-imagepullpolicy.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-imagepullpolicy</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    imagePullPolicy: Never # ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>imagePullPolicy</strong>ï¼Œç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ï¼Œkubernetesæ”¯æŒé…ç½®ä¸‰ç§æ‹‰å–ç­–ç•¥ï¼š</p><ul><li><p><strong>Always</strong>ï¼šåªä½¿ç”¨è¿œç¨‹</p></li><li><p><strong>IfNotPresent</strong>ï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒã€é»˜è®¤ã€‘</p></li><li><p><strong>Never</strong>ï¼šåªä½¿ç”¨æœ¬åœ°</p></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-imagepullpolicy.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹Podè¯¦æƒ…</span></span>
<span class="line"><span># æ­¤æ—¶æ˜æ˜¾å¯ä»¥çœ‹åˆ°nginxé•œåƒæœ‰ä¸€æ­¥Pulling image &quot;nginx:1.17.1&quot;çš„è¿‡ç¨‹</span></span>
<span class="line"><span>kubectl describe pod pod-imagepullpolicy -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-3-å¯åŠ¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_5-2-3-å¯åŠ¨å‘½ä»¤"><span>5.2.3 å¯åŠ¨å‘½ä»¤</span></a></h3><p><strong>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼šbusyboxå¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç±»çš„é›†åˆï¼Œkubernetesé›†ç¾¤å¯åŠ¨ç®¡ç†åï¼Œå®ƒä¼šè‡ªåŠ¨å…³é—­ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å…¶ä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™å°±ç”¨åˆ°äº†commandé…ç½®ã€‚commandï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åè¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-command.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-command</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯éš”3ç§’å‘æ–‡ä»¶ä¸­å†™å…¥å½“å‰æ—¶é—´</p><p>&quot;/bin/sh&quot;,&quot;-c&quot;, ä½¿ç”¨shæ‰§è¡Œå‘½ä»¤</p><p>touch /tmp/hello.txt; åˆ›å»ºä¸€ä¸ª/tmp/hello.txt æ–‡ä»¶</p><p>while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># é‡è¯•</span></span>
<span class="line"><span>kubectl create  -f pod-command.yaml</span></span>
<span class="line"><span>kubectl get pods pod-command -n dev</span></span>
<span class="line"><span></span></span>
<span class="line"><span># è¿›å…¥podä¸­çš„busyboxå®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span># è¡¥å……ä¸€ä¸ªå‘½ä»¤: kubectl exec  podåç§° -n å‘½åç©ºé—´ -it -c å®¹å™¨åç§° /bin/sh  åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤</span></span>
<span class="line"><span># ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è¿›å…¥æŸä¸ªå®¹å™¨çš„å†…éƒ¨ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œäº†</span></span>
<span class="line"><span># æ¯”å¦‚ï¼Œå¯ä»¥æŸ¥çœ‹txtæ–‡ä»¶çš„å†…å®¹</span></span>
<span class="line"><span>kubectl exec pod-command -n dev -it -c busybox /bin/sh</span></span>
<span class="line"><span>/ # tail -f /tmp/hello.txt</span></span>
<span class="line"><span>14:44:19</span></span>
<span class="line"><span>14:44:22</span></span>
<span class="line"><span>14:44:25</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ç‰¹åˆ«è¯´æ˜ï¼š</span></span>
<span class="line"><span>    é€šè¿‡ä¸Šé¢å‘ç°commandå·²ç»å¯ä»¥å®Œæˆå¯åŠ¨å‘½ä»¤å’Œä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦æä¾›ä¸€ä¸ªargsé€‰é¡¹ï¼Œç”¨äºä¼ é€’å‚æ•°å‘¢?è¿™å…¶å®è·Ÿdockeræœ‰ç‚¹å…³ç³»ï¼Œkubernetesä¸­çš„commandã€argsä¸¤é¡¹å…¶å®æ˜¯å®ç°è¦†ç›–Dockerfileä¸­ENTRYPOINTçš„åŠŸèƒ½ã€‚</span></span>
<span class="line"><span> 1 å¦‚æœcommandå’Œargså‡æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆç”¨Dockerfileçš„é…ç½®ã€‚</span></span>
<span class="line"><span> 2 å¦‚æœcommandå†™äº†ï¼Œä½†argsæ²¡æœ‰å†™ï¼Œé‚£ä¹ˆDockerfileé»˜è®¤çš„é…ç½®ä¼šè¢«å¿½ç•¥ï¼Œæ‰§è¡Œè¾“å…¥çš„command</span></span>
<span class="line"><span> 3 å¦‚æœcommandæ²¡å†™ï¼Œä½†argså†™äº†ï¼Œé‚£ä¹ˆDockerfileä¸­é…ç½®çš„ENTRYPOINTçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä½¿ç”¨å½“å‰argsçš„å‚æ•°</span></span>
<span class="line"><span> 4 å¦‚æœcommandå’Œargséƒ½å†™äº†ï¼Œé‚£ä¹ˆDockerfileçš„é…ç½®è¢«å¿½ç•¥ï¼Œæ‰§è¡Œcommandå¹¶è¿½åŠ ä¸Šargså‚æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-4-ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#_5-2-4-ç¯å¢ƒå˜é‡"><span>5.2.4 ç¯å¢ƒå˜é‡</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-env.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-env</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do /bin/echo $(date +%T);sleep 60; done;&quot;]</span></span>
<span class="line"><span>    env: # è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span>
<span class="line"><span>    - name: &quot;username&quot;</span></span>
<span class="line"><span>      value: &quot;admin&quot;</span></span>
<span class="line"><span>    - name: &quot;password&quot;</span></span>
<span class="line"><span>      value: &quot;123456&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>envï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-env.yaml</span></span>
<span class="line"><span># è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡</span></span>
<span class="line"><span>kubectl exec pod-env -n dev -c busybox -it /bin/sh</span></span>
<span class="line"><span>/ # echo $username</span></span>
<span class="line"><span>admin</span></span>
<span class="line"><span>/ # echo $password</span></span>
<span class="line"><span>123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­</p><h3 id="_5-2-5-ç«¯å£è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_5-2-5-ç«¯å£è®¾ç½®"><span>5.2.5 ç«¯å£è®¾ç½®</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl explain pod.spec.containers.ports</span></span>
<span class="line"><span>#KIND:     Pod</span></span>
<span class="line"><span>#VERSION:  v1</span></span>
<span class="line"><span>#RESOURCE: ports &lt;[]Object&gt;</span></span>
<span class="line"><span>#FIELDS:</span></span>
<span class="line"><span>#   name         &lt;string&gt;  # ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯nameåœ¨podä¸­æ˜¯å”¯ä¸€çš„		</span></span>
<span class="line"><span>#   containerPort&lt;integer&gt; # å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536)</span></span>
<span class="line"><span>#   hostPort     &lt;integer&gt; # å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) </span></span>
<span class="line"><span>#   hostIP       &lt;string&gt;  # è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœºIP(ä¸€èˆ¬çœç•¥)</span></span>
<span class="line"><span>#   protocol     &lt;string&gt;  # ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯UDPã€TCPæˆ–SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-ports.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-ports</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports: # è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨</span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>      protocol: TCP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-ports.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pod pod-ports -n dev -o yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-6-èµ„æºé…é¢" tabindex="-1"><a class="header-anchor" href="#_5-2-6-èµ„æºé…é¢"><span>5.2.6 èµ„æºé…é¢</span></a></h3><ul><li><p><strong>limits</strong>ï¼šç”¨äºé™åˆ¶è¿è¡Œæ—¶å®¹å™¨çš„æœ€å¤§å ç”¨èµ„æºï¼Œå½“å®¹å™¨å ç”¨èµ„æºè¶…è¿‡limitsæ—¶ä¼šè¢«ç»ˆæ­¢ï¼Œå¹¶è¿›è¡Œé‡å¯</p></li><li><p><strong>requests</strong> ï¼šç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æºï¼Œå¦‚æœç¯å¢ƒèµ„æºä¸å¤Ÿï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨</p></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-resources.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-resources</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    resources: # èµ„æºé…é¢</span></span>
<span class="line"><span>      limits:  # é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span></span>
<span class="line"><span>        cpu: &quot;2&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°ã€æ•´æ•°||å°æ•°ã€‘</span></span>
<span class="line"><span>        memory: &quot;10Gi&quot; # å†…å­˜é™åˆ¶ã€Giã€Miã€Gã€Mã€‘</span></span>
<span class="line"><span>      requests: # è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span></span>
<span class="line"><span>        cpu: &quot;1&quot;  # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°ã€æ•´æ•°||å°æ•°ã€‘</span></span>
<span class="line"><span>        memory: &quot;10Mi&quot;  # å†…å­˜é™åˆ¶ã€Giã€Miã€Gã€Mã€‘</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-3-podç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_5-3-podç”Ÿå‘½å‘¨æœŸ"><span>5.3 Podç”Ÿå‘½å‘¨æœŸ</span></a></h2><p>æˆ‘ä»¬ä¸€èˆ¬å°†podå¯¹è±¡ä»åˆ›å»ºè‡³ç»ˆçš„è¿™æ®µæ—¶é—´èŒƒå›´ç§°ä¸ºpodçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸»è¦åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p><ul><li><p>podåˆ›å»ºè¿‡ç¨‹</p></li><li><p>è¿è¡Œåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰è¿‡ç¨‹</p></li><li><p>è¿è¡Œä¸»å®¹å™¨ï¼ˆmain containerï¼‰</p><ul><li><p>å®¹å™¨å¯åŠ¨åé’©å­ï¼ˆpost startï¼‰ã€å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰</p></li><li><p>å®¹å™¨çš„å­˜æ´»æ€§æ¢æµ‹ï¼ˆliveness probeï¼‰ã€å°±ç»ªæ€§æ¢æµ‹ï¼ˆreadiness probeï¼‰</p></li></ul></li><li><p>podç»ˆæ­¢è¿‡ç¨‹</p></li></ul><p>åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPodä¼šå‡ºç°5ç§<strong>çŠ¶æ€</strong>ï¼ˆ<strong>ç›¸ä½</strong>ï¼‰ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><p>æŒ‚èµ·ï¼ˆPendingï¼‰ï¼šapiserverå·²ç»åˆ›å»ºäº†podèµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­</p></li><li><p>è¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼špodå·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«kubeletåˆ›å»ºå®Œæˆ</p></li><li><p>æˆåŠŸï¼ˆSucceededï¼‰ï¼špodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯</p></li><li><p>å¤±è´¥ï¼ˆFailedï¼‰ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é0å€¼çš„é€€å‡ºçŠ¶æ€</p></li><li><p>æœªçŸ¥ï¼ˆUnknownï¼‰ï¼šapiserveræ— æ³•æ­£å¸¸è·å–åˆ°podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´</p></li></ul><h3 id="_5-3-1-åˆ›å»ºå’Œç»ˆæ­¢" tabindex="-1"><a class="header-anchor" href="#_5-3-1-åˆ›å»ºå’Œç»ˆæ­¢"><span>5.3.1 åˆ›å»ºå’Œç»ˆæ­¢</span></a></h3><p><strong>podçš„åˆ›å»ºè¿‡ç¨‹</strong></p><ol><li><p>ç”¨æˆ·é€šè¿‡kubectlæˆ–å…¶ä»–apiå®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„podä¿¡æ¯ç»™apiServer</p></li><li><p>apiServerå¼€å§‹ç”Ÿæˆpodå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥etcdï¼Œç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯</p></li><li><p>apiServerå¼€å§‹åæ˜ etcdä¸­çš„podå¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨<strong>watch</strong>æœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥apiServerä¸Šçš„å˜åŠ¨</p></li><li><p>schedulerå‘ç°æœ‰æ–°çš„podå¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸ºPodåˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³apiServer</p></li><li><p>nodeèŠ‚ç‚¹ä¸Šçš„kubeletå‘ç°æœ‰podè°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨dockerå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³apiServer</p></li><li><p>apiServerå°†æ¥æ”¶åˆ°çš„podçŠ¶æ€ä¿¡æ¯å­˜å…¥etcdä¸­</p></li></ol><p><strong>podçš„ç»ˆæ­¢è¿‡ç¨‹</strong></p><ol><li><p>ç”¨æˆ·å‘apiServerå‘é€åˆ é™¤podå¯¹è±¡çš„å‘½ä»¤</p></li><li><p>apiServcerä¸­çš„podå¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…ï¼ˆé»˜è®¤30sï¼‰ï¼Œpodè¢«è§†ä¸ºdead</p></li><li><p>å°†podæ ‡è®°ä¸ºterminatingçŠ¶æ€</p></li><li><p>kubeletåœ¨ç›‘æ§åˆ°podå¯¹è±¡è½¬ä¸ºterminatingçŠ¶æ€çš„åŒæ—¶å¯åŠ¨podå…³é—­è¿‡ç¨‹</p></li><li><p>ç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ°podå¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„serviceèµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤</p></li><li><p>å¦‚æœå½“å‰podå¯¹è±¡å®šä¹‰äº†preStopé’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸ºterminatingåå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ</p></li><li><p>podå¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·</p></li><li><p>å®½é™æœŸç»“æŸåï¼Œè‹¥podä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆpodå¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å·</p></li><li><p>kubeletè¯·æ±‚apiServerå°†æ­¤podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶podå¯¹äºç”¨æˆ·å·²ä¸å¯è§</p></li></ol><h3 id="_5-3-2-åˆå§‹åŒ–å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_5-3-2-åˆå§‹åŒ–å®¹å™¨"><span>5.3.2 åˆå§‹åŒ–å®¹å™¨</span></a></h3><p>åˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨podçš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š</p><ol><li><p>åˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œè‹¥æŸåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆkuberneteséœ€è¦é‡å¯å®ƒç›´åˆ°æˆåŠŸå®Œæˆ</p></li><li><p>åˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œ</p></li></ol><p>åˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š</p><ul><li><p>æä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç </p></li><li><p>åˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³</p></li></ul><p>æ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š</p><p>å‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡Œnginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡Œnginxä¹‹å‰å…ˆè¦èƒ½å¤Ÿè¿æ¥ä¸Šmysqlå’Œredisæ‰€åœ¨æœåŠ¡å™¨</p><p>ä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½mysql(192.168.5.4)å’Œredis(192.168.5.5)æœåŠ¡å™¨çš„åœ°å€</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-initcontainer.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-initcontainer</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: main-container</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports: </span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>  initContainers:</span></span>
<span class="line"><span>  - name: test-mysql</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until ping 192.168.5.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&#39;]</span></span>
<span class="line"><span>  - name: test-redis</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until ping 192.168.5.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºpod</span></span>
<span class="line"><span>kubectl create -f pod-initcontainer.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹podçŠ¶æ€</span></span>
<span class="line"><span># å‘ç°podå¡åœ¨å¯åŠ¨ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œåé¢çš„å®¹å™¨ä¸ä¼šè¿è¡Œ</span></span>
<span class="line"><span>kubectl describe pod  pod-initcontainer -n dev</span></span>
<span class="line"><span># åŠ¨æ€æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods pod-initcontainer -n dev -w</span></span>
<span class="line"><span># æ¥ä¸‹æ¥æ–°å¼€ä¸€ä¸ªshellï¼Œä¸ºå½“å‰æœåŠ¡å™¨æ–°å¢ä¸¤ä¸ªipï¼Œè§‚å¯Ÿpodçš„å˜åŒ–</span></span>
<span class="line"><span>ifconfig ens33:1 192.168.5.14 netmask 255.255.255.0 up</span></span>
<span class="line"><span>ifconfig ens33:2 192.168.5.15 netmask 255.255.255.0 up</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-3-é’©å­å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_5-3-3-é’©å­å‡½æ•°"><span>5.3.3 é’©å­å‡½æ•°</span></a></h3><ul><li><p>post startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨</p></li><li><p>pre stop ï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ</p></li></ul><p>é’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š</p><ul><li><strong>Execå‘½ä»¤</strong>ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>â€¦â€¦</span></span>
<span class="line"><span>  lifecycle:</span></span>
<span class="line"><span>    postStart: </span></span>
<span class="line"><span>      exec:</span></span>
<span class="line"><span>        command:</span></span>
<span class="line"><span>        - cat</span></span>
<span class="line"><span>        - /tmp/healthy</span></span>
<span class="line"><span>â€¦â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>TCPSocket</strong>ï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„socket</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>â€¦â€¦      </span></span>
<span class="line"><span>  lifecycle:</span></span>
<span class="line"><span>    postStart:</span></span>
<span class="line"><span>      tcpSocket:</span></span>
<span class="line"><span>        port: 8080</span></span>
<span class="line"><span>â€¦â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>HTTPGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·httpè¯·æ±‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>â€¦â€¦</span></span>
<span class="line"><span>  lifecycle:</span></span>
<span class="line"><span>    postStart:</span></span>
<span class="line"><span>      httpGet:</span></span>
<span class="line"><span>        path: / #URIåœ°å€</span></span>
<span class="line"><span>        port: 80 #ç«¯å£å·</span></span>
<span class="line"><span>        host: 192.168.5.3 #ä¸»æœºåœ°å€</span></span>
<span class="line"><span>        scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span></span>
<span class="line"><span>â€¦â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-hook-exec.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-hook-exec</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: main-container</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>    lifecycle:</span></span>
<span class="line"><span>      postStart: </span></span>
<span class="line"><span>        exec: # åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¿®æ”¹æ‰nginxçš„é»˜è®¤é¦–é¡µå†…å®¹</span></span>
<span class="line"><span>          command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;echo postStart... &gt; /usr/share/nginx/html/index.html&quot;]</span></span>
<span class="line"><span>      preStop:</span></span>
<span class="line"><span>        exec: # åœ¨å®¹å™¨åœæ­¢ä¹‹å‰åœæ­¢nginxæœåŠ¡</span></span>
<span class="line"><span>          command: [&quot;/usr/sbin/nginx&quot;,&quot;-s&quot;,&quot;quit&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºpod</span></span>
<span class="line"><span>kubectl create -f pod-hook-exec.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods  pod-hook-exec -n dev -o wide</span></span>
<span class="line"><span># è®¿é—®pod</span></span>
<span class="line"><span>curl 10.244.2.48</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-4-å®¹å™¨æ¢æµ‹" tabindex="-1"><a class="header-anchor" href="#_5-3-4-å®¹å™¨æ¢æµ‹"><span>5.3.4 å®¹å™¨æ¢æµ‹</span></a></h3><p>å®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆkuberneteså°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹&quot; æ‘˜é™¤ &quot;ï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚kubernetesæä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><p><strong>liveness probes</strong>ï¼šå­˜æ´»æ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8sä¼šé‡å¯å®¹å™¨</p></li><li><p><strong>readiness probes</strong>ï¼šå°±ç»ªæ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8sä¸ä¼šè½¬å‘æµé‡</p></li></ul><p>livenessProbe å†³å®šæ˜¯å¦é‡å¯å®¹å™¨ï¼ŒreadinessProbe å†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚</p><p>ä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š</p><ul><li>Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>â€¦â€¦</span></span>
<span class="line"><span>  livenessProbe:</span></span>
<span class="line"><span>    exec:</span></span>
<span class="line"><span>      command:</span></span>
<span class="line"><span>      - cat</span></span>
<span class="line"><span>      - /tmp/healthy</span></span>
<span class="line"><span>â€¦â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>TCPSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>â€¦â€¦      </span></span>
<span class="line"><span>  livenessProbe:</span></span>
<span class="line"><span>    tcpSocket:</span></span>
<span class="line"><span>      port: 8080</span></span>
<span class="line"><span>â€¦â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>HTTPGetï¼šè°ƒç”¨å®¹å™¨å†…Webåº”ç”¨çš„URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨200å’Œ399ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>â€¦â€¦</span></span>
<span class="line"><span>  livenessProbe:</span></span>
<span class="line"><span>    httpGet:</span></span>
<span class="line"><span>      path: / #URIåœ°å€</span></span>
<span class="line"><span>      port: 80 #ç«¯å£å·</span></span>
<span class="line"><span>      host: 127.0.0.1 #ä¸»æœºåœ°å€</span></span>
<span class="line"><span>      scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span></span>
<span class="line"><span>â€¦â€¦</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹å¼ä¸€ï¼šExec</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-liveness-exec.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-liveness-exec</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports: </span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>    livenessProbe:</span></span>
<span class="line"><span>      exec:</span></span>
<span class="line"><span>        command: [&quot;/bin/cat&quot;,&quot;/tmp/hello.txt&quot;] # æ‰§è¡Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-liveness-exec.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹Podè¯¦æƒ…</span></span>
<span class="line"><span>kubectl describe pods pod-liveness-exec -n dev</span></span>
<span class="line"><span># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯å°±ä¼šå‘ç°nginxå®¹å™¨å¯åŠ¨ä¹‹åå°±è¿›è¡Œäº†å¥åº·æ£€æŸ¥</span></span>
<span class="line"><span># æ£€æŸ¥å¤±è´¥ä¹‹åï¼Œå®¹å™¨è¢«killæ‰ï¼Œç„¶åå°è¯•è¿›è¡Œé‡å¯ï¼ˆè¿™æ˜¯é‡å¯ç­–ç•¥çš„ä½œç”¨ï¼Œåé¢è®²è§£ï¼‰</span></span>
<span class="line"><span># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span>
<span class="line"><span>kubectl get pods pod-liveness-exec -n dev</span></span>
<span class="line"><span># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚/tmp/hello.txtï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹å¼äºŒï¼šTCPSocket</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-liveness-tcpsocket.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-liveness-tcpsocket</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports: </span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>    livenessProbe:</span></span>
<span class="line"><span>      tcpSocket:</span></span>
<span class="line"><span>        port: 8080 # å°è¯•è®¿é—®8080ç«¯å£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-liveness-tcpsocket.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹Podè¯¦æƒ…</span></span>
<span class="line"><span>kubectl describe pods pod-liveness-tcpsocket -n dev</span></span>
<span class="line"><span># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯ï¼Œå‘ç°å°è¯•è®¿é—®8080ç«¯å£,ä½†æ˜¯å¤±è´¥äº†</span></span>
<span class="line"><span># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span>
<span class="line"><span>kubectl get pods pod-liveness-tcpsocket  -n dev</span></span>
<span class="line"><span># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç«¯å£ï¼Œæ¯”å¦‚80ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹å¼ä¸‰ï¼šHTTPGet</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-liveness-httpget.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-liveness-httpget</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>    livenessProbe:</span></span>
<span class="line"><span>      httpGet:  # å…¶å®å°±æ˜¯è®¿é—®http://127.0.0.1:80/hello  </span></span>
<span class="line"><span>        scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span></span>
<span class="line"><span>        port: 80 #ç«¯å£å·</span></span>
<span class="line"><span>        path: /hello #URIåœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-liveness-httpget.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹Podè¯¦æƒ…</span></span>
<span class="line"><span>kubectl describe pod pod-liveness-httpget -n dev</span></span>
<span class="line"><span># è§‚å¯Ÿä¸Šé¢ä¿¡æ¯ï¼Œå°è¯•è®¿é—®è·¯å¾„ï¼Œä½†æ˜¯æœªæ‰¾åˆ°,å‡ºç°404é”™è¯¯</span></span>
<span class="line"><span># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span>
<span class="line"><span>kubectl get pod pod-liveness-httpget -n dev</span></span>
<span class="line"><span># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„è·¯å¾„pathï¼Œæ¯”å¦‚/ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># livenessProbeå­å±æ€§</span></span>
<span class="line"><span>kubectl explain pod.spec.containers.livenessProbe</span></span>
<span class="line"><span>FIELDS:</span></span>
<span class="line"><span>   exec &lt;Object&gt;  </span></span>
<span class="line"><span>   tcpSocket    &lt;Object&gt;</span></span>
<span class="line"><span>   httpGet      &lt;Object&gt;</span></span>
<span class="line"><span>   initialDelaySeconds  &lt;integer&gt;  # å®¹å™¨å¯åŠ¨åç­‰å¾…å¤šå°‘ç§’æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹</span></span>
<span class="line"><span>   timeoutSeconds       &lt;integer&gt;  # æ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤1ç§’ï¼Œæœ€å°1ç§’</span></span>
<span class="line"><span>   periodSeconds        &lt;integer&gt;  # æ‰§è¡Œæ¢æµ‹çš„é¢‘ç‡ã€‚é»˜è®¤æ˜¯10ç§’ï¼Œæœ€å°1ç§’</span></span>
<span class="line"><span>   failureThreshold     &lt;integer&gt;  # è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1</span></span>
<span class="line"><span>   successThreshold     &lt;integer&gt;  # è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-5-é‡å¯ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_5-3-5-é‡å¯ç­–ç•¥"><span>5.3.5 é‡å¯ç­–ç•¥</span></a></h3><ul><li><p><strong>Always</strong> ï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚</p></li><li><p><strong>OnFailure</strong> ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯</p></li><li><p><strong>Never</strong> ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨</p></li></ul><p>é‡å¯ç­–ç•¥é€‚ç”¨äºpodå¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦æ—¶ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡éœ€è¦é‡å¯çš„æ“ä½œå°†ç”±kubeletå»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º10sã€20sã€40sã€80sã€160så’Œ300sï¼Œ300sæ˜¯æœ€å¤§å»¶è¿Ÿæ—¶é•¿ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-restartpolicy.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-restartpolicy</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - name: nginx-port</span></span>
<span class="line"><span>      containerPort: 80</span></span>
<span class="line"><span>    livenessProbe:</span></span>
<span class="line"><span>      httpGet:</span></span>
<span class="line"><span>        scheme: HTTP</span></span>
<span class="line"><span>        port: 80</span></span>
<span class="line"><span>        path: /hello</span></span>
<span class="line"><span>  restartPolicy: Never # è®¾ç½®é‡å¯ç­–ç•¥ä¸ºNever</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f pod-restartpolicy.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹Podè¯¦æƒ…ï¼Œå‘ç°nginxå®¹å™¨å¤±è´¥</span></span>
<span class="line"><span>kubectl  describe pods pod-restartpolicy  -n dev</span></span>
<span class="line"><span># å¤šç­‰ä¸€ä¼šï¼Œå†è§‚å¯Ÿpodçš„é‡å¯æ¬¡æ•°ï¼Œå‘ç°ä¸€ç›´æ˜¯0ï¼Œå¹¶æœªé‡å¯   </span></span>
<span class="line"><span>kubectl  get pods pod-restartpolicy -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-4-podè°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_5-4-podè°ƒåº¦"><span>5.4 Podè°ƒåº¦</span></a></h2><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªPodåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”±Schedulerç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³çš„éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº›Podåˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦æ±‚äº†è§£kuberneteså¯¹Podçš„è°ƒåº¦è§„åˆ™ï¼Œkubernetesæä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š</p><ul><li><p>è‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šå®Œå…¨ç”±Schedulerç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡º</p></li><li><p>å®šå‘è°ƒåº¦ï¼šNodeNameã€NodeSelector</p></li><li><p>äº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinityã€PodAffinityã€PodAntiAffinity</p></li><li><p>æ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaintsã€Toleration</p></li></ul><h3 id="_5-4-1-å®šå‘è°ƒåº¦ã€å¼ºåˆ¶ç­–ç•¥ã€‘" tabindex="-1"><a class="header-anchor" href="#_5-4-1-å®šå‘è°ƒåº¦ã€å¼ºåˆ¶ç­–ç•¥ã€‘"><span>5.4.1 å®šå‘è°ƒåº¦ã€å¼ºåˆ¶ç­–ç•¥ã€‘</span></a></h3><h4 id="nodename" tabindex="-1"><a class="header-anchor" href="#nodename"><span><strong>NodeName</strong></span></a></h4><p>è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°†Podè°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-nodename.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-nodename</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  nodeName: node1 # æŒ‡å®šè°ƒåº¦åˆ°node1èŠ‚ç‚¹ä¸Š</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nodeselector" tabindex="-1"><a class="header-anchor" href="#nodeselector"><span><strong>NodeSelector</strong></span></a></h4><p>NodeSelectorç”¨äºå°†podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„nodeèŠ‚ç‚¹ä¸Šã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl label nodes node1 nodeenv=pro</span></span>
<span class="line"><span>ubectl label nodes node2 nodeenv=test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-nodeselector.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-nodeselector</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  nodeSelector: </span></span>
<span class="line"><span>    nodeenv: pro # æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv=proæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-2-äº²å’Œæ€§è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_5-4-2-äº²å’Œæ€§è°ƒåº¦"><span>5.4.2 äº²å’Œæ€§è°ƒåº¦</span></a></h3><p>ä¸Šä¸€èŠ‚ï¼Œä»‹ç»äº†ä¸¤ç§å®šå‘è°ƒåº¦çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„Nodeï¼Œé‚£ä¹ˆPodå°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨Nodeåˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetesè¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨NodeSelectorçš„åŸºç¡€ä¹‹ä¸Šçš„è¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„Nodeè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿è°ƒåº¦æ›´åŠ çµæ´»ã€‚</p><p>Affinityä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li><p><strong>nodeAffinity(nodeäº²å’Œæ€§ï¼‰</strong>: ä»¥nodeä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥è°ƒåº¦åˆ°å“ªäº›nodeçš„é—®é¢˜</p></li><li><p><strong>podAffinity(podäº²å’Œæ€§)</strong> : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</p></li><li><p><strong>podAntiAffinity(podåäº²å’Œæ€§)</strong> : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</p></li></ul><p>å…³äºäº²å’Œæ€§(åäº²å’Œæ€§)ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š</p><p><strong>äº²å’Œæ€§</strong>ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£å°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨çš„å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p><p><strong>åäº²å’Œæ€§</strong>ï¼šå½“åº”ç”¨çš„é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªnodeä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</p><h4 id="nodeaffinity" tabindex="-1"><a class="header-anchor" href="#nodeaffinity"><span><strong>NodeAffinity</strong></span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># é¦–å…ˆæ¥çœ‹ä¸€ä¸‹`NodeAffinity`çš„å¯é…ç½®é¡¹ï¼š</span></span>
<span class="line"><span>pod.spec.affinity.nodeAffinity</span></span>
<span class="line"><span>  requiredDuringSchedulingIgnoredDuringExecution  #NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶</span></span>
<span class="line"><span>    nodeSelectorTerms  #èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨</span></span>
<span class="line"><span>      matchFields   #æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨</span></span>
<span class="line"><span>      matchExpressions   #æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span>
<span class="line"><span>        key    #é”®</span></span>
<span class="line"><span>        values #å€¼</span></span>
<span class="line"><span>        operator #å…³ç³»ç¬¦ æ”¯æŒExists, DoesNotExist, In, NotIn, Gt, Lt</span></span>
<span class="line"><span>  preferredDuringSchedulingIgnoredDuringExecution #ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘)</span></span>
<span class="line"><span>    preference   #ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è”</span></span>
<span class="line"><span>      matchFields   #æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨</span></span>
<span class="line"><span>      matchExpressions   #æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span>
<span class="line"><span>        key    #é”®</span></span>
<span class="line"><span>        values #å€¼</span></span>
<span class="line"><span>        operator #å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist, Gt, Lt</span></span>
<span class="line"><span>	weight #å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#å…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜:</span></span>
<span class="line"><span>- matchExpressions:</span></span>
<span class="line"><span>  - key: nodeenv              # åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹</span></span>
<span class="line"><span>    operator: Exists</span></span>
<span class="line"><span>  - key: nodeenv              # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueæ˜¯&quot;xxx&quot;æˆ–&quot;yyy&quot;çš„èŠ‚ç‚¹</span></span>
<span class="line"><span>    operator: In</span></span>
<span class="line"><span>    values: [&quot;xxx&quot;,&quot;yyy&quot;]</span></span>
<span class="line"><span>  - key: nodeenv              # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueå¤§äº&quot;xxx&quot;çš„èŠ‚ç‚¹</span></span>
<span class="line"><span>    operator: Gt</span></span>
<span class="line"><span>    values: &quot;xxx&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># requiredDuringSchedulingIgnoredDuringExecution</span></span>
<span class="line"><span># pod-nodeaffinity-required.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-nodeaffinity-required</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  affinity:  #äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span>    nodeAffinity: #è®¾ç½®nodeäº²å’Œæ€§</span></span>
<span class="line"><span>      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹çš„è‡³å°‘ä¸€ä¸ª</span></span>
<span class="line"><span>        nodeSelectorTerms:</span></span>
<span class="line"><span>        - matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾</span></span>
<span class="line"><span>          - key: nodeenv</span></span>
<span class="line"><span>            operator: In</span></span>
<span class="line"><span>            values: [&quot;xxx&quot;,&quot;yyy&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># requiredDuringSchedulingIgnoredDuringExecution</span></span>
<span class="line"><span># pod-nodeaffinity-preferred.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-nodeaffinity-preferred</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  affinity:  #äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span>    nodeAffinity: #è®¾ç½®nodeäº²å’Œæ€§</span></span>
<span class="line"><span>      preferredDuringSchedulingIgnoredDuringExecution: # è½¯é™åˆ¶</span></span>
<span class="line"><span>      - weight: 1</span></span>
<span class="line"><span>        preference:</span></span>
<span class="line"><span>          matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾(å½“å‰ç¯å¢ƒæ²¡æœ‰)</span></span>
<span class="line"><span>          - key: nodeenv</span></span>
<span class="line"><span>            operator: In</span></span>
<span class="line"><span>            values: [&quot;xxx&quot;,&quot;yyy&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>NodeAffinityè§„åˆ™è®¾ç½®çš„æ³¨æ„äº‹é¡¹ï¼š</strong></p><ol><li><p>å¦‚æœåŒæ—¶å®šä¹‰äº†nodeSelectorå’ŒnodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½å¾—åˆ°æ»¡è¶³ï¼ŒPodæ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„Nodeä¸Š</p></li><li><p>å¦‚æœnodeAffinityæŒ‡å®šäº†å¤šä¸ªnodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯</p></li><li><p>å¦‚æœä¸€ä¸ªnodeSelectorTermsä¸­æœ‰å¤šä¸ªmatchExpressions ï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸ</p></li><li><p>å¦‚æœä¸€ä¸ªpodæ‰€åœ¨çš„Nodeåœ¨Podè¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥Podçš„èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚ï¼Œåˆ™<strong>ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ–</strong></p></li></ol><h4 id="podaffinity" tabindex="-1"><a class="header-anchor" href="#podaffinity"><span><strong>PodAffinity</strong></span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># é¦–å…ˆæ¥çœ‹ä¸€ä¸‹`PodAffinity`çš„å¯é…ç½®é¡¹ï¼š</span></span>
<span class="line"><span>pod.spec.affinity.podAffinity</span></span>
<span class="line"><span>  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬é™åˆ¶</span></span>
<span class="line"><span>    namespaces       # æŒ‡å®šå‚ç…§podçš„namespace</span></span>
<span class="line"><span>    topologyKey      # æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ</span></span>
<span class="line"><span>    labelSelector    # æ ‡ç­¾é€‰æ‹©å™¨</span></span>
<span class="line"><span>      matchExpressions  # æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span>
<span class="line"><span>        key    # é”®</span></span>
<span class="line"><span>        values # å€¼</span></span>
<span class="line"><span>        operator # å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist.</span></span>
<span class="line"><span>      matchLabels    # æŒ‡å¤šä¸ªmatchExpressionsæ˜ å°„çš„å†…å®¹</span></span>
<span class="line"><span>  preferredDuringSchedulingIgnoredDuringExecution # è½¯é™åˆ¶</span></span>
<span class="line"><span>    podAffinityTerm  # é€‰é¡¹</span></span>
<span class="line"><span>      namespaces      </span></span>
<span class="line"><span>      topologyKey</span></span>
<span class="line"><span>      labelSelector</span></span>
<span class="line"><span>        matchExpressions  </span></span>
<span class="line"><span>          key    # é”®</span></span>
<span class="line"><span>          values # å€¼</span></span>
<span class="line"><span>          operator</span></span>
<span class="line"><span>        matchLabels </span></span>
<span class="line"><span>    weight # å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>topologyKey ç”¨äºæŒ‡å®šè°ƒåº¦æ—¶ä½œç”¨åŸŸ,ä¾‹å¦‚:</span></span>
<span class="line"><span>    å¦‚æœæŒ‡å®šä¸ºkubernetes.io/hostnameï¼Œé‚£å°±æ˜¯ä»¥NodeèŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´</span></span>
<span class="line"><span>	  å¦‚æœæŒ‡å®šä¸ºbeta.kubernetes.io/os,åˆ™ä»¥NodeèŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-podaffinity-required.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-podaffinity-required</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  affinity:  #äº²å’Œæ€§è®¾ç½®</span></span>
<span class="line"><span>    podAffinity: #è®¾ç½®podäº²å’Œæ€§</span></span>
<span class="line"><span>      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶</span></span>
<span class="line"><span>      - labelSelector:</span></span>
<span class="line"><span>          matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾</span></span>
<span class="line"><span>          - key: podenv</span></span>
<span class="line"><span>            operator: In</span></span>
<span class="line"><span>            values: [&quot;xxx&quot;,&quot;yyy&quot;]</span></span>
<span class="line"><span>        topologyKey: kubernetes.io/hostname</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="podantiaffinity" tabindex="-1"><a class="header-anchor" href="#podantiaffinity"><span><strong>PodAntiAffinity</strong></span></a></h4><p>PodAntiAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œæ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podä¸åœ¨ä¸€ä¸ªåŒºåŸŸä¸­çš„åŠŸèƒ½ã€‚ä¸ä¸Šé¢çš„PodAffinityæ˜¯ä¸€ç§ç›¸åç­–ç•¥</p><h3 id="_5-4-3-æ±¡ç‚¹å’Œå®¹å¿" tabindex="-1"><a class="header-anchor" href="#_5-4-3-æ±¡ç‚¹å’Œå®¹å¿"><span>5.4.3 æ±¡ç‚¹å’Œå®¹å¿</span></a></h3><p><strong>æ±¡ç‚¹ï¼ˆTaintsï¼‰</strong><br> å‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨Podçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Podä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®šPodæ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„Nodeä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨Nodeçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Nodeä¸Šæ·»åŠ <strong>æ±¡ç‚¹</strong>å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦å…è®¸Podè°ƒåº¦è¿‡æ¥ã€‚<br><strong>Nodeè¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç»Podè°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ã€‚</strong><br> æ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼škey=value:effect, keyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š</p><ul><li><strong>PreferNoSchedule</strong>ï¼škuberneteså°†å°½é‡é¿å…æŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦</li><li><strong>NoSchedule</strong>ï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œä½†ä¸ä¼šå½±å“å½“å‰Nodeä¸Šå·²å­˜åœ¨çš„Pod</li><li><strong>NoExecute</strong>ï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²å­˜åœ¨çš„Podé©±ç¦»</li></ul><h4 id="æ±¡ç‚¹api" tabindex="-1"><a class="header-anchor" href="#æ±¡ç‚¹api"><span>æ±¡ç‚¹API</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># è®¾ç½®æ±¡ç‚¹</span></span>
<span class="line"><span>kubectl taint nodes k8s.node1 key=value:policy</span></span>
<span class="line"><span># å»é™¤æ±¡ç‚¹</span></span>
<span class="line"><span>kubectl taint nodes k8s.node2 key:policy-</span></span>
<span class="line"><span># å»é™¤æ‰€æœ‰æ±¡ç‚¹</span></span>
<span class="line"><span>kubectl taint nodes k8s.node2 key-</span></span>
<span class="line"><span># æŸ¥çœ‹æ±¡ç‚¹</span></span>
<span class="line"><span>kubectl describe node k8s.node1 | grep Taints</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>æ³¨æ„ï¼šä½¿ç”¨kubeadmæ­å»ºçš„é›†ç¾¤ï¼Œé»˜è®¤å°±ä¼šç»™masterèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°,æ‰€ä»¥podå°±ä¸ä¼šè°ƒåº¦åˆ°masterèŠ‚ç‚¹ä¸Š.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>å®¹å¿ï¼ˆTolerationï¼‰</strong></p><p>æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-toleration.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-toleration</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>  tolerations:      # æ·»åŠ å®¹å¿</span></span>
<span class="line"><span>  - key: &quot;tag&quot;        # è¦å®¹å¿çš„æ±¡ç‚¹çš„key  </span></span>
<span class="line"><span>    operator: &quot;Equal&quot; # æ“ä½œç¬¦  EqualExistsï¼ˆé»˜è®¤ï¼‰</span></span>
<span class="line"><span>    value: &quot;heima&quot;    # å®¹å¿çš„æ±¡ç‚¹çš„value</span></span>
<span class="line"><span>    effect: &quot;NoExecute&quot;   # æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl explain pod.spec.tolerations</span></span>
<span class="line"><span>......</span></span>
<span class="line"><span>FIELDS:</span></span>
<span class="line"><span>   key       # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”®</span></span>
<span class="line"><span>   value     # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼</span></span>
<span class="line"><span>   operator  # key-valueçš„è¿ç®—ç¬¦ï¼Œæ”¯æŒEqualå’ŒExistsï¼ˆé»˜è®¤ï¼‰</span></span>
<span class="line"><span>   effect    # å¯¹åº”æ±¡ç‚¹çš„effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“</span></span>
<span class="line"><span>   tolerationSeconds   # å®¹å¿æ—¶é—´, å½“effectä¸ºNoExecuteæ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºpodåœ¨Nodeä¸Šçš„åœç•™æ—¶é—´</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_6-podæ§åˆ¶å™¨è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_6-podæ§åˆ¶å™¨è¯¦è§£"><span>6. Podæ§åˆ¶å™¨è¯¦è§£</span></a></h1><h2 id="_6-1-podæ§åˆ¶å™¨ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_6-1-podæ§åˆ¶å™¨ä»‹ç»"><span>6.1 Podæ§åˆ¶å™¨ä»‹ç»</span></a></h2><p>Podæ˜¯kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><p>è‡ªä¸»å¼podï¼škubernetesç›´æ¥åˆ›å»ºå‡ºæ¥çš„Podï¼Œè¿™ç§podåˆ é™¤åå°±æ²¡æœ‰äº†ï¼Œä¹Ÿä¸ä¼šé‡å»º</p></li><li><p>æ§åˆ¶å™¨åˆ›å»ºçš„podï¼škubernetesé€šè¿‡æ§åˆ¶å™¨åˆ›å»ºçš„podï¼Œè¿™ç§podåˆ é™¤äº†ä¹‹åè¿˜ä¼šè‡ªåŠ¨é‡å»º</p></li></ul><p><strong>ä»€ä¹ˆæ˜¯Podæ§åˆ¶å™¨</strong><br> Podæ§åˆ¶å™¨æ˜¯ç®¡ç†podçš„ä¸­é—´å±‚ï¼Œä½¿ç”¨Podæ§åˆ¶å™¨ä¹‹åï¼Œåªéœ€è¦å‘Šè¯‰Podæ§åˆ¶å™¨ï¼Œæƒ³è¦å¤šå°‘ä¸ªä»€ä¹ˆæ ·çš„Podå°±å¯ä»¥äº†ï¼Œå®ƒä¼šåˆ›å»ºå‡ºæ»¡è¶³æ¡ä»¶çš„Podå¹¶ç¡®ä¿æ¯ä¸€ä¸ªPodèµ„æºå¤„äºç”¨æˆ·æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚å¦‚æœPodèµ„æºåœ¨è¿è¡Œä¸­å‡ºç°æ•…éšœï¼Œå®ƒä¼šåŸºäºæŒ‡å®šç­–ç•¥é‡æ–°ç¼–æ’Podã€‚<br> åœ¨kubernetesä¸­ï¼Œæœ‰å¾ˆå¤šç±»å‹çš„podæ§åˆ¶å™¨ï¼Œæ¯ç§éƒ½æœ‰è‡ªå·±çš„é€‚åˆçš„åœºæ™¯ï¼Œå¸¸è§çš„æœ‰ä¸‹é¢è¿™äº›ï¼š</p><ul><li>ReplicationControllerï¼šæ¯”è¾ƒåŸå§‹çš„podæ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±ReplicaSetæ›¿ä»£</li><li>ReplicaSetï¼šä¿è¯å‰¯æœ¬æ•°é‡ä¸€ç›´ç»´æŒåœ¨æœŸæœ›å€¼ï¼Œå¹¶æ”¯æŒpodæ•°é‡æ‰©ç¼©å®¹ï¼Œé•œåƒç‰ˆæœ¬å‡çº§</li><li><strong>Deployment</strong>ï¼šé€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶Podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€å›é€€ç‰ˆæœ¬</li><li>Horizontal Pod Autoscalerï¼šå¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨æ°´å¹³è°ƒæ•´Podçš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</li><li>DaemonSetï¼šåœ¨é›†ç¾¤ä¸­çš„æŒ‡å®šNodeä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡</li><li>Jobï¼šå®ƒåˆ›å»ºå‡ºæ¥çš„podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œä¸éœ€è¦é‡å¯æˆ–é‡å»ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</li><li>Cronjobï¼šå®ƒåˆ›å»ºçš„Podè´Ÿè´£å‘¨æœŸæ€§ä»»åŠ¡æ§åˆ¶ï¼Œä¸éœ€è¦æŒç»­åå°è¿è¡Œ</li><li>StatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨</li></ul><h2 id="_6-2-replicaset-rs" tabindex="-1"><a class="header-anchor" href="#_6-2-replicaset-rs"><span>6.2 ReplicaSet(RS)</span></a></h2><p>ReplicaSetçš„ä¸»è¦ä½œç”¨æ˜¯<strong>ä¿è¯ä¸€å®šæ•°é‡çš„podæ­£å¸¸è¿è¡Œ</strong>ï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›Podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦Podå‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹podæ•°é‡çš„æ‰©ç¼©å®¹å’Œé•œåƒç‰ˆæœ¬çš„å‡é™çº§ã€‚</p><p>ReplicaSetçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: apps/v1 # ç‰ˆæœ¬å·</span></span>
<span class="line"><span>kind: ReplicaSet # ç±»å‹       </span></span>
<span class="line"><span>metadata: # å…ƒæ•°æ®</span></span>
<span class="line"><span>  name: # rsåç§° </span></span>
<span class="line"><span>  namespace: # æ‰€å±å‘½åç©ºé—´ </span></span>
<span class="line"><span>  labels: #æ ‡ç­¾</span></span>
<span class="line"><span>    controller: rs</span></span>
<span class="line"><span>spec: # è¯¦æƒ…æè¿°</span></span>
<span class="line"><span>  replicas: 3 # å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span>  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span>
<span class="line"><span>    matchLabels:      # LabelsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      - {key: app, operator: In, values: [nginx-pod]}</span></span>
<span class="line"><span>  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œé¢ï¼Œéœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š</p><ul><li>replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</li><li>selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶åœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº†</li><li>templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰</li></ul><h3 id="replicaset-demo" tabindex="-1"><a class="header-anchor" href="#replicaset-demo"><span><strong>ReplicaSet Demo</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-replicaset.yaml</span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: ReplicaSet   </span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-replicaset</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector: </span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºrs</span></span>
<span class="line"><span>kubectl create -f pc-replicaset.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹rs</span></span>
<span class="line"><span># DESIRED:æœŸæœ›å‰¯æœ¬æ•°é‡  </span></span>
<span class="line"><span># CURRENT:å½“å‰å‰¯æœ¬æ•°é‡  </span></span>
<span class="line"><span># READY:å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡çš„å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span>kubectl get rs pc-replicaset -n dev -o wide</span></span>
<span class="line"><span># æŸ¥çœ‹å½“å‰æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„pod</span></span>
<span class="line"><span># è¿™é‡Œå‘ç°æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„podçš„åç§°æ˜¯åœ¨æ§åˆ¶å™¨åç§°åé¢æ‹¼æ¥äº†-xxxxxéšæœºç </span></span>
<span class="line"><span>kubectl get pod -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰©ç¼©å®¹" tabindex="-1"><a class="header-anchor" href="#æ‰©ç¼©å®¹"><span><strong>æ‰©ç¼©å®¹</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ç¼–è¾‘rsçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 6å³å¯</span></span>
<span class="line"><span>kubectl edit rs pc-replicaset -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span># å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤å®ç°</span></span>
<span class="line"><span># ä½¿ç”¨scaleå‘½ä»¤å®ç°æ‰©ç¼©å®¹ï¼Œ åé¢--replicas=nç›´æ¥æŒ‡å®šç›®æ ‡æ•°é‡å³å¯</span></span>
<span class="line"><span>kubectl scale rs pc-replicaset --replicas=2 -n dev</span></span>
<span class="line"><span># å‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œç«‹å³æŸ¥çœ‹ï¼Œå‘ç°å·²ç»æœ‰4ä¸ªå¼€å§‹å‡†å¤‡é€€å‡ºäº†</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span>#ç¨ç­‰ç‰‡åˆ»ï¼Œå°±åªå‰©ä¸‹2ä¸ªäº†</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é•œåƒå‡çº§" tabindex="-1"><a class="header-anchor" href="#é•œåƒå‡çº§"><span><strong>é•œåƒå‡çº§</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ç¼–è¾‘rsçš„å®¹å™¨é•œåƒ - image: nginx:1.17.2</span></span>
<span class="line"><span>kubectl edit rs pc-replicaset -n dev</span></span>
<span class="line"><span># å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†</span></span>
<span class="line"><span>kubectl get rs -n dev -o wide</span></span>
<span class="line"><span># åŒæ ·çš„é“ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å®Œæˆè¿™ä¸ªå·¥ä½œ</span></span>
<span class="line"><span># kubectl set image rs rsåç§° å®¹å™¨=é•œåƒç‰ˆæœ¬ -n namespace</span></span>
<span class="line"><span>kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev</span></span>
<span class="line"><span># å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†</span></span>
<span class="line"><span>kubectl get rs -n dev -o wide</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ é™¤replicaset" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤replicaset"><span><strong>åˆ é™¤ReplicaSet</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ä½¿ç”¨kubectl deleteå‘½ä»¤ä¼šåˆ é™¤æ­¤RSä»¥åŠå®ƒç®¡ç†çš„Pod</span></span>
<span class="line"><span># åœ¨kubernetesåˆ é™¤RSå‰ï¼Œä¼šå°†RSçš„replicasclearè°ƒæ•´ä¸º0ï¼Œç­‰å¾…æ‰€æœ‰çš„Podè¢«åˆ é™¤åï¼Œåœ¨æ‰§è¡ŒRSå¯¹è±¡çš„åˆ é™¤</span></span>
<span class="line"><span>kubectl delete rs pc-replicaset -n dev</span></span>
<span class="line"><span>kubectl get pod -n dev -o wide</span></span>
<span class="line"><span># å¦‚æœå¸Œæœ›ä»…ä»…åˆ é™¤RSå¯¹è±¡ï¼ˆä¿ç•™Podï¼‰ï¼Œå¯ä»¥ä½¿ç”¨kubectl deleteå‘½ä»¤æ—¶æ·»åŠ --cascade=falseé€‰é¡¹ï¼ˆä¸æ¨èï¼‰ã€‚</span></span>
<span class="line"><span>kubectl delete rs pc-replicaset -n dev --cascade=false</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span># ä¹Ÿå¯ä»¥ä½¿ç”¨yamlç›´æ¥åˆ é™¤(æ¨è)</span></span>
<span class="line"><span>kubectl delete -f pc-replicaset.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-3-deployment-deploy" tabindex="-1"><a class="header-anchor" href="#_6-3-deployment-deploy"><span>6.3 Deployment(Deploy)</span></a></h2><p>ä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨V1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥ç®€ä»‹ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentæ¯”ReplicaSetåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p><p>Deploymentä¸»è¦åŠŸèƒ½æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p><ul><li><p>æ”¯æŒReplicaSetçš„æ‰€æœ‰åŠŸèƒ½</p></li><li><p>æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­</p></li><li><p>æ”¯æŒæ»šåŠ¨å‡çº§å’Œå›æ»šç‰ˆæœ¬</p></li></ul><p>Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: apps/v1 # ç‰ˆæœ¬å·</span></span>
<span class="line"><span>kind: Deployment # ç±»å‹       </span></span>
<span class="line"><span>metadata: # å…ƒæ•°æ®</span></span>
<span class="line"><span>  name: # rsåç§° </span></span>
<span class="line"><span>  namespace: # æ‰€å±å‘½åç©ºé—´ </span></span>
<span class="line"><span>  labels: #æ ‡ç­¾</span></span>
<span class="line"><span>    controller: deploy</span></span>
<span class="line"><span>spec: # è¯¦æƒ…æè¿°</span></span>
<span class="line"><span>  replicas: 3 # å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span>  revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å›é€€æ—¶ç”¨çš„</span></span>
<span class="line"><span>  paused: false # æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false  deployment -&gt; pod éƒ¨ç½² æ˜¯å¦ç«‹å³æ‰§è¡Œ</span></span>
<span class="line"><span>  progressDeadlineSeconds: 600 # éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span></span>
<span class="line"><span>  strategy: # ç­–ç•¥</span></span>
<span class="line"><span>    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span>    rollingUpdate: # æ»šåŠ¨æ›´æ–°</span></span>
<span class="line"><span>      maxSurge: 30% # æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span></span>
<span class="line"><span>      maxUnavailable: 30% # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span></span>
<span class="line"><span>  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span>
<span class="line"><span>    matchLabels:      # LabelsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      - {key: app, operator: In, values: [nginx-pod]}</span></span>
<span class="line"><span>  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Deployment Demo</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-deployment.yaml</span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment      </span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-deployment</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec: </span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºdeployment</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true</span></span>
<span class="line"><span>deployment.apps/pc-deployment created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹deployment</span></span>
<span class="line"><span># UP-TO-DATE æœ€æ–°ç‰ˆæœ¬çš„podçš„æ•°é‡</span></span>
<span class="line"><span># AVAILABLE  å½“å‰å¯ç”¨çš„podçš„æ•°é‡</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev</span></span>
<span class="line"><span>NAME            READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span>pc-deployment   3/3     3            3           15s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹rs</span></span>
<span class="line"><span># å‘ç°rsçš„åç§°æ˜¯åœ¨åŸæ¥deploymentçš„åå­—åé¢æ·»åŠ äº†ä¸€ä¸ª10ä½æ•°çš„éšæœºä¸²</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get rs -n dev</span></span>
<span class="line"><span>NAME                       DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span>pc-deployment-6696798b78   3         3         3       23s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev</span></span>
<span class="line"><span>NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pc-deployment-6696798b78-d2c8n   1/1     Running   0          107s</span></span>
<span class="line"><span>pc-deployment-6696798b78-smpvp   1/1     Running   0          107s</span></span>
<span class="line"><span>pc-deployment-6696798b78-wvjd8   1/1     Running   0          107s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰©ç¼©å®¹-1" tabindex="-1"><a class="header-anchor" href="#æ‰©ç¼©å®¹-1"><span><strong>æ‰©ç¼©å®¹</strong></span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å˜æ›´å‰¯æœ¬æ•°é‡ä¸º5ä¸ª</span></span>
<span class="line"><span>kubectl scale deploy pc-deployment --replicas=5  -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹deployment</span></span>
<span class="line"><span>kubectl get deploy pc-deployment -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span># ç¼–è¾‘deploymentçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 4å³å¯</span></span>
<span class="line"><span>kubectl edit deploy pc-deployment -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é•œåƒæ›´æ–°" tabindex="-1"><a class="header-anchor" href="#é•œåƒæ›´æ–°"><span><strong>é•œåƒæ›´æ–°</strong></span></a></h3><p>deploymentæ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥:é‡å»ºæ›´æ–°å’Œæ»šåŠ¨æ›´æ–°,å¯ä»¥é€šè¿‡strategyæŒ‡å®šç­–ç•¥ç±»å‹,æ”¯æŒä¸¤ä¸ªå±æ€§:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>strategyï¼šæŒ‡å®šæ–°çš„Podæ›¿æ¢æ—§çš„Podçš„ç­–ç•¥ï¼Œ æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</span></span>
<span class="line"><span>  typeï¼šæŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥</span></span>
<span class="line"><span>    Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„Pod</span></span>
<span class="line"><span>    RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬Pod</span></span>
<span class="line"><span>  rollingUpdateï¼šå½“typeä¸ºRollingUpdateæ—¶ç”Ÿæ•ˆï¼Œç”¨äºä¸ºRollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</span></span>
<span class="line"><span>    maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span></span>
<span class="line"><span>    maxSurgeï¼š ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é‡å»ºæ›´æ–°" tabindex="-1"><a class="header-anchor" href="#é‡å»ºæ›´æ–°"><span>é‡å»ºæ›´æ–°</span></a></h4><ol><li>ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>spec:</span></span>
<span class="line"><span>  strategy: # ç­–ç•¥</span></span>
<span class="line"><span>    type: Recreate # é‡å»ºæ›´æ–°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å˜æ›´é•œåƒ</span></span>
<span class="line"><span>kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev</span></span>
<span class="line"><span># è§‚å¯Ÿå‡çº§è¿‡ç¨‹</span></span>
<span class="line"><span>[root@k8s-master01 ~]#  kubectl get pods -n dev -w</span></span>
<span class="line"><span>NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s</span></span>
<span class="line"><span>pc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s</span></span>
<span class="line"><span>pc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-675d469f8b-grn8z   1/1     Running             0          1s</span></span>
<span class="line"><span>pc-deployment-675d469f8b-67nz2   1/1     Running             0          1s</span></span>
<span class="line"><span>pc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ»šåŠ¨æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#æ»šåŠ¨æ›´æ–°"><span>æ»šåŠ¨æ›´æ–°</span></a></h4><ol><li>ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-deployment.yaml</span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment      </span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-deployment</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec: </span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  strategy: # ç­–ç•¥</span></span>
<span class="line"><span>    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span>    rollingUpdate:</span></span>
<span class="line"><span>      maxSurge: 25% </span></span>
<span class="line"><span>      maxUnavailable: 25%</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å˜æ›´é•œåƒ</span></span>
<span class="line"><span>kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev </span></span>
<span class="line"><span># è§‚å¯Ÿå‡çº§è¿‡ç¨‹</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev -w</span></span>
<span class="line"><span>NAME                           READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pc-deployment-c848d767-8rbzt   1/1     Running   0          31m</span></span>
<span class="line"><span>pc-deployment-c848d767-h4p68   1/1     Running   0          31m</span></span>
<span class="line"><span>pc-deployment-c848d767-hlmz4   1/1     Running   0          31m</span></span>
<span class="line"><span>pc-deployment-c848d767-rrqcn   1/1     Running   0          31m</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-966bf7f44-226rx   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-226rx   1/1     Running             0          1s</span></span>
<span class="line"><span>pc-deployment-c848d767-h4p68    0/1     Terminating         0          34m</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-cnd44   1/1     Running             0          2s</span></span>
<span class="line"><span>pc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-966bf7f44-px48p   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-px48p   1/1     Running             0          0s</span></span>
<span class="line"><span>pc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s</span></span>
<span class="line"><span>pc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m</span></span>
<span class="line"><span></span></span>
<span class="line"><span># è‡³æ­¤ï¼Œæ–°ç‰ˆæœ¬çš„podåˆ›å»ºå®Œæ¯•ï¼Œå°±ç‰ˆæœ¬çš„podé”€æ¯å®Œæ¯•</span></span>
<span class="line"><span># ä¸­é—´è¿‡ç¨‹æ˜¯æ»šåŠ¨è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¾¹é”€æ¯è¾¹åˆ›å»º</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼š</p><p>é•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ–</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æŸ¥çœ‹rs,å‘ç°åŸæ¥çš„rsçš„ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯podæ•°é‡å˜ä¸ºäº†0ï¼Œè€Œååˆæ–°äº§ç”Ÿäº†ä¸€ä¸ªrsï¼Œpodæ•°é‡ä¸º4</span></span>
<span class="line"><span># å…¶å®è¿™å°±æ˜¯deploymentèƒ½å¤Ÿè¿›è¡Œç‰ˆæœ¬å›é€€çš„å¥¥å¦™æ‰€åœ¨ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Š</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get rs -n dev</span></span>
<span class="line"><span>NAME                       DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span>pc-deployment-6696798b78   0         0         0       7m37s</span></span>
<span class="line"><span>pc-deployment-6696798b11   0         0         0       5m37s</span></span>
<span class="line"><span>pc-deployment-c848d76789   4         4         4       72s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç‰ˆæœ¬å›é€€" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬å›é€€"><span><strong>ç‰ˆæœ¬å›é€€</strong></span></a></h3><p>deploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœã€ç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ã€‚</p><p>kubectl rolloutï¼š ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š</p><ul><li>status æ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€</li><li>history æ˜¾ç¤º å‡çº§å†å²è®°å½•</li><li>pause æš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li><li>resume ç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li><li>restart é‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li><li>undo å›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨--to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æŸ¥çœ‹å½“å‰å‡çº§ç‰ˆæœ¬çš„çŠ¶æ€</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev</span></span>
<span class="line"><span>deployment &quot;pc-deployment&quot; successfully rolled out</span></span>
<span class="line"><span># æŸ¥çœ‹å‡çº§å†å²è®°å½•</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev</span></span>
<span class="line"><span>deployment.apps/pc-deployment</span></span>
<span class="line"><span>REVISION  CHANGE-CAUSE</span></span>
<span class="line"><span>1         kubectl create --filename=pc-deployment.yaml --record=true</span></span>
<span class="line"><span>2         kubectl create --filename=pc-deployment.yaml --record=true</span></span>
<span class="line"><span>3         kubectl create --filename=pc-deployment.yaml --record=true</span></span>
<span class="line"><span># å¯ä»¥å‘ç°æœ‰ä¸‰æ¬¡ç‰ˆæœ¬è®°å½•ï¼Œè¯´æ˜å®Œæˆè¿‡ä¸¤æ¬¡å‡çº§</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ç‰ˆæœ¬å›æ»š</span></span>
<span class="line"><span># è¿™é‡Œç›´æ¥ä½¿ç”¨--to-revision=1å›æ»šåˆ°äº†1ç‰ˆæœ¬ï¼Œ å¦‚æœçœç•¥è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ˜¯å›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯2ç‰ˆæœ¬</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev</span></span>
<span class="line"><span>deployment.apps/pc-deployment rolled back</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹å‘ç°ï¼Œé€šè¿‡nginxé•œåƒç‰ˆæœ¬å¯ä»¥å‘ç°åˆ°äº†ç¬¬ä¸€ç‰ˆ</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide</span></span>
<span class="line"><span>NAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         </span></span>
<span class="line"><span>pc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   </span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹rsï¼Œå‘ç°ç¬¬ä¸€ä¸ªrsä¸­æœ‰4ä¸ªpodè¿è¡Œï¼Œåé¢ä¸¤ä¸ªç‰ˆæœ¬çš„rsä¸­podä¸ºè¿è¡Œ</span></span>
<span class="line"><span># å…¶å®deploymentä¹‹æ‰€ä»¥å¯æ˜¯å®ç°ç‰ˆæœ¬çš„å›æ»šï¼Œå°±æ˜¯é€šè¿‡è®°å½•ä¸‹å†å²rsæ¥å®ç°çš„ï¼Œ</span></span>
<span class="line"><span># ä¸€æ—¦æƒ³å›æ»šåˆ°å“ªä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å°†å½“å‰ç‰ˆæœ¬podæ•°é‡é™ä¸º0ï¼Œç„¶åå°†å›æ»šç‰ˆæœ¬çš„podæå‡ä¸ºç›®æ ‡æ•°é‡å°±å¯ä»¥äº†</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get rs -n dev</span></span>
<span class="line"><span>NAME                       DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span>pc-deployment-6696798b78   4         4         4       78m</span></span>
<span class="line"><span>pc-deployment-966bf7f44    0         0         0       37m</span></span>
<span class="line"><span>pc-deployment-c848d767     0         0         0       71m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é‡‘ä¸é›€å‘å¸ƒ</strong></p><p>Deploymentæ§åˆ¶å™¨æ”¯æŒæ§åˆ¶æ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€œæš‚åœ(pause)â€æˆ–â€œç»§ç»­(resume)â€æ›´æ–°æ“ä½œã€‚</p><p>æ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„Podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°ç‰ˆæœ¬çš„Podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„Podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„é‡‘ä¸é›€å‘å¸ƒã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æ›´æ–°deploymentçš„ç‰ˆæœ¬ï¼Œå¹¶é…ç½®æš‚åœdeployment</span></span>
<span class="line"><span>[root@k8s-master01 ~]#  sudo kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp;  sudo kubectl rollout pause deployment pc-deployment  -n dev</span></span>
<span class="line"><span>deployment.apps/pc-deployment image updated</span></span>
<span class="line"><span>deployment.apps/pc-deployment paused</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#è§‚å¯Ÿæ›´æ–°çŠ¶æ€</span></span>
<span class="line"><span>[root@k8s-master01 ~]# sudo kubectl rollout status deploy pc-deployment -n dev</span></span>
<span class="line"><span>Waiting for deployment &quot;pc-deployment&quot; rollout to finish: 2 out of 4 new replicas have been updated...</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ç›‘æ§æ›´æ–°çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ–°å¢äº†ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¹¶æœªæŒ‰ç…§é¢„æœŸçš„çŠ¶æ€å»åˆ é™¤ä¸€ä¸ªæ—§çš„èµ„æºï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†pauseæš‚åœå‘½ä»¤</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get rs -n dev -o wide</span></span>
<span class="line"><span>NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         </span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   </span></span>
<span class="line"><span>pc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   </span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   </span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev</span></span>
<span class="line"><span>NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s</span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s</span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s</span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ç¡®ä¿æ›´æ–°çš„podæ²¡é—®é¢˜äº†ï¼Œç»§ç»­æ›´æ–°</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev</span></span>
<span class="line"><span>deployment.apps/pc-deployment resumed</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹æœ€åçš„æ›´æ–°æƒ…å†µ</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get rs -n dev -o wide</span></span>
<span class="line"><span>NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         </span></span>
<span class="line"><span>pc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   </span></span>
<span class="line"><span>pc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   </span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   </span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev</span></span>
<span class="line"><span>NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s</span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s</span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s</span></span>
<span class="line"><span>pc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ é™¤Deployment</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ é™¤deploymentï¼Œå…¶ä¸‹çš„rså’Œpodä¹Ÿå°†è¢«åˆ é™¤</span></span>
<span class="line"><span>kubectl delete -f pc-deployment.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-4-horizontal-pod-autoscaler-hpa" tabindex="-1"><a class="header-anchor" href="#_6-4-horizontal-pod-autoscaler-hpa"><span>6.4 Horizontal Pod Autoscaler(HPA)</span></a></h2><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°é€šè¿‡æ‰‹å·¥æ‰§è¡Œkubectl scaleå‘½ä»¤å®ç°Podæ‰©å®¹æˆ–ç¼©å®¹ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸ç¬¦åˆKubernetesçš„å®šä½ç›®æ ‡--è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€‚ KubernetesæœŸæœ›å¯ä»¥å®ç°é€šè¿‡ç›‘æµ‹Podçš„ä½¿ç”¨æƒ…å†µï¼Œå®ç°podæ•°é‡çš„è‡ªåŠ¨è°ƒæ•´ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†Horizontal Pod Autoscalerï¼ˆHPAï¼‰è¿™ç§æ§åˆ¶å™¨ã€‚<br> HPAå¯ä»¥è·å–æ¯ä¸ªPodåˆ©ç”¨ç‡ï¼Œç„¶åå’ŒHPAä¸­å®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼ŒåŒæ—¶è®¡ç®—å‡ºéœ€è¦ä¼¸ç¼©çš„å…·ä½“å€¼ï¼Œæœ€åå®ç°Podçš„æ•°é‡çš„è°ƒæ•´ã€‚å…¶å®HPAä¸ä¹‹å‰çš„Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§Kubernetesèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡è¿½è¸ªåˆ†æRCæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ï¼Œè¿™æ˜¯HPAçš„å®ç°åŸç†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒ<br><strong>1 å®‰è£…metrics-server</strong><br> metrics-serverå¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µ</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å®‰è£…git</span></span>
<span class="line"><span>[root@k8s-master01 ~]# yum install git -y</span></span>
<span class="line"><span># è·å–metrics-server, æ³¨æ„ä½¿ç”¨çš„ç‰ˆæœ¬</span></span>
<span class="line"><span>[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server</span></span>
<span class="line"><span># ä¿®æ”¹deployment, æ³¨æ„ä¿®æ”¹çš„æ˜¯é•œåƒå’Œåˆå§‹åŒ–å‚æ•°</span></span>
<span class="line"><span>[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml</span></span>
<span class="line"><span>æŒ‰å›¾ä¸­æ·»åŠ ä¸‹é¢é€‰é¡¹</span></span>
<span class="line"><span>hostNetwork: true</span></span>
<span class="line"><span>image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6</span></span>
<span class="line"><span>args:</span></span>
<span class="line"><span>- --kubelet-insecure-tls</span></span>
<span class="line"><span>- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># å®‰è£…metrics-server</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl apply -f ./</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹podè¿è¡Œæƒ…å†µ</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl get pod -n kube-system</span></span>
<span class="line"><span>metrics-server-6b976979db-2xwbj   1/1     Running   0          90s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ä½¿ç”¨kubectl top node æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl top node</span></span>
<span class="line"><span>NAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%</span></span>
<span class="line"><span>k8s-master01   289m         14%    1582Mi          54%       </span></span>
<span class="line"><span>k8s-node01     81m          4%     1195Mi          40%       </span></span>
<span class="line"><span>k8s-node02     72m          3%     1211Mi          41%  </span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl top pod -n kube-system</span></span>
<span class="line"><span>NAME                              CPU(cores)   MEMORY(bytes)</span></span>
<span class="line"><span>coredns-6955765f44-7ptsb          3m           9Mi</span></span>
<span class="line"><span>coredns-6955765f44-vcwr5          3m           8Mi</span></span>
<span class="line"><span>etcd-master                       14m          145Mi</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span># è‡³æ­¤,metrics-serverå®‰è£…å®Œæˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2 å‡†å¤‡deploymentå’Œservie</strong></p><p>åˆ›å»ºpc-hpa-pod.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  strategy: # ç­–ç•¥</span></span>
<span class="line"><span>    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span>  replicas: 1</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span>
<span class="line"><span>        resources: # èµ„æºé…é¢</span></span>
<span class="line"><span>          limits:  # é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span></span>
<span class="line"><span>            cpu: &quot;1&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span>
<span class="line"><span>          requests: # è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span></span>
<span class="line"><span>            cpu: &quot;100m&quot;  # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºservice</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æŸ¥çœ‹</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev</span></span>
<span class="line"><span>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span>deployment.apps/nginx   1/1     1            1           47s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAME                         READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span></span>
<span class="line"><span>service/nginx   NodePort   10.101.18.29   &lt;none&gt;        80:31830/TCP   35s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3 éƒ¨ç½²HPA</strong></p><p>åˆ›å»ºpc-hpa.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: autoscaling/v1</span></span>
<span class="line"><span>kind: HorizontalPodAutoscaler</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-hpa</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  minReplicas: 1  #æœ€å°podæ•°é‡</span></span>
<span class="line"><span>  maxReplicas: 10 #æœ€å¤§podæ•°é‡</span></span>
<span class="line"><span>  targetCPUUtilizationPercentage: 3 # CPUä½¿ç”¨ç‡æŒ‡æ ‡</span></span>
<span class="line"><span>  scaleTargetRef:   # æŒ‡å®šè¦æ§åˆ¶çš„nginxä¿¡æ¯</span></span>
<span class="line"><span>    apiVersion: apps/v1</span></span>
<span class="line"><span>    kind: Deployment</span></span>
<span class="line"><span>    name: nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºhpa</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml</span></span>
<span class="line"><span>horizontalpodautoscaler.autoscaling/pc-hpa created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹hpa</span></span>
<span class="line"><span>[root@k8s-master01 1.8+]# kubectl get hpa -n dev</span></span>
<span class="line"><span>NAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span></span>
<span class="line"><span>pc-hpa   Deployment/nginx   0%/3%     1         10        1          62s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4 æµ‹è¯•</strong></p><p>ä½¿ç”¨å‹æµ‹å·¥å…·å¯¹serviceåœ°å€192.168.5.4:31830è¿›è¡Œå‹æµ‹ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹hpaå’Œpodçš„å˜åŒ–<br> hpaå˜åŒ–</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[root@k8s-master01 ~]# kubectl get hpa -n dev -w</span></span>
<span class="line"><span>NAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  0%/3%   1     10     8      13m</span></span>
<span class="line"><span>pc-hpa  Deployment/nginx  0%/3%   1     10     1      14m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>deploymentå˜åŒ–</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[root@k8s-master01 ~]# kubectl get deployment -n dev -w</span></span>
<span class="line"><span>NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span>nginx   1/1     1            1           11m</span></span>
<span class="line"><span>nginx   1/4     1            1           13m</span></span>
<span class="line"><span>nginx   1/4     1            1           13m</span></span>
<span class="line"><span>nginx   1/4     1            1           13m</span></span>
<span class="line"><span>nginx   1/4     4            1           13m</span></span>
<span class="line"><span>nginx   1/8     4            1           14m</span></span>
<span class="line"><span>nginx   1/8     4            1           14m</span></span>
<span class="line"><span>nginx   1/8     4            1           14m</span></span>
<span class="line"><span>nginx   1/8     8            1           14m</span></span>
<span class="line"><span>nginx   2/8     8            2           14m</span></span>
<span class="line"><span>nginx   3/8     8            3           14m</span></span>
<span class="line"><span>nginx   4/8     8            4           14m</span></span>
<span class="line"><span>nginx   5/8     8            5           14m</span></span>
<span class="line"><span>nginx   6/8     8            6           14m</span></span>
<span class="line"><span>nginx   7/8     8            7           14m</span></span>
<span class="line"><span>nginx   8/8     8            8           15m</span></span>
<span class="line"><span>nginx   8/1     8            8           20m</span></span>
<span class="line"><span>nginx   8/1     8            8           20m</span></span>
<span class="line"><span>nginx   1/1     1            1           20m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>podå˜åŒ–</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev -w</span></span>
<span class="line"><span>NAME                     READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>nginx-7df9756ccc-bh8dr   1/1     Running   0          11m</span></span>
<span class="line"><span>nginx-7df9756ccc-cpgrv   0/1     Pending   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-8zhwk   0/1     Pending   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-rr9bn   0/1     Pending   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-cpgrv   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-8zhwk   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-rr9bn   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-m9gsj   0/1     Pending             0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-g56qb   0/1     Pending             0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-sl9c6   0/1     Pending             0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-fgst7   0/1     Pending             0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-g56qb   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-m9gsj   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-sl9c6   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-fgst7   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>nginx-7df9756ccc-8zhwk   1/1     Running             0          19s</span></span>
<span class="line"><span>nginx-7df9756ccc-rr9bn   1/1     Running             0          30s</span></span>
<span class="line"><span>nginx-7df9756ccc-m9gsj   1/1     Running             0          21s</span></span>
<span class="line"><span>nginx-7df9756ccc-cpgrv   1/1     Running             0          47s</span></span>
<span class="line"><span>nginx-7df9756ccc-sl9c6   1/1     Running             0          33s</span></span>
<span class="line"><span>nginx-7df9756ccc-g56qb   1/1     Running             0          48s</span></span>
<span class="line"><span>nginx-7df9756ccc-fgst7   1/1     Running             0          66s</span></span>
<span class="line"><span>nginx-7df9756ccc-fgst7   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span>nginx-7df9756ccc-8zhwk   1/1     Terminating         0          7m5s</span></span>
<span class="line"><span>nginx-7df9756ccc-cpgrv   1/1     Terminating         0          7m5s</span></span>
<span class="line"><span>nginx-7df9756ccc-g56qb   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span>nginx-7df9756ccc-rr9bn   1/1     Terminating         0          7m5s</span></span>
<span class="line"><span>nginx-7df9756ccc-m9gsj   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span>nginx-7df9756ccc-sl9c6   1/1     Terminating         0          6m50s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-5-daemonset-ds" tabindex="-1"><a class="header-anchor" href="#_6-5-daemonset-ds"><span>6.5 DaemonSet(DS)</span></a></h2><p>DaemonSetç±»å‹çš„æ§åˆ¶å™¨å¯ä»¥ä¿è¯åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚ä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªPodæä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»Podå°±é€‚åˆä½¿ç”¨DaemonSetç±»å‹çš„æ§åˆ¶å™¨åˆ›å»ºã€‚</p><p>DaemonSetæ§åˆ¶å™¨çš„ç‰¹ç‚¹ï¼š</p><ul><li><p>æ¯å½“å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒæŒ‡å®šçš„ Pod å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š</p></li><li><p>å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤æ—¶ï¼ŒPod ä¹Ÿå°±è¢«åƒåœ¾å›æ”¶äº†</p></li></ul><p>ä¸‹é¢å…ˆæ¥çœ‹ä¸‹DaemonSetçš„èµ„æºæ¸…å•æ–‡ä»¶</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: apps/v1 # ç‰ˆæœ¬å·</span></span>
<span class="line"><span>kind: DaemonSet # ç±»å‹       </span></span>
<span class="line"><span>metadata: # å…ƒæ•°æ®</span></span>
<span class="line"><span>  name: # rsåç§° </span></span>
<span class="line"><span>  namespace: # æ‰€å±å‘½åç©ºé—´ </span></span>
<span class="line"><span>  labels: #æ ‡ç­¾</span></span>
<span class="line"><span>    controller: daemonset</span></span>
<span class="line"><span>spec: # è¯¦æƒ…æè¿°</span></span>
<span class="line"><span>  revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬</span></span>
<span class="line"><span>  updateStrategy: # æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span>    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span>    rollingUpdate: # æ»šåŠ¨æ›´æ–°</span></span>
<span class="line"><span>      maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span></span>
<span class="line"><span>  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span>
<span class="line"><span>    matchLabels:      # LabelsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      - {key: app, operator: In, values: [nginx-pod]}</span></span>
<span class="line"><span>  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºpc-daemonset.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: DaemonSet      </span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-daemonset</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec: </span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºdaemonset</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml</span></span>
<span class="line"><span>daemonset.apps/pc-daemonset created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹daemonset</span></span>
<span class="line"><span>[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide</span></span>
<span class="line"><span>NAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         </span></span>
<span class="line"><span>pc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   </span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹pod,å‘ç°åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªpod</span></span>
<span class="line"><span>[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide</span></span>
<span class="line"><span>NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    </span></span>
<span class="line"><span>pc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     </span></span>
<span class="line"><span>pc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      </span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ é™¤daemonset</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml</span></span>
<span class="line"><span>daemonset.apps &quot;pc-daemonset&quot; deleted</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-6-job" tabindex="-1"><a class="header-anchor" href="#_6-6-job"><span>6.6 Job</span></a></h2><p>Jobï¼Œä¸»è¦ç”¨äºè´Ÿè´£**æ‰¹é‡å¤„ç†(ä¸€æ¬¡è¦å¤„ç†æŒ‡å®šæ•°é‡ä»»åŠ¡)<strong>çŸ­æš‚çš„</strong>ä¸€æ¬¡æ€§(æ¯ä¸ªä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡å°±ç»“æŸ)**ä»»åŠ¡ã€‚Jobç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>å½“Jobåˆ›å»ºçš„podæ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼ŒJobå°†è®°å½•æˆåŠŸç»“æŸçš„podæ•°é‡</p></li><li><p>å½“æˆåŠŸç»“æŸçš„podè¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼ŒJobå°†å®Œæˆæ‰§è¡Œ</p></li></ul><p>Jobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-job.yaml</span></span>
<span class="line"><span>apiVersion: batch/v1 # ç‰ˆæœ¬å·</span></span>
<span class="line"><span>kind: Job # ç±»å‹       </span></span>
<span class="line"><span>metadata: # å…ƒæ•°æ®</span></span>
<span class="line"><span>  name: # rsåç§° </span></span>
<span class="line"><span>  namespace: # æ‰€å±å‘½åç©ºé—´ </span></span>
<span class="line"><span>  labels: #æ ‡ç­¾</span></span>
<span class="line"><span>    controller: job</span></span>
<span class="line"><span>spec: # è¯¦æƒ…æè¿°</span></span>
<span class="line"><span>  completions: 1 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ã€‚é»˜è®¤å€¼: 1</span></span>
<span class="line"><span>  parallelism: 1 # æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ã€‚é»˜è®¤å€¼: 1</span></span>
<span class="line"><span>  activeDeadlineSeconds: 30 # æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢ã€‚</span></span>
<span class="line"><span>  backoffLimit: 6 # æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯6</span></span>
<span class="line"><span>  manualSelector: true # æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©podï¼Œé»˜è®¤æ˜¯false</span></span>
<span class="line"><span>  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span>
<span class="line"><span>    matchLabels:      # LabelsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      app: counter-pod</span></span>
<span class="line"><span>    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™</span></span>
<span class="line"><span>      - {key: app, operator: In, values: [counter-pod]}</span></span>
<span class="line"><span>  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: counter-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      restartPolicy: Never # é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–è€…OnFailure</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: counter</span></span>
<span class="line"><span>        image: busybox:1.30</span></span>
<span class="line"><span>        command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>å…³äºé‡å¯ç­–ç•¥è®¾ç½®çš„è¯´æ˜ï¼š</span></span>
<span class="line"><span>    å¦‚æœæŒ‡å®šä¸ºOnFailureï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºpodï¼Œfailedæ¬¡æ•°ä¸å˜</span></span>
<span class="line"><span>    å¦‚æœæŒ‡å®šä¸ºNeverï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶åˆ›å»ºæ–°çš„podï¼Œå¹¶ä¸”æ•…éšœpodä¸ä¼šæ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡å¯ï¼Œfailedæ¬¡æ•°åŠ 1</span></span>
<span class="line"><span>    å¦‚æœæŒ‡å®šä¸ºAlwaysçš„è¯ï¼Œå°±æ„å‘³ç€ä¸€ç›´é‡å¯ï¼Œæ„å‘³ç€jobä»»åŠ¡ä¼šé‡å¤å»æ‰§è¡Œäº†ï¼Œå½“ç„¶ä¸å¯¹ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸ºAlways</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºpc-job.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: batch/v1</span></span>
<span class="line"><span>kind: Job      </span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-job</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  manualSelector: true</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: counter-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: counter-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      restartPolicy: Never</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: counter</span></span>
<span class="line"><span>        image: busybox:1.30</span></span>
<span class="line"><span>        command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºjob</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f pc-job.yaml</span></span>
<span class="line"><span>job.batch/pc-job created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹job</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w</span></span>
<span class="line"><span>NAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR</span></span>
<span class="line"><span>pc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod</span></span>
<span class="line"><span>pc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod</span></span>
<span class="line"><span></span></span>
<span class="line"><span># é€šè¿‡è§‚å¯ŸpodçŠ¶æ€å¯ä»¥çœ‹åˆ°ï¼Œpodåœ¨è¿è¡Œå®Œæ¯•ä»»åŠ¡åï¼Œå°±ä¼šå˜æˆCompletedçŠ¶æ€</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev -w</span></span>
<span class="line"><span>NAME           READY   STATUS     RESTARTS      AGE</span></span>
<span class="line"><span>pc-job-rxg96   1/1     Running     0            29s</span></span>
<span class="line"><span>pc-job-rxg96   0/1     Completed   0            33s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æ¥ä¸‹æ¥ï¼Œè°ƒæ•´ä¸‹podè¿è¡Œçš„æ€»æ•°é‡å’Œå¹¶è¡Œæ•°é‡ å³ï¼šåœ¨specä¸‹è®¾ç½®ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹</span></span>
<span class="line"><span>#  completions: 6 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ä¸º6</span></span>
<span class="line"><span>#  parallelism: 3 # æŒ‡å®šjobå¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ä¸º3</span></span>
<span class="line"><span>#  ç„¶åé‡æ–°è¿è¡Œjobï¼Œè§‚å¯Ÿæ•ˆæœï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œjobä¼šæ¯æ¬¡è¿è¡Œ3ä¸ªpodï¼Œæ€»å…±æ‰§è¡Œäº†6ä¸ªpod</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev -w</span></span>
<span class="line"><span>NAME           READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pc-job-684ft   1/1     Running   0          5s</span></span>
<span class="line"><span>pc-job-jhj49   1/1     Running   0          5s</span></span>
<span class="line"><span>pc-job-pfcvh   1/1     Running   0          5s</span></span>
<span class="line"><span>pc-job-684ft   0/1     Completed   0          11s</span></span>
<span class="line"><span>pc-job-v7rhr   0/1     Pending     0          0s</span></span>
<span class="line"><span>pc-job-v7rhr   0/1     Pending     0          0s</span></span>
<span class="line"><span>pc-job-v7rhr   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-job-jhj49   0/1     Completed           0          11s</span></span>
<span class="line"><span>pc-job-fhwf7   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-job-fhwf7   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-job-pfcvh   0/1     Completed           0          11s</span></span>
<span class="line"><span>pc-job-5vg2j   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-job-fhwf7   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-job-5vg2j   0/1     Pending             0          0s</span></span>
<span class="line"><span>pc-job-5vg2j   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span>pc-job-fhwf7   1/1     Running             0          2s</span></span>
<span class="line"><span>pc-job-v7rhr   1/1     Running             0          2s</span></span>
<span class="line"><span>pc-job-5vg2j   1/1     Running             0          3s</span></span>
<span class="line"><span>pc-job-fhwf7   0/1     Completed           0          12s</span></span>
<span class="line"><span>pc-job-v7rhr   0/1     Completed           0          12s</span></span>
<span class="line"><span>pc-job-5vg2j   0/1     Completed           0          12s</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ é™¤job</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml</span></span>
<span class="line"><span>job.batch &quot;pc-job&quot; deleted</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-7-cronjob-cj" tabindex="-1"><a class="header-anchor" href="#_6-7-cronjob-cj"><span>6.7 CronJob(CJ)</span></a></h2><p>CronJobæ§åˆ¶å™¨ä»¥Jobæ§åˆ¶å™¨èµ„æºä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒJobæ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†CronJobå¯ä»¥ä»¥ç±»ä¼¼äºLinuxæ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å…¶è¿è¡Œ<strong>æ—¶é—´ç‚¹</strong>åŠ<strong>é‡å¤è¿è¡Œ</strong>çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>CronJobå¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹(åå¤çš„)å»è¿è¡Œjobä»»åŠ¡</strong>ã€‚</p><p>CronJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: batch/v1beta1 # ç‰ˆæœ¬å·</span></span>
<span class="line"><span>kind: CronJob # ç±»å‹       </span></span>
<span class="line"><span>metadata: # å…ƒæ•°æ®</span></span>
<span class="line"><span>  name: # rsåç§° </span></span>
<span class="line"><span>  namespace: # æ‰€å±å‘½åç©ºé—´ </span></span>
<span class="line"><span>  labels: #æ ‡ç­¾</span></span>
<span class="line"><span>    controller: cronjob</span></span>
<span class="line"><span>spec: # è¯¦æƒ…æè¿°</span></span>
<span class="line"><span>  schedule: # cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹,ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œ</span></span>
<span class="line"><span>  concurrencyPolicy: # å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡çš„ä½œä¸š</span></span>
<span class="line"><span>  failedJobHistoryLimit: # ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º1</span></span>
<span class="line"><span>  successfulJobHistoryLimit: # ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º3</span></span>
<span class="line"><span>  startingDeadlineSeconds: # å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿</span></span>
<span class="line"><span>  jobTemplate: # jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡;ä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      completions: 1</span></span>
<span class="line"><span>      parallelism: 1</span></span>
<span class="line"><span>      activeDeadlineSeconds: 30</span></span>
<span class="line"><span>      backoffLimit: 6</span></span>
<span class="line"><span>      manualSelector: true</span></span>
<span class="line"><span>      selector:</span></span>
<span class="line"><span>        matchLabels:</span></span>
<span class="line"><span>          app: counter-pod</span></span>
<span class="line"><span>        matchExpressions: è§„åˆ™</span></span>
<span class="line"><span>          - {key: app, operator: In, values: [counter-pod]}</span></span>
<span class="line"><span>      template:</span></span>
<span class="line"><span>        metadata:</span></span>
<span class="line"><span>          labels:</span></span>
<span class="line"><span>            app: counter-pod</span></span>
<span class="line"><span>        spec:</span></span>
<span class="line"><span>          restartPolicy: Never </span></span>
<span class="line"><span>          containers:</span></span>
<span class="line"><span>          - name: counter</span></span>
<span class="line"><span>            image: busybox:1.30</span></span>
<span class="line"><span>            command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://www.jianshu.com/p/e9ce1a7e1ed1" target="_blank" rel="noopener noreferrer">Cronè¡¨è¾¾å¼çš„è¯¦ç»†ç”¨æ³• - ç®€ä¹¦ (jianshu.com)</a></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>éœ€è¦é‡ç‚¹è§£é‡Šçš„å‡ ä¸ªé€‰é¡¹ï¼š</span></span>
<span class="line"><span>schedule: cronè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´</span></span>
<span class="line"><span>    */1    *      *    *     *</span></span>
<span class="line"><span>    &lt;åˆ†é’Ÿ&gt; &lt;å°æ—¶&gt; &lt;æ—¥&gt; &lt;æœˆä»½&gt; &lt;æ˜ŸæœŸ&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    åˆ†é’Ÿ å€¼ä» 0 åˆ° 59.</span></span>
<span class="line"><span>    å°æ—¶ å€¼ä» 0 åˆ° 23.</span></span>
<span class="line"><span>    æ—¥ å€¼ä» 1 åˆ° 31.</span></span>
<span class="line"><span>    æœˆ å€¼ä» 1 åˆ° 12.</span></span>
<span class="line"><span>    æ˜ŸæœŸ å€¼ä» 0 åˆ° 6, 0 ä»£è¡¨æ˜ŸæœŸæ—¥</span></span>
<span class="line"><span>    å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼› èŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼›*å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼› /è¡¨ç¤ºæ¯...</span></span>
<span class="line"><span>concurrencyPolicy:</span></span>
<span class="line"><span>    Allow:   å…è®¸Jobså¹¶å‘è¿è¡Œ(é»˜è®¤)</span></span>
<span class="line"><span>    Forbid:  ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¸Šä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ</span></span>
<span class="line"><span>    Replace: æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-cronjob.yaml</span></span>
<span class="line"><span>apiVersion: batch/v1beta1</span></span>
<span class="line"><span>kind: CronJob</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-cronjob</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    controller: cronjob</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  schedule: &quot;*/1 * * * *&quot;</span></span>
<span class="line"><span>  jobTemplate:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      template:</span></span>
<span class="line"><span>        spec:</span></span>
<span class="line"><span>          restartPolicy: Never</span></span>
<span class="line"><span>          containers:</span></span>
<span class="line"><span>          - name: counter</span></span>
<span class="line"><span>            image: busybox:1.30</span></span>
<span class="line"><span>            command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºcronjob</span></span>
<span class="line"><span>kubectl create -f pc-cronjob.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹cronjob</span></span>
<span class="line"><span>kubectl get cronjobs -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹job</span></span>
<span class="line"><span>kubectl get jobs -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods -n dev</span></span>
<span class="line"><span># åˆ é™¤cronjob</span></span>
<span class="line"><span>kubectl  delete -f pc-cronjob.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_7-serviceè¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_7-serviceè¯¦è§£"><span>7. Serviceè¯¦è§£</span></a></h1><h2 id="_7-1-serviceä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_7-1-serviceä»‹ç»"><span>7.1 Serviceä»‹ç»</span></a></h2><p>åœ¨kubernetesä¸­ï¼Œpodæ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡podçš„ipæ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯podçš„ipåœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨podçš„ipå¯¹æœåŠ¡è¿›è¡Œè®¿é—®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkubernetesæä¾›äº†Serviceèµ„æºï¼ŒServiceä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªpodè¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ã€‚é€šè¿‡è®¿é—®Serviceçš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„podæœåŠ¡ã€‚</p><p>Serviceåœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯kube-proxyæœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ªkube-proxyæœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»ºServiceçš„æ—¶å€™ä¼šé€šè¿‡api-serverå‘etcdå†™å…¥åˆ›å»ºçš„serviceçš„ä¿¡æ¯ï¼Œè€Œkube-proxyä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§Serviceçš„å˜åŠ¨ï¼Œç„¶å<strong>å®ƒä¼šå°†æœ€æ–°çš„Serviceä¿¡æ¯è½¬æ¢æˆå¯¹åº”çš„è®¿é—®è§„åˆ™</strong>ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 10.97.97.97:80 æ˜¯serviceæä¾›çš„è®¿é—®å…¥å£</span></span>
<span class="line"><span># å½“è®¿é—®è¿™ä¸ªå…¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°åé¢æœ‰ä¸‰ä¸ªpodçš„æœåŠ¡åœ¨ç­‰å¾…è°ƒç”¨ï¼Œ</span></span>
<span class="line"><span># kube-proxyä¼šåŸºäºrrï¼ˆè½®è¯¢ï¼‰çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä¸­ä¸€ä¸ªpodä¸Šå»</span></span>
<span class="line"><span># è¿™ä¸ªè§„åˆ™ä¼šåŒæ—¶åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè®¿é—®éƒ½å¯ä»¥ã€‚</span></span>
<span class="line"><span>[root@node1 ~]# ipvsadm -Ln</span></span>
<span class="line"><span>IP Virtual Server version 1.2.1 (size=4096)</span></span>
<span class="line"><span>Prot LocalAddress:Port Scheduler Flags</span></span>
<span class="line"><span>  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span>
<span class="line"><span>TCP  10.97.97.97:80 rr</span></span>
<span class="line"><span>  -&gt; 10.244.1.39:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.1.40:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.2.33:80               Masq    1      0          0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>kube-proxyç›®å‰æ”¯æŒä¸‰ç§å·¥ä½œæ¨¡å¼:</p><h3 id="userspace-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#userspace-æ¨¡å¼"><span><strong>userspace æ¨¡å¼</strong></span></a></h3><p>userspaceæ¨¡å¼ä¸‹ï¼Œkube-proxyä¼šä¸ºæ¯ä¸€ä¸ªServiceåˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘Cluster<br> IPçš„è¯·æ±‚è¢«Iptablesè§„åˆ™é‡å®šå‘åˆ°kube-proxyç›‘å¬çš„ç«¯å£ä¸Šï¼Œkube-proxyæ ¹æ®LBç®—æ³•é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„Podå¹¶å’Œå…¶å»ºç«‹é“¾æ¥ï¼Œä»¥å°†è¯·æ±‚è½¬å‘åˆ°Podä¸Šã€‚</p><p>è¯¥æ¨¡å¼ä¸‹ï¼Œkube-proxyå……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äºkube-proxyè¿è¡Œåœ¨userspaceä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†æ—¶ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡æ¯”è¾ƒä½ã€‚</p><h3 id="iptables-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#iptables-æ¨¡å¼"><span><strong>iptables æ¨¡å¼</strong></span></a></h3><p>iptablesæ¨¡å¼ä¸‹ï¼Œkube-proxyä¸ºserviceåç«¯çš„æ¯ä¸ªPodåˆ›å»ºå¯¹åº”çš„iptablesè§„åˆ™ï¼Œç›´æ¥å°†å‘å‘Cluster<br> IPçš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ªPod IPã€‚<br> è¯¥æ¨¡å¼ä¸‹kube-proxyä¸æ‰¿æ‹…å››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»ºiptablesè§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯è¾ƒuserspaceæ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†ä¸èƒ½æä¾›çµæ´»çš„LBç­–ç•¥ï¼Œå½“åç«¯Podä¸å¯ç”¨æ—¶ä¹Ÿæ— æ³•è¿›è¡Œé‡è¯•ã€‚</p><h3 id="ipvs-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ipvs-æ¨¡å¼"><span><strong>ipvs æ¨¡å¼</strong></span></a></h3><p>ipvsæ¨¡å¼å’Œiptablesç±»ä¼¼ï¼Œkube-proxyç›‘æ§Podçš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„ipvsè§„åˆ™ã€‚ipvsç›¸å¯¹iptablesè½¬å‘æ•ˆç‡æ›´é«˜ã€‚é™¤æ­¤ä»¥å¤–ï¼Œipvsæ”¯æŒæ›´å¤šçš„LBç®—æ³•ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æ­¤æ¨¡å¼å¿…é¡»å®‰è£…ipvså†…æ ¸æ¨¡å—ï¼Œå¦åˆ™ä¼šé™çº§ä¸ºiptables</span></span>
<span class="line"><span># å¼€å¯ipvs</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system</span></span>
<span class="line"><span># ä¿®æ”¹mode: &quot;ipvs&quot;</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system</span></span>
<span class="line"><span>[root@node1 ~]# ipvsadm -Ln</span></span>
<span class="line"><span>IP Virtual Server version 1.2.1 (size=4096)</span></span>
<span class="line"><span>Prot LocalAddress:Port Scheduler Flags</span></span>
<span class="line"><span>  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span>
<span class="line"><span>TCP  10.97.97.97:80 rr</span></span>
<span class="line"><span>  -&gt; 10.244.1.39:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.1.40:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.2.33:80               Masq    1      0          0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-2-serviceç±»å‹" tabindex="-1"><a class="header-anchor" href="#_7-2-serviceç±»å‹"><span>7.2 Serviceç±»å‹</span></a></h2><p>Serviceçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kind: Service  # èµ„æºç±»å‹</span></span>
<span class="line"><span>apiVersion: v1  # èµ„æºç‰ˆæœ¬</span></span>
<span class="line"><span>metadata: # å…ƒæ•°æ®</span></span>
<span class="line"><span>  name: service # èµ„æºåç§°</span></span>
<span class="line"><span>  namespace: dev # å‘½åç©ºé—´</span></span>
<span class="line"><span>spec: # æè¿°</span></span>
<span class="line"><span>  selector: # æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰serviceä»£ç†å“ªäº›pod</span></span>
<span class="line"><span>    app: nginx</span></span>
<span class="line"><span>  type: # Serviceç±»å‹ï¼ŒæŒ‡å®šserviceçš„è®¿é—®æ–¹å¼</span></span>
<span class="line"><span>  clusterIP:  # è™šæ‹ŸæœåŠ¡çš„ipåœ°å€</span></span>
<span class="line"><span>  sessionAffinity: # sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹</span></span>
<span class="line"><span>  ports: # ç«¯å£ä¿¡æ¯</span></span>
<span class="line"><span>    - protocol: TCP </span></span>
<span class="line"><span>      port: 3017  # serviceç«¯å£</span></span>
<span class="line"><span>      targetPort: 5003 # podç«¯å£</span></span>
<span class="line"><span>      nodePort: 31122 # ä¸»æœºç«¯å£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>ClusterIP</strong>ï¼šé»˜è®¤å€¼ï¼Œå®ƒæ˜¯Kubernetesç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p></li><li><p><strong>NodePort</strong>ï¼šå°†Serviceé€šè¿‡æŒ‡å®šçš„Nodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡</p></li><li><p><strong>LoadBalancer</strong>ï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒæ”¯æŒ</p></li><li><p><strong>ExternalName</strong>ï¼š æŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨</p></li></ul><h2 id="_7-3-serviceä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_7-3-serviceä½¿ç”¨"><span>7.3 Serviceä½¿ç”¨</span></a></h2><h3 id="_7-3-1-å®éªŒç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_7-3-1-å®éªŒç¯å¢ƒå‡†å¤‡"><span>7.3.1 å®éªŒç¯å¢ƒå‡†å¤‡</span></a></h3><p>åœ¨ä½¿ç”¨serviceä¹‹å‰ï¼Œé¦–å…ˆåˆ©ç”¨Deploymentåˆ›å»ºå‡º3ä¸ªpodï¼Œæ³¨æ„è¦ä¸ºpodè®¾ç½®app=nginx-podçš„æ ‡ç­¾</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-deployment.yaml</span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment      </span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pc-deployment</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec: </span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml</span></span>
<span class="line"><span>deployment.apps/pc-deployment created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹podè¯¦æƒ…</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels</span></span>
<span class="line"><span>NAME                             READY   STATUS     IP            NODE     LABELS</span></span>
<span class="line"><span>pc-deployment-66cb59b984-8p84h   1/1     Running    10.244.1.39   node1    app=nginx-pod</span></span>
<span class="line"><span>pc-deployment-66cb59b984-vx8vx   1/1     Running    10.244.2.33   node2    app=nginx-pod</span></span>
<span class="line"><span>pc-deployment-66cb59b984-wnncx   1/1     Running    10.244.1.40   node1    app=nginx-pod</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ä¸ºäº†æ–¹ä¾¿åé¢çš„æµ‹è¯•ï¼Œä¿®æ”¹ä¸‹ä¸‰å°nginxçš„index.htmlé¡µé¢ï¼ˆä¸‰å°ä¿®æ”¹çš„IPåœ°å€ä¸ä¸€è‡´ï¼‰</span></span>
<span class="line"><span>sudo kubectl exec -it pc-deployment-5ffc5bf56c-sg76p -n dev /bin/sh</span></span>
<span class="line"><span> echo &quot;1&quot; &gt; /usr/share/nginx/html/index.html</span></span>
<span class="line"><span> exit</span></span>
<span class="line"><span>sudo kubectl exec -it pc-deployment-5ffc5bf56c-hzp79 -n dev /bin/sh</span></span>
<span class="line"><span> echo &quot;2&quot; &gt; /usr/share/nginx/html/index.html</span></span>
<span class="line"><span>  exit</span></span>
<span class="line"><span>sudo kubectl exec -it pc-deployment-5ffc5bf56c-46rht -n dev /bin/sh</span></span>
<span class="line"><span> echo &quot;3&quot; &gt; /usr/share/nginx/html/index.html</span></span>
<span class="line"><span>  exit</span></span>
<span class="line"><span>#ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œè®¿é—®æµ‹è¯•</span></span>
<span class="line"><span>[root@k8s-master01 ~]# curl 10.244.1.39</span></span>
<span class="line"><span>10.244.1.39</span></span>
<span class="line"><span>[root@k8s-master01 ~]# curl 10.244.2.33</span></span>
<span class="line"><span>10.244.2.33</span></span>
<span class="line"><span>[root@k8s-master01 ~]# curl 10.244.1.40</span></span>
<span class="line"><span>10.244.1.40</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-2-clusteripç±»å‹çš„service" tabindex="-1"><a class="header-anchor" href="#_7-3-2-clusteripç±»å‹çš„service"><span>7.3.2 ClusterIPç±»å‹çš„Service</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-service-clusterip.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: service-clusterip</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    app: nginx-pod</span></span>
<span class="line"><span>  clusterIP: 10.96.97.97 # serviceçš„ipåœ°å€ï¼Œå¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ª</span></span>
<span class="line"><span>  type: ClusterIP</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>  - port: 80  # Serviceç«¯å£       </span></span>
<span class="line"><span>    targetPort: 80 # podç«¯å£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºservice</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f pc-service-clusterip.yaml</span></span>
<span class="line"><span>service/service-clusterip created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹service</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get svc -n dev -o wide</span></span>
<span class="line"><span>NAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR</span></span>
<span class="line"><span>service-clusterip   ClusterIP   10.96.97.97   &lt;none&gt;        80/TCP    13s   app=nginx-pod</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹serviceçš„è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span># åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªEndpointsåˆ—è¡¨ï¼Œé‡Œé¢å°±æ˜¯å½“å‰serviceå¯ä»¥è´Ÿè½½åˆ°çš„æœåŠ¡å…¥å£</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev</span></span>
<span class="line"><span>Name:              service-clusterip</span></span>
<span class="line"><span>Namespace:         dev</span></span>
<span class="line"><span>Labels:            &lt;none&gt;</span></span>
<span class="line"><span>Annotations:       &lt;none&gt;</span></span>
<span class="line"><span>Selector:          app=nginx-pod</span></span>
<span class="line"><span>Type:              ClusterIP</span></span>
<span class="line"><span>IP:                10.97.97.97</span></span>
<span class="line"><span>Port:              &lt;unset&gt;  80/TCP</span></span>
<span class="line"><span>TargetPort:        80/TCP</span></span>
<span class="line"><span>Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80</span></span>
<span class="line"><span>Session Affinity:  None</span></span>
<span class="line"><span>Events:            &lt;none&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™</span></span>
<span class="line"><span>[root@k8s-master01 ~]# ipvsadm -Ln</span></span>
<span class="line"><span>TCP  10.97.97.97:80 rr</span></span>
<span class="line"><span>  -&gt; 10.244.1.39:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.1.40:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.2.33:80               Masq    1      0          0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># è®¿é—®10.97.97.97:80è§‚å¯Ÿæ•ˆæœ</span></span>
<span class="line"><span>[root@k8s-master01 ~]# curl 10.97.97.97:80</span></span>
<span class="line"><span>10.244.2.33</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Endpoint</strong></p><p>Endpointæ˜¯kubernetesä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨etcdä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®serviceé…ç½®æ–‡ä»¶ä¸­selectoræè¿°äº§ç”Ÿçš„ã€‚</p><p>ä¸€ä¸ªServiceç”±ä¸€ç»„Podç»„æˆï¼Œè¿™äº›Podé€šè¿‡Endpointsæš´éœ²å‡ºæ¥ï¼Œ<strong>Endpointsæ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆ</strong>ã€‚æ¢å¥è¯è¯´ï¼Œserviceå’Œpodä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡endpointså®ç°çš„ã€‚</p><p><strong>è´Ÿè½½åˆ†å‘ç­–ç•¥</strong></p><p>å¯¹Serviceçš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„Podä¸Šå»ï¼Œç›®å‰kubernetesæä¾›äº†ä¸¤ç§è´Ÿè½½åˆ†å‘ç­–ç•¥ï¼š</p><ul><li><p>å¦‚æœä¸å®šä¹‰ï¼Œé»˜è®¤ä½¿ç”¨kube-proxyçš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢</p></li><li><p>åŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ªPodä¸Š<br> æ­¤æ¨¡å¼å¯ä»¥ä½¿åœ¨specä¸­æ·»åŠ sessionAffinity:ClientIPé€‰é¡¹</p></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>sudo kubectl get endpoints -n dev -o wide</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™ã€rr è½®è¯¢ã€‘</span></span>
<span class="line"><span>[root@k8s-master01 ~]# ipvsadm -Ln</span></span>
<span class="line"><span>TCP  10.97.97.97:80 rr</span></span>
<span class="line"><span>  -&gt; 10.244.1.39:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.1.40:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.2.33:80               Masq    1      0          0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¾ªç¯è®¿é—®æµ‹è¯•</span></span>
<span class="line"><span>[root@k8s-master01 ~]# while true;do curl 10.96.97.97:80; sleep 1; done;</span></span>
<span class="line"><span>10.244.1.40</span></span>
<span class="line"><span>10.244.1.39</span></span>
<span class="line"><span>10.244.2.33</span></span>
<span class="line"><span>10.244.1.40</span></span>
<span class="line"><span>10.244.1.39</span></span>
<span class="line"><span>10.244.2.33</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ä¿®æ”¹åˆ†å‘ç­–ç•¥----sessionAffinity:ClientIP</span></span>
<span class="line"><span># æŸ¥çœ‹ipvsè§„åˆ™ã€persistent ä»£è¡¨æŒä¹…ã€‘</span></span>
<span class="line"><span>[root@k8s-master01 ~]# ipvsadm -Ln</span></span>
<span class="line"><span>TCP  10.97.97.97:80 rr persistent 10800</span></span>
<span class="line"><span>  -&gt; 10.244.1.39:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.1.40:80               Masq    1      0          0</span></span>
<span class="line"><span>  -&gt; 10.244.2.33:80               Masq    1      0          0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å¾ªç¯è®¿é—®æµ‹è¯•</span></span>
<span class="line"><span>[root@k8s-master01 ~]# while true;do curl 192.168.150.136:30002; sleep 1; done;</span></span>
<span class="line"><span>10.244.2.33</span></span>
<span class="line"><span>10.244.2.33</span></span>
<span class="line"><span>10.244.2.33</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span># åˆ é™¤service</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml</span></span>
<span class="line"><span>service &quot;service-clusterip&quot; deleted</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-3-headlinessç±»å‹çš„service" tabindex="-1"><a class="header-anchor" href="#_7-3-3-headlinessç±»å‹çš„service"><span>7.3.3 HeadLinessç±»å‹çš„Service</span></a></h3><p>åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨Serviceæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†HeadLiness Serviceï¼Œè¿™ç±»Serviceä¸ä¼šåˆ†é…Cluster IPï¼Œå¦‚æœæƒ³è¦è®¿é—®serviceï¼Œ<strong>åªèƒ½é€šè¿‡serviceçš„åŸŸåè¿›è¡ŒæŸ¥è¯¢</strong>ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># service-headliness.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: service-headliness</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    app: nginx-pod</span></span>
<span class="line"><span>  clusterIP: None # å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service</span></span>
<span class="line"><span>  type: ClusterIP</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>  - port: 80    </span></span>
<span class="line"><span>    targetPort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºservice</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml</span></span>
<span class="line"><span>service/service-headliness created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># è·å–serviceï¼Œ å‘ç°CLUSTER-IPæœªåˆ†é…</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide</span></span>
<span class="line"><span>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR</span></span>
<span class="line"><span>service-headliness   ClusterIP   None         &lt;none&gt;        80/TCP    11s   app=nginx-pod</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹serviceè¯¦æƒ…</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev</span></span>
<span class="line"><span>Name:              service-headliness</span></span>
<span class="line"><span>Namespace:         dev</span></span>
<span class="line"><span>Labels:            &lt;none&gt;</span></span>
<span class="line"><span>Annotations:       &lt;none&gt;</span></span>
<span class="line"><span>Selector:          app=nginx-pod</span></span>
<span class="line"><span>Type:              ClusterIP</span></span>
<span class="line"><span>IP:                None</span></span>
<span class="line"><span>Port:              &lt;unset&gt;  80/TCP</span></span>
<span class="line"><span>TargetPort:        80/TCP</span></span>
<span class="line"><span>Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80</span></span>
<span class="line"><span>Session Affinity:  None</span></span>
<span class="line"><span>Events:            &lt;none&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹åŸŸåçš„è§£ææƒ…å†µ</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh</span></span>
<span class="line"><span>/ # cat /etc/resolv.conf</span></span>
<span class="line"><span>nameserver 10.96.0.10</span></span>
<span class="line"><span>search dev.svc.cluster.local svc.cluster.local cluster.local</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local</span></span>
<span class="line"><span>service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40</span></span>
<span class="line"><span>service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39</span></span>
<span class="line"><span>service-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-4-nodeportç±»å‹çš„service" tabindex="-1"><a class="header-anchor" href="#_7-3-4-nodeportç±»å‹çš„service"><span>7.3.4 NodePortç±»å‹çš„Service</span></a></h3><p>åœ¨ä¹‹å‰çš„æ ·ä¾‹ä¸­ï¼Œåˆ›å»ºçš„Serviceçš„ipåœ°å€åªæœ‰é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›å°†Serviceæš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„Serviceï¼Œç§°ä¸ºNodePortç±»å‹ã€‚NodePortçš„å·¥ä½œåŸç†å…¶å®å°±æ˜¯<strong>å°†serviceçš„ç«¯å£æ˜ å°„åˆ°Nodeçš„ä¸€ä¸ªç«¯å£ä¸Š</strong>ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡NodeIp:NodePortæ¥è®¿é—®serviceäº†ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-service-nodeport.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: service-nodeport</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    app: nginx-pod</span></span>
<span class="line"><span>  type: NodePort # serviceç±»å‹</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>  - port: 80</span></span>
<span class="line"><span>    nodePort: 30002 # æŒ‡å®šç»‘å®šçš„nodeçš„ç«¯å£(é»˜è®¤çš„å–å€¼èŒƒå›´æ˜¯ï¼š30000-32767), å¦‚æœä¸æŒ‡å®šï¼Œä¼šé»˜è®¤åˆ†é…</span></span>
<span class="line"><span>    targetPort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºservice</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f pc-service-nodeport.yaml</span></span>
<span class="line"><span>service/service-nodeport created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹service</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get svc -n dev -o wide</span></span>
<span class="line"><span>NAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR</span></span>
<span class="line"><span>service-nodeport   NodePort   10.105.64.191   &lt;none&gt;        80:30002/TCP  app=nginx-pod</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ç”µè„‘ä¸»æœºçš„æµè§ˆå™¨å»è®¿é—®é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªnodeipçš„30002ç«¯å£ï¼Œå³å¯è®¿é—®åˆ°pod</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-5-loadbalancerç±»å‹çš„service" tabindex="-1"><a class="header-anchor" href="#_7-3-5-loadbalancerç±»å‹çš„service"><span>7.3.5 LoadBalancerç±»å‹çš„Service</span></a></h3><p>LoadBalancerå’ŒNodePortå¾ˆç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€ä¸ªç«¯å£ï¼ŒåŒºåˆ«åœ¨äºLoadBalancerä¼šåœ¨é›†ç¾¤çš„å¤–éƒ¨å†æ¥åšä¸€ä¸ªè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè€Œè¿™ä¸ªè®¾å¤‡éœ€è¦å¤–éƒ¨ç¯å¢ƒæ”¯æŒçš„ï¼Œå¤–éƒ¨æœåŠ¡å‘é€åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šçš„è¯·æ±‚ï¼Œä¼šè¢«è®¾å¤‡è´Ÿè½½ä¹‹åè½¬å‘åˆ°é›†ç¾¤ä¸­ã€‚</p><h3 id="_7-3-6-externalnameç±»å‹çš„service" tabindex="-1"><a class="header-anchor" href="#_7-3-6-externalnameç±»å‹çš„service"><span>7.3.6 ExternalNameç±»å‹çš„Service</span></a></h3><p>ExternalNameç±»å‹çš„Serviceç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡externalNameå±æ€§æŒ‡å®šå¤–éƒ¨ä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤serviceå°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: service-externalname</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  type: ExternalName # serviceç±»å‹</span></span>
<span class="line"><span>  externalName: www.baidu.com  #æ”¹æˆipåœ°å€ä¹Ÿå¯ä»¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºservice</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml</span></span>
<span class="line"><span>service/service-externalname created</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åŸŸåè§£æ</span></span>
<span class="line"><span>[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local</span></span>
<span class="line"><span>service-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.</span></span>
<span class="line"><span>www.baidu.com.          30      IN      CNAME   www.a.shifen.com.</span></span>
<span class="line"><span>www.a.shifen.com.       30      IN      A       39.156.66.18</span></span>
<span class="line"><span>www.a.shifen.com.       30      IN      A       39.156.66.14</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-4-ingressä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_7-4-ingressä»‹ç»"><span>7.4 Ingressä»‹ç»</span></a></h2><p>åœ¨å‰é¢è¯¾ç¨‹ä¸­å·²ç»æåˆ°ï¼ŒServiceå¯¹é›†ç¾¤ä¹‹å¤–æš´éœ²æœåŠ¡çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼šNotePortå’ŒLoadBalancerï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼ï¼Œéƒ½æœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼š</p><ul><li><p>NodePortæ–¹å¼çš„ç¼ºç‚¹æ˜¯ä¼šå ç”¨å¾ˆå¤šé›†ç¾¤æœºå™¨çš„ç«¯å£ï¼Œé‚£ä¹ˆå½“é›†ç¾¤æœåŠ¡å˜å¤šçš„æ—¶å€™ï¼Œè¿™ä¸ªç¼ºç‚¹å°±æ„ˆå‘æ˜æ˜¾</p></li><li><p>LBæ–¹å¼çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªserviceéœ€è¦ä¸€ä¸ªLBï¼Œæµªè´¹ã€éº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦kubernetesä¹‹å¤–è®¾å¤‡çš„æ”¯æŒ</p></li></ul><p>åŸºäºè¿™ç§ç°çŠ¶ï¼Œkubernetesæä¾›äº†Ingressèµ„æºå¯¹è±¡ï¼ŒIngressåªéœ€è¦ä¸€ä¸ªNodePortæˆ–è€…ä¸€ä¸ªLBå°±å¯ä»¥æ»¡è¶³æš´éœ²å¤šä¸ªServiceçš„éœ€æ±‚ã€‚å·¥ä½œæœºåˆ¶å¤§è‡´å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š</p><p>å®é™…ä¸Šï¼ŒIngressç›¸å½“äºä¸€ä¸ª7å±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ˜¯kuberneteså¯¹åå‘ä»£ç†çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºNginxï¼Œå¯ä»¥ç†è§£æˆåœ¨<strong>Ingressé‡Œå»ºç«‹è¯¸å¤šæ˜ å°„è§„åˆ™ï¼ŒIngress Controlleré€šè¿‡ç›‘å¬è¿™äº›é…ç½®è§„åˆ™å¹¶è½¬åŒ–æˆNginxçš„åå‘ä»£ç†é…ç½® , ç„¶åå¯¹å¤–éƒ¨æä¾›æœåŠ¡</strong>ã€‚åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ul><li><p>ingressï¼škubernetesä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•è½¬å‘åˆ°serviceçš„è§„åˆ™</p></li><li><p>ingress controllerï¼šå…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹ingresså®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ï¼Œå®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Nginx, Contour, Haproxyç­‰ç­‰</p></li></ul><p>Ingressï¼ˆä»¥Nginxä¸ºä¾‹ï¼‰çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><ol><li><p>ç”¨æˆ·ç¼–å†™Ingressè§„åˆ™ï¼Œè¯´æ˜å“ªä¸ªåŸŸåå¯¹åº”kubernetesé›†ç¾¤ä¸­çš„å“ªä¸ªService</p></li><li><p>Ingressæ§åˆ¶å™¨åŠ¨æ€æ„ŸçŸ¥IngressæœåŠ¡è§„åˆ™çš„å˜åŒ–ï¼Œç„¶åç”Ÿæˆä¸€æ®µå¯¹åº”çš„Nginxåå‘ä»£ç†é…ç½®</p></li><li><p>Ingressæ§åˆ¶å™¨ä¼šå°†ç”Ÿæˆçš„Nginxé…ç½®å†™å…¥åˆ°ä¸€ä¸ªè¿è¡Œç€çš„NginxæœåŠ¡ä¸­ï¼Œå¹¶åŠ¨æ€æ›´æ–°</p></li><li><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®çœŸæ­£åœ¨å·¥ä½œçš„å°±æ˜¯ä¸€ä¸ªNginxäº†ï¼Œå†…éƒ¨é…ç½®äº†ç”¨æˆ·å®šä¹‰çš„è¯·æ±‚è½¬å‘è§„åˆ™</p></li></ol><h2 id="_7-5-ingressä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_7-5-ingressä½¿ç”¨"><span>7.5 Ingressä½¿ç”¨</span></a></h2><h3 id="_7-5-1-ç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_7-5-1-ç¯å¢ƒå‡†å¤‡"><span>7.5.1 ç¯å¢ƒå‡†å¤‡</span></a></h3><h4 id="æ­å»ºingressç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#æ­å»ºingressç¯å¢ƒ"><span><strong>æ­å»ºingressç¯å¢ƒ</strong></span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl apply -f ingress-control.yaml</span></span>
<span class="line"><span>kubectl get pod -n ingress-nginx</span></span>
<span class="line"><span># æŸ¥çœ‹service</span></span>
<span class="line"><span>kubectl get svc -n ingress-nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å‡†å¤‡serviceå’Œpod" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡serviceå’Œpod"><span><strong>å‡†å¤‡serviceå’Œpod</strong></span></a></h4><p>ä¸ºäº†åé¢çš„å®éªŒæ¯”è¾ƒæ–¹ä¾¿ï¼Œåˆ›å»ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å‹</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># tomcat-nginx.yaml</span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx-deployment</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: nginx-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: nginx-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: nginx</span></span>
<span class="line"><span>        image: nginx:1.17.1</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: tomcat-deployment</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  replicas: 3</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: tomcat-pod</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: tomcat-pod</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: tomcat</span></span>
<span class="line"><span>        image: tomcat:8.5-jre10-slim</span></span>
<span class="line"><span>        ports:</span></span>
<span class="line"><span>        - containerPort: 8080</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: nginx-service</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    app: nginx-pod</span></span>
<span class="line"><span>  clusterIP: None</span></span>
<span class="line"><span>  type: ClusterIP</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>  - port: 80</span></span>
<span class="line"><span>    targetPort: 80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: tomcat-service</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    app: tomcat-pod</span></span>
<span class="line"><span>  clusterIP: None</span></span>
<span class="line"><span>  type: ClusterIP</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>  - port: 8080</span></span>
<span class="line"><span>    targetPort: 8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-2-httpä»£ç†" tabindex="-1"><a class="header-anchor" href="#_7-5-2-httpä»£ç†"><span>7.5.2 Httpä»£ç†</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-ingress-http.yaml</span></span>
<span class="line"><span># kubectl explain Ingress.spec.rules.http.paths.backend.service</span></span>
<span class="line"><span>apiVersion: networking.k8s.io/v1</span></span>
<span class="line"><span>kind: Ingress</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: ingress-http</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  - host: nginx.itheima.com</span></span>
<span class="line"><span>    http:</span></span>
<span class="line"><span>      paths:</span></span>
<span class="line"><span>      - path: /</span></span>
<span class="line"><span>        pathType: Prefix</span></span>
<span class="line"><span>        backend:</span></span>
<span class="line"><span>          service:</span></span>
<span class="line"><span>            name: nginx-service</span></span>
<span class="line"><span>            port: </span></span>
<span class="line"><span>              number: 80</span></span>
<span class="line"><span>  - host: tomcat.itheima.com</span></span>
<span class="line"><span>    http:</span></span>
<span class="line"><span>      paths:</span></span>
<span class="line"><span>      - path: /</span></span>
<span class="line"><span>        pathType: Prefix</span></span>
<span class="line"><span>        backend:</span></span>
<span class="line"><span>          service:</span></span>
<span class="line"><span>            name: tomcat-service</span></span>
<span class="line"><span>            port: </span></span>
<span class="line"><span>              number: 8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»º</span></span>
<span class="line"><span>kubectl apply -f pc-ingress-http.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹</span></span>
<span class="line"><span>sudo kubectl get ing ingress-http -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹è¯¦æƒ…</span></span>
<span class="line"><span>sudo kubectl describe ing ingress-http  -n dev</span></span>
<span class="line"><span># æ³¨æ„çœ‹ä¸Šé¢çš„Addressæ </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-3-httpsä»£ç†" tabindex="-1"><a class="header-anchor" href="#_7-5-3-httpsä»£ç†"><span>7.5.3 Httpsä»£ç†</span></a></h3><h4 id="åˆ›å»ºè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºè¯ä¹¦"><span>åˆ›å»ºè¯ä¹¦</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ç”Ÿæˆè¯ä¹¦</span></span>
<span class="line"><span>openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ›å»ºå¯†é’¥</span></span>
<span class="line"><span>kubectl create secret tls tls-secret --key tls.key --cert tls.crt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ingress-https.yaml</span></span>
<span class="line"><span>apiVersion: extensions/v1beta1</span></span>
<span class="line"><span>kind: Ingress</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: ingress-https</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  tls:</span></span>
<span class="line"><span>    - hosts:</span></span>
<span class="line"><span>      - nginx.itheima.com</span></span>
<span class="line"><span>      - tomcat.itheima.com</span></span>
<span class="line"><span>      secretName: tls-secret # æŒ‡å®šç§˜é’¥</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  - host: nginx.itheima.com</span></span>
<span class="line"><span>    http:</span></span>
<span class="line"><span>      paths:</span></span>
<span class="line"><span>      - path: /</span></span>
<span class="line"><span>        backend:</span></span>
<span class="line"><span>          serviceName: nginx-service</span></span>
<span class="line"><span>          servicePort: 80</span></span>
<span class="line"><span>  - host: tomcat.itheima.com</span></span>
<span class="line"><span>    http:</span></span>
<span class="line"><span>      paths:</span></span>
<span class="line"><span>      - path: /</span></span>
<span class="line"><span>        backend:</span></span>
<span class="line"><span>          serviceName: tomcat-service</span></span>
<span class="line"><span>          servicePort: 8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»º</span></span>
<span class="line"><span>kubectl create -f ingress-https.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹</span></span>
<span class="line"><span>kubectl get ing ingress-https -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹è¯¦æƒ…</span></span>
<span class="line"><span>kubectl describe ing ingress-https -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_8-æ•°æ®å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#_8-æ•°æ®å­˜å‚¨"><span>8. æ•°æ®å­˜å‚¨</span></a></h1><p>ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µã€‚</p><p>Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å®¹å™¨ä¸ä¸Podä¸­å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p><p>kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p><ul><li><p>ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS</p></li><li><p>é«˜çº§å­˜å‚¨ï¼šPVã€PVC</p></li><li><p>é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret</p></li></ul><h2 id="_8-1-åŸºæœ¬å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#_8-1-åŸºæœ¬å­˜å‚¨"><span>8.1 åŸºæœ¬å­˜å‚¨</span></a></h2><h3 id="_8-1-1-emptydir" tabindex="-1"><a class="header-anchor" href="#_8-1-1-emptydir"><span>8.1.1 EmptyDir</span></a></h3><p>EmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½•ã€‚</p><p>EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼Œ EmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirç”¨é€”å¦‚ä¸‹ï¼š</p><ul><li><p><strong>ä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™</strong></p></li><li><p><strong>ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰</strong></p></li></ul><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´æ–‡ä»¶å…±äº«çš„æ¡ˆä¾‹æ¥ä½¿ç”¨ä¸€ä¸‹EmptyDirã€‚</p><p>åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxï¼Œç„¶åå£°æ˜ä¸€ä¸ªVolumeåˆ†åˆ«æŒ‚åœ¨åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘Volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># volume-emptydir.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: volume-emptydir</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - containerPort: 80</span></span>
<span class="line"><span>    volumeMounts:  # å°†logs-volumeæŒ‚åœ¨åˆ°nginxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º /var/log/nginx</span></span>
<span class="line"><span>    - name: logs-volume</span></span>
<span class="line"><span>      mountPath: /var/log/nginx</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;] # åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­å†…å®¹</span></span>
<span class="line"><span>    volumeMounts:  # å°†logs-volume æŒ‚åœ¨åˆ°busyboxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º /logs</span></span>
<span class="line"><span>    - name: logs-volume</span></span>
<span class="line"><span>      mountPath: /logs</span></span>
<span class="line"><span>  volumes: # å£°æ˜volumeï¼Œ nameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span></span>
<span class="line"><span>  - name: logs-volume</span></span>
<span class="line"><span>    emptyDir: {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºPod</span></span>
<span class="line"><span>kubectl create -f volume-emptydir.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods volume-emptydir -n dev -o wide</span></span>
<span class="line"><span># é€šè¿‡podIpè®¿é—®nginx</span></span>
<span class="line"><span>curl 10.42.2.9</span></span>
<span class="line"><span># é€šè¿‡kubectl logså‘½ä»¤æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ ‡å‡†è¾“å‡º</span></span>
<span class="line"><span>kubectl logs -f volume-emptydir -n dev -c busybox</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-1-2-hostpath" tabindex="-1"><a class="header-anchor" href="#_8-1-2-hostpath"><span>8.1.2 HostPath</span></a></h3><p>HostPathå°±æ˜¯å°†Nodeä¸»æœºä¸­ä¸€ä¸ªå®é™…ç›®å½•æŒ‚åœ¨åˆ°Podä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯Podé”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ®å¯ä»¥å­˜åœ¨äºNodeä¸»æœºä¸Šã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># volume-hostpath.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: volume-hostpath</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - containerPort: 80</span></span>
<span class="line"><span>    volumeMounts:</span></span>
<span class="line"><span>    - name: logs-volume</span></span>
<span class="line"><span>      mountPath: /var/log/nginx</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;]</span></span>
<span class="line"><span>    volumeMounts:</span></span>
<span class="line"><span>    - name: logs-volume</span></span>
<span class="line"><span>      mountPath: /logs</span></span>
<span class="line"><span>  volumes:</span></span>
<span class="line"><span>  - name: volume</span></span>
<span class="line"><span>    persistentVolumeClaim:</span></span>
<span class="line"><span>      claimName: pvc1</span></span>
<span class="line"><span>      readOnly: false</span></span>
<span class="line"><span>  - name: logs-volume</span></span>
<span class="line"><span>    hostPath: </span></span>
<span class="line"><span>      path: /root/logs</span></span>
<span class="line"><span>      type: DirectoryOrCreate  # ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># sudo kubectl apply -f volume-hostpath.yaml</span></span>
<span class="line"><span>å…³äºtypeçš„å€¼çš„ä¸€ç‚¹è¯´æ˜ï¼š</span></span>
<span class="line"><span>    DirectoryOrCreate ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨</span></span>
<span class="line"><span>    Directory   ç›®å½•å¿…é¡»å­˜åœ¨</span></span>
<span class="line"><span>    FileOrCreate  æ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨</span></span>
<span class="line"><span>    File æ–‡ä»¶å¿…é¡»å­˜åœ¨ </span></span>
<span class="line"><span>    Socket  unixå¥—æ¥å­—å¿…é¡»å­˜åœ¨</span></span>
<span class="line"><span>    CharDevice  å­—ç¬¦è®¾å¤‡å¿…é¡»å­˜åœ¨</span></span>
<span class="line"><span>    BlockDevice å—è®¾å¤‡å¿…é¡»å­˜åœ¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-1-3-nfs" tabindex="-1"><a class="header-anchor" href="#_8-1-3-nfs"><span>8.1.3 NFS</span></a></h3><p>HostPathå¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦NodeèŠ‚ç‚¹æ•…éšœäº†ï¼ŒPodå¦‚æœè½¬ç§»åˆ°äº†åˆ«çš„èŠ‚ç‚¹ï¼Œåˆä¼šå‡ºç°é—®é¢˜äº†ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç”¨NFSã€CIFSã€‚</p><p>NFSæ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°NFSæœåŠ¡å™¨ï¼Œç„¶åå°†Podä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°NFSç³»ç»Ÿä¸Šï¼Œè¿™æ ·çš„è¯ï¼Œæ— è®ºPodåœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦Nodeè·ŸNFSçš„å¯¹æ¥æ²¡é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>nfså®‰è£…è§ Linuxç¯å¢ƒé…ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># volume-nfs.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: volume-nfs</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>    - containerPort: 80</span></span>
<span class="line"><span>    volumeMounts:</span></span>
<span class="line"><span>    - name: logs-volume</span></span>
<span class="line"><span>      mountPath: /var/log/nginx</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;] </span></span>
<span class="line"><span>    volumeMounts:</span></span>
<span class="line"><span>    - name: logs-volume</span></span>
<span class="line"><span>      mountPath: /logs</span></span>
<span class="line"><span>  volumes:</span></span>
<span class="line"><span>  - name: logs-volume</span></span>
<span class="line"><span>    nfs:</span></span>
<span class="line"><span>      server: 192.168.5.6  #nfsæœåŠ¡å™¨åœ°å€</span></span>
<span class="line"><span>      path: /root/data/nfs #å…±äº«æ–‡ä»¶è·¯å¾„</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># æŸ¥çœ‹ä¸»èŠ‚ç‚¹æŒ‚è½½ç›®å½•</span></span>
<span class="line"><span>showmount -e</span></span>
<span class="line"><span># åˆ›å»ºpod</span></span>
<span class="line"><span>kubectl create -f volume-nfs.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods volume-nfs -n dev</span></span>
<span class="line"><span># æŸ¥çœ‹nfsæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•ï¼Œå‘ç°å·²ç»æœ‰æ–‡ä»¶äº†</span></span>
<span class="line"><span>ls /root/data/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-2-é«˜çº§å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#_8-2-é«˜çº§å­˜å‚¨"><span>8.2 é«˜çº§å­˜å‚¨</span></a></h2><p>PVï¼ˆPersistent Volumeï¼‰æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹PVç”±kubernetesç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒä¸åº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆä¸å…±äº«å­˜å‚¨çš„å¯¹æ¥ã€‚</p><p>PVCï¼ˆPersistent Volume Claimï¼‰æ˜¯æŒä¹…å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢å¥è¯è¯´ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘kubernetesç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·ã€‚</p><p>ä½¿ç”¨äº†PVå’ŒPVCä¹‹åï¼Œå·¥ä½œå¯ä»¥å¾—åˆ°è¿›ä¸€æ­¥çš„ç»†åˆ†ï¼š</p><ul><li><p>å­˜å‚¨ï¼šå­˜å‚¨å·¥ç¨‹å¸ˆç»´æŠ¤</p></li><li><p>PVï¼š kubernetesç®¡ç†å‘˜ç»´æŠ¤</p></li><li><p>PVCï¼škubernetesç”¨æˆ·ç»´æŠ¤</p></li></ul><h3 id="_8-2-1-pv" tabindex="-1"><a class="header-anchor" href="#_8-2-1-pv"><span>8.2.1 PV</span></a></h3><p>PVæ˜¯å­˜å‚¨èµ„æºçš„æŠ½è±¡ï¼Œä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1  </span></span>
<span class="line"><span>kind: PersistentVolume</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pv2</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  nfs: # å­˜å‚¨ç±»å‹ï¼Œä¸åº•å±‚çœŸæ­£å­˜å‚¨å¯¹åº”</span></span>
<span class="line"><span>  capacity:  # å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span></span>
<span class="line"><span>    storage: 2Gi</span></span>
<span class="line"><span>  accessModes:  # è®¿é—®æ¨¡å¼</span></span>
<span class="line"><span>  storageClassName: # å­˜å‚¨ç±»åˆ«</span></span>
<span class="line"><span>  persistentVolumeReclaimPolicy: # å›æ”¶ç­–ç•¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PV çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š</p><ul><li><p><strong>å­˜å‚¨ç±»å‹</strong><br> åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œkubernetesæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®éƒ½æœ‰æ‰€å·®å¼‚</p></li><li><p><strong>å­˜å‚¨èƒ½åŠ›ï¼ˆcapacityï¼‰</strong></p></li></ul><p>ç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®( storage=1Gi )ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥IOPSã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®</p><ul><li><p><strong>è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰</strong><br> ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼ï¼š</p><ul><li><p>ReadWriteOnceï¼ˆRWOï¼‰ï¼šè¯»å†™æƒé™ï¼Œä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½</p></li><li><p>ReadOnlyManyï¼ˆROXï¼‰ï¼š åªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p></li><li><p>ReadWriteManyï¼ˆRWXï¼‰ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p></li></ul></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ</p><ul><li>**å›æ”¶ç­–ç•¥ï¼ˆpersistentVolumeReclaimPolicyï¼‰**å½“PVä¸å†è¢«ä½¿ç”¨äº†ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ã€‚ç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥ï¼š <ul><li>Retain ï¼ˆä¿ç•™ï¼‰ ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹å·¥æ¸…ç†æ•°æ®</li><li>Recycleï¼ˆå›æ”¶ï¼‰ æ¸…é™¤ PV ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äºæ‰§è¡Œ rm -rf /thevolume/*</li><li>Delete ï¼ˆåˆ é™¤ï¼‰ ä¸ PV ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ volume çš„åˆ é™¤æ“ä½œï¼Œå½“ç„¶è¿™å¸¸è§äºäº‘æœåŠ¡å•†çš„å­˜å‚¨æœåŠ¡</li></ul></li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ</li><li><strong>å­˜å‚¨ç±»åˆ«</strong>PVå¯ä»¥é€šè¿‡storageClassNameå‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ« <ul><li>å…·æœ‰ç‰¹å®šç±»åˆ«çš„PVåªèƒ½ä¸è¯·æ±‚äº†è¯¥ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š</li><li>æœªè®¾å®šç±»åˆ«çš„PVåˆ™åªèƒ½ä¸ä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š</li></ul></li><li>**çŠ¶æ€ï¼ˆstatusï¼‰**ä¸€ä¸ª PV çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ä¸­ä¸åŒçš„é˜¶æ®µï¼š <ul><li>Availableï¼ˆå¯ç”¨ï¼‰ï¼š è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½• PVC ç»‘å®š</li><li>Boundï¼ˆå·²ç»‘å®šï¼‰ï¼š è¡¨ç¤º PV å·²ç»è¢« PVC ç»‘å®š</li><li>Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼š è¡¨ç¤º PVC è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜</li><li>Failedï¼ˆå¤±è´¥ï¼‰ï¼š è¡¨ç¤ºè¯¥ PV çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li></ul></li></ul><p><strong>å®éªŒ</strong><br> ä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ï¼Œæ¥æ¼”ç¤ºPVçš„ä½¿ç”¨ï¼Œåˆ›å»º3ä¸ªPVï¼Œå¯¹åº”NFSä¸­çš„3ä¸ªæš´éœ²çš„è·¯å¾„ã€‚</p><ol><li>å‡†å¤‡NFSç¯å¢ƒ</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºç›®å½•</span></span>
<span class="line"><span>mkdir /nfs/test/{pv1,pv2,pv3} -pv</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æš´éœ²æœåŠ¡</span></span>
<span class="line"><span>cat &gt;  /etc/exports &lt;&lt;EOF  # è¦†ç›–å†™ï¼</span></span>
<span class="line"><span>/nfs/test/pv1     192.168.150.0/24(rw,no_root_squash)</span></span>
<span class="line"><span>/nfs/test/pv2     192.168.150.0/24(rw,no_root_squash)</span></span>
<span class="line"><span>/nfs/test/pv3     192.168.150.0/24(rw,no_root_squash)</span></span>
<span class="line"><span>/nfs/data  *(rw,async,no_root_squash)</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>systemctl restart nfs</span></span>
<span class="line"><span>service nfs status</span></span>
<span class="line"><span>echo &quot;/nfs/data/ 192.168.150.0/24(insecure,rw,sync,no_root_squash)&quot;  &gt;&gt; /etc/exports  #è¿½åŠ å†™</span></span>
<span class="line"><span></span></span>
<span class="line"><span>systemctl status rpcbind</span></span>
<span class="line"><span>systemctl status nfs</span></span>
<span class="line"><span></span></span>
<span class="line"><span>umount /nfs/data</span></span>
<span class="line"><span>mount -t nfs 192.168.150.135:/nfs/data /nfs/data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆ›å»º</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pv-test001.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolume</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name:  pv1</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    number: pv1</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  capacity: </span></span>
<span class="line"><span>    storage: 1Gi</span></span>
<span class="line"><span>  accessModes:</span></span>
<span class="line"><span>  - ReadWriteMany</span></span>
<span class="line"><span>  nfs:</span></span>
<span class="line"><span>    path: /nfs/test/pv1</span></span>
<span class="line"><span>    server: 192.168.150.135</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolume</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name:  pv2</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    number: pv2</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  capacity: </span></span>
<span class="line"><span>    storage: 2Gi</span></span>
<span class="line"><span>  accessModes:</span></span>
<span class="line"><span>  - ReadWriteMany</span></span>
<span class="line"><span>  nfs:</span></span>
<span class="line"><span>    path: /nfs/test/pv2</span></span>
<span class="line"><span>    server: 192.168.150.135</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolume</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name:  pv3</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    number: pv3</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  capacity: </span></span>
<span class="line"><span>    storage: 3Gi</span></span>
<span class="line"><span>  accessModes:</span></span>
<span class="line"><span>  - ReadWriteMany</span></span>
<span class="line"><span>  nfs:</span></span>
<span class="line"><span>    path: /nfs/test/pv3</span></span>
<span class="line"><span>    server: 192.168.150.135</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»º pv</span></span>
<span class="line"><span>sudo kubectl apply -f pv-test001.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pv</span></span>
<span class="line"><span>kubectl get pv -o wide</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-2-pvc" tabindex="-1"><a class="header-anchor" href="#_8-2-2-pvc"><span>8.2.2 PVC</span></a></h3><p>PVCæ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolumeClaim</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pvc</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  accessModes: # è®¿é—®æ¨¡å¼</span></span>
<span class="line"><span>  selector: # é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©</span></span>
<span class="line"><span>  storageClassName: # å­˜å‚¨ç±»åˆ«</span></span>
<span class="line"><span>  resources: # è¯·æ±‚ç©ºé—´</span></span>
<span class="line"><span>    requests:</span></span>
<span class="line"><span>      storage: 5Gi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PVC çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š</p><ul><li><strong>è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰</strong></li></ul><p>ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™</p><ul><li><p><strong>é€‰æ‹©æ¡ä»¶ï¼ˆselectorï¼‰</strong><br> é€šè¿‡Label Selectorçš„è®¾ç½®ï¼Œå¯ä½¿PVCå¯¹äºç³»ç»Ÿä¸­å·±å­˜åœ¨çš„PVè¿›è¡Œç­›é€‰</p></li><li><p><strong>å­˜å‚¨ç±»åˆ«ï¼ˆstorageClassNameï¼‰</strong><br> PVCåœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥classçš„pvæ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º</p></li><li><p><strong>èµ„æºè¯·æ±‚ï¼ˆResources ï¼‰</strong><br> æè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚</p></li></ul><p><strong>å®éªŒ</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pvc-test001.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolumeClaim</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pvc1</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  accessModes: </span></span>
<span class="line"><span>  - ReadWriteMany</span></span>
<span class="line"><span>  resources:</span></span>
<span class="line"><span>    requests:</span></span>
<span class="line"><span>      storage: 1Gi </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolumeClaim</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pvc2</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  accessModes: </span></span>
<span class="line"><span>  - ReadWriteMany</span></span>
<span class="line"><span>  resources:</span></span>
<span class="line"><span>    requests:</span></span>
<span class="line"><span>      storage: 1Gi</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: PersistentVolumeClaim</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pvc3</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  accessModes: </span></span>
<span class="line"><span>  - ReadWriteMany</span></span>
<span class="line"><span>  resources:</span></span>
<span class="line"><span>    requests:</span></span>
<span class="line"><span>      storage: 1Gi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºpvc</span></span>
<span class="line"><span>sudo kubectl apply -f pvc-test001.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pvc</span></span>
<span class="line"><span>sudo kubectl get pvc  -n dev -o wide</span></span>
<span class="line"><span># æŸ¥çœ‹pv</span></span>
<span class="line"><span>sudo kubectl get pv -o wide</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pods-test001.yaml  ä½¿ç”¨pvc</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod1</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 1; done;&quot;]</span></span>
<span class="line"><span>    volumeMounts:</span></span>
<span class="line"><span>    - name: volume</span></span>
<span class="line"><span>      mountPath: /root</span></span>
<span class="line"><span>  volumes:</span></span>
<span class="line"><span>    - name: volume</span></span>
<span class="line"><span>      persistentVolumeClaim:</span></span>
<span class="line"><span>        claimName: pvc1</span></span>
<span class="line"><span>        readOnly: false</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod2</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: busybox</span></span>
<span class="line"><span>    image: busybox:1.30</span></span>
<span class="line"><span>    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do echo pod2 &gt;&gt; /root/out.txt; sleep 1; done;&quot;]</span></span>
<span class="line"><span>    volumeMounts:</span></span>
<span class="line"><span>    - name: volume</span></span>
<span class="line"><span>      mountPath: /root</span></span>
<span class="line"><span>  volumes:</span></span>
<span class="line"><span>    - name: volume</span></span>
<span class="line"><span>      persistentVolumeClaim:</span></span>
<span class="line"><span>        claimName: pvc2</span></span>
<span class="line"><span>        readOnly: false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl exec -it pod1 -n dev -- /bin/bash </span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ›å»ºpod</span></span>
<span class="line"><span>sudo kubectl apply -f pods-test001.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pods -n dev -o wide</span></span>
<span class="line"><span># æŸ¥çœ‹pvc</span></span>
<span class="line"><span>kubectl get pvc -n dev -o yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pvæŒ‚è½½è·¯å¾„</span></span>
<span class="line"><span>sudo kubectl get pv pvc-9c9e200c-259a-4652-8a35-ab19927447b4  -o yaml | grep path</span></span>
<span class="line"><span># æŸ¥çœ‹æ‰€æœ‰ path</span></span>
<span class="line"><span>sudo kubectl get pv -o yaml | grep path | grep &lt;pvc-name&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-3-ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_8-2-3-ç”Ÿå‘½å‘¨æœŸ"><span>8.2.3 ç”Ÿå‘½å‘¨æœŸ</span></a></h3><h2 id="_8-3-é…ç½®å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#_8-3-é…ç½®å­˜å‚¨"><span>8.3 é…ç½®å­˜å‚¨</span></a></h2><h3 id="_8-3-1-configmap" tabindex="-1"><a class="header-anchor" href="#_8-3-1-configmap"><span>8.3.1 ConfigMap</span></a></h3><p>ConfigMapæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pc-configmap.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: ConfigMap</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: configmap</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>data:</span></span>
<span class="line"><span>  info: |</span></span>
<span class="line"><span>    username:admin</span></span>
<span class="line"><span>    password:123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºconfigmap</span></span>
<span class="line"><span>sudo kubectl create -f pc-configmap.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹configmapè¯¦æƒ…</span></span>
<span class="line"><span>sudo kubectl describe cm configmap -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># pod-configmap.yaml</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-configmap</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    volumeMounts: # å°†configmapæŒ‚è½½åˆ°ç›®å½•</span></span>
<span class="line"><span>    - name: config</span></span>
<span class="line"><span>      mountPath: /configmap/config</span></span>
<span class="line"><span>  volumes: # å¼•ç”¨configmap</span></span>
<span class="line"><span>  - name: config</span></span>
<span class="line"><span>    configMap:</span></span>
<span class="line"><span>      name: configmap</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºpod</span></span>
<span class="line"><span>sudo kubectl create -f pod-configmap.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pod pod-configmap -n dev</span></span>
<span class="line"><span>#è¿›å…¥å®¹å™¨</span></span>
<span class="line"><span>sudo kubectl exec -it pod-configmap -n dev /bin/sh</span></span>
<span class="line"><span>cd /configmap/config/</span></span>
<span class="line"><span>ls</span></span>
<span class="line"><span>cat info</span></span>
<span class="line"><span># info</span></span>
<span class="line"><span>username:admin</span></span>
<span class="line"><span>password:123456</span></span>
<span class="line"><span># å¯ä»¥çœ‹åˆ°æ˜ å°„å·²ç»æˆåŠŸï¼Œæ¯ä¸ªconfigmapéƒ½æ˜ å°„æˆäº†ä¸€ä¸ªç›®å½•</span></span>
<span class="line"><span># key---&gt;æ–‡ä»¶     value----&gt;æ–‡ä»¶ä¸­çš„å†…å®¹</span></span>
<span class="line"><span># æ­¤æ—¶å¦‚æœæ›´æ–°configmapçš„å†…å®¹, å®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-2-secret" tabindex="-1"><a class="header-anchor" href="#_8-3-2-secret"><span>8.3.2 Secret</span></a></h3><p>åœ¨kubernetesä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’ŒConfigMapéå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸ºSecretå¯¹è±¡ã€‚å®ƒä¸»è¦ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ç§˜é’¥ã€è¯ä¹¦ç­‰ç­‰ã€‚</p><ol><li>é¦–å…ˆä½¿ç”¨base64å¯¹æ•°æ®è¿›è¡Œç¼–ç </li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>echo -n &#39;admin&#39; | base64 #å‡†å¤‡username</span></span>
<span class="line"><span># YWRtaW4=</span></span>
<span class="line"><span>echo -n &#39;123456&#39; | base64 #å‡†å¤‡password</span></span>
<span class="line"><span># MTIzNDU2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>æ¥ä¸‹æ¥ç¼–å†™secret.yamlï¼Œå¹¶åˆ›å»ºSecret</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Secret</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: secret</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>type: Opaque</span></span>
<span class="line"><span>data:</span></span>
<span class="line"><span>  username: YWRtaW4=</span></span>
<span class="line"><span>  password: MTIzNDU2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºsecret</span></span>
<span class="line"><span>kubectl create -f secret.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹secretè¯¦æƒ…</span></span>
<span class="line"><span>kubectl describe secret secret -n dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆ›å»ºpod-secret.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„secretæŒ‚è½½è¿›å»ï¼š</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Pod</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: pod-secret</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  containers:</span></span>
<span class="line"><span>  - name: nginx</span></span>
<span class="line"><span>    image: nginx:1.17.1</span></span>
<span class="line"><span>    volumeMounts: # å°†secretæŒ‚è½½åˆ°ç›®å½•</span></span>
<span class="line"><span>    - name: config</span></span>
<span class="line"><span>      mountPath: /secret/config</span></span>
<span class="line"><span>  volumes:</span></span>
<span class="line"><span>  - name: config</span></span>
<span class="line"><span>    secret:</span></span>
<span class="line"><span>      secretName: secret</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºpod</span></span>
<span class="line"><span>kubectl create -f pod-secret.yaml</span></span>
<span class="line"><span># æŸ¥çœ‹pod</span></span>
<span class="line"><span>kubectl get pod pod-secret -n dev</span></span>
<span class="line"><span># è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹secretä¿¡æ¯ï¼Œå‘ç°å·²ç»è‡ªåŠ¨è§£ç äº†</span></span>
<span class="line"><span>kubectl exec -it pod-secret /bin/sh -n dev</span></span>
<span class="line"><span>ls /secret/config/</span></span>
<span class="line"><span># password  username</span></span>
<span class="line"><span>more /secret/config/username</span></span>
<span class="line"><span># admin</span></span>
<span class="line"><span>more /secret/config/password</span></span>
<span class="line"><span># 123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œå·²ç»å®ç°äº†åˆ©ç”¨secretå®ç°äº†ä¿¡æ¯çš„ç¼–ç ã€‚</p><h1 id="_9-å®‰å…¨è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_9-å®‰å…¨è®¤è¯"><span>9. å®‰å…¨è®¤è¯</span></a></h1><h2 id="_9-1-è®¿é—®æ§åˆ¶æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_9-1-è®¿é—®æ§åˆ¶æ¦‚è¿°"><span>9.1 è®¿é—®æ§åˆ¶æ¦‚è¿°</span></a></h2><p>Kubernetesä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹Kubernetesçš„å„ç§<strong>å®¢æˆ·ç«¯</strong>è¿›è¡Œ<strong>è®¤è¯å’Œé‰´æƒ</strong>æ“ä½œã€‚</p><p><strong>å®¢æˆ·ç«¯</strong></p><p>åœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸æœ‰ä¸¤ç±»ï¼š</p><ul><li><p><strong>User Account</strong>ï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äºkubernetesä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·ã€‚</p></li><li><p><strong>Service Account</strong>ï¼škubernetesç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸ºPodä¸­çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®Kubernetesæ—¶æä¾›èº«ä»½æ ‡è¯†ã€‚</p></li></ul><p><strong>è®¤è¯ã€æˆæƒä¸å‡†å…¥æ§åˆ¶</strong></p><p>ApiServeræ˜¯è®¿é—®åŠç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®ApiServerï¼Œéƒ½è¦ç»è¿‡ä¸‹é¢ä¸‰ä¸ªæµç¨‹ï¼š</p><ul><li><p>Authenticationï¼ˆè®¤è¯ï¼‰ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½å¤Ÿé€šè¿‡è®¤è¯</p></li><li><p>Authorizationï¼ˆæˆæƒï¼‰ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ</p></li><li><p>Admission Controlï¼ˆå‡†å…¥æ§åˆ¶ï¼‰ï¼šç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚</p></li></ul><h2 id="_9-2-è¯ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_9-2-è¯ç®¡ç†"><span>9.2 è¯ç®¡ç†</span></a></h2><p>Kubernetesé›†ç¾¤å®‰å…¨çš„æœ€å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†3ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼ï¼š</p><ul><li>HTTP Baseè®¤è¯ï¼šé€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è®¤è¯</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>è¿™ç§è®¤è¯æ–¹å¼æ˜¯æŠŠâ€œç”¨æˆ·å:å¯†ç â€ç”¨BASE64ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨HTTPè¯·æ±‚ä¸­çš„Header AuthorizationåŸŸé‡Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·ååŠå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>HTTP Tokenè®¤è¯ï¼šé€šè¿‡ä¸€ä¸ªTokenæ¥è¯†åˆ«åˆæ³•ç”¨æˆ·</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>è¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²--Tokenæ¥è¡¨æ˜å®¢æˆ·èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ªTokenå¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·APIè°ƒç”¨è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨HTTP Headeré‡Œæ”¾å…¥Tokenï¼ŒAPI Serveræ¥åˆ°Tokenåä¼šè·ŸæœåŠ¡å™¨ä¸­ä¿å­˜çš„tokenè¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>HTTPSè¯ä¹¦è®¤è¯ï¼šåŸºäºCAæ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>è¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>HTTPSè®¤è¯å¤§ä½“åˆ†ä¸º3ä¸ªè¿‡ç¨‹ï¼š</strong></p><ol><li>è¯ä¹¦ç”³è¯·å’Œä¸‹å‘</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>HTTPSé€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘CAæœºæ„ç”³è¯·è¯ä¹¦ï¼ŒCAæœºæ„ä¸‹å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€…</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒå‘è®¤è¯</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>1&gt; å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œ</span></span>
<span class="line"><span>     å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å¾—æœåŠ¡ç«¯çš„å…¬é’¥ï¼Œ</span></span>
<span class="line"><span>     å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨</span></span>
<span class="line"><span>  2&gt; å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œ</span></span>
<span class="line"><span>     åœ¨è¯ä¹¦ä¸­è·å¾—å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§˜é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚</span></span>
<span class="line"><span>  æœåŠ¡å™¨ç«¯æ¥æ”¶è¿™ä¸ªç§˜é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§˜é’¥åŠ å¯†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„: Kuberneteså…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªæ–¹å¼è®¤è¯é€šè¿‡å³å¯</p><h2 id="_9-3-æˆæƒç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_9-3-æˆæƒç®¡ç†"><span>9.3 æˆæƒç®¡ç†</span></a></h2><p>æˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œé€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œ ç„¶åKubernetesä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒã€‚</p><p>æ¯ä¸ªå‘é€åˆ°ApiServerçš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p><p>API Serverç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æˆæƒç­–ç•¥ï¼š</p><ul><li><p><strong>AlwaysDeny</strong>ï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•</p></li><li><p><strong>AlwaysAllow</strong>ï¼šå…è®¸æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆKubernetesé»˜è®¤çš„ç­–ç•¥ï¼‰</p></li><li><p><strong>ABAC</strong>ï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶</p></li><li><p><strong>Webhook</strong>ï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨RESTæœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ</p></li><li><p><strong>Node</strong>ï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹kubeletå‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶</p></li><li><p><strong>RBAC</strong>ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆkubeadmå®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰</p></li></ul><p>RBAC(Role-Based Access Control) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼š<strong>ç»™å“ªäº›å¯¹è±¡æˆäºˆäº†å“ªäº›æƒé™</strong></p><p>å…¶ä¸­æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><p>å¯¹è±¡ï¼šUserã€Groupsã€ServiceAccount</p></li><li><p>è§’è‰²ï¼šä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œåŠ¨ä½œ(æƒé™)çš„é›†åˆ</p></li><li><p>ç»‘å®šï¼šå°†å®šä¹‰å¥½çš„è§’è‰²è·Ÿç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ·</p></li></ul><p>RBACå¼•å…¥äº†4ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š</p><ul><li><p>Roleã€ClusterRoleï¼šè§’è‰²ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™</p></li><li><p>RoleBindingã€ClusterRoleBindingï¼šè§’è‰²ç»‘å®šï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™ï¼‰èµ‹äºˆç»™å¯¹è±¡</p></li></ul><p><strong>Roleã€ClusterRole</strong></p><p>ä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># Roleåªèƒ½å¯¹å‘½åç©ºé—´å†…çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®šnameapce</span></span>
<span class="line"><span>kind: Role</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>  name: authorization-role</span></span>
<span class="line"><span>rules:</span></span>
<span class="line"><span>- apiGroups: [&quot;&quot;]  # æ”¯æŒçš„APIç»„åˆ—è¡¨,&quot;&quot; ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span></span>
<span class="line"><span>  resources: [&quot;pods&quot;] # æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span></span>
<span class="line"><span>  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;] # å…è®¸çš„å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ClusterRoleå¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…èµ„æºã€è·¨namespacesçš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒ</span></span>
<span class="line"><span>kind: ClusterRole</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span> name: authorization-clusterrole</span></span>
<span class="line"><span>rules:</span></span>
<span class="line"><span>- apiGroups: [&quot;&quot;]</span></span>
<span class="line"><span>  resources: [&quot;pods&quot;]</span></span>
<span class="line"><span>  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦è¯¦ç»†è¯´æ˜çš„æ˜¯ï¼Œrulesä¸­çš„å‚æ•°ï¼š</p><ul><li>apiGroups: æ”¯æŒçš„APIç»„åˆ—è¡¨</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&quot;&quot;,&quot;apps&quot;, &quot;autoscaling&quot;, &quot;batch&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>resourcesï¼šæ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&quot;services&quot;, &quot;endpoints&quot;, &quot;pods&quot;,&quot;secrets&quot;,&quot;configmaps&quot;,&quot;crontabs&quot;,&quot;deployments&quot;,&quot;jobs&quot;,</span></span>
<span class="line"><span>&quot;nodes&quot;,&quot;rolebindings&quot;,&quot;clusterroles&quot;,&quot;daemonsets&quot;,&quot;replicasets&quot;,&quot;statefulsets&quot;,</span></span>
<span class="line"><span>&quot;horizontalpodautoscalers&quot;,&quot;replicationcontrollers&quot;,&quot;cronjobs&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>verbsï¼šå¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;exec&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>RoleBindingã€ClusterRoleBinding</strong></p><p>è§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯Userã€Groupæˆ–è€…ServiceAccountã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># RoleBindingå¯ä»¥å°†åŒä¸€namespaceä¸­çš„subjectç»‘å®šåˆ°æŸä¸ªRoleä¸‹ï¼Œåˆ™æ­¤subjectå³å…·æœ‰è¯¥Roleå®šä¹‰çš„æƒé™</span></span>
<span class="line"><span>kind: RoleBinding</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: authorization-role-binding</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>subjects:</span></span>
<span class="line"><span>- kind: User</span></span>
<span class="line"><span>  name: heima</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span>roleRef:</span></span>
<span class="line"><span>  kind: Role</span></span>
<span class="line"><span>  name: authorization-role</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ClusterRoleBindingåœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰namespaceså°†ç‰¹å®šçš„subjectä¸ClusterRoleç»‘å®šï¼Œæˆäºˆæƒé™</span></span>
<span class="line"><span>kind: ClusterRoleBinding</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span> name: authorization-clusterrole-binding</span></span>
<span class="line"><span>subjects:</span></span>
<span class="line"><span>- kind: User</span></span>
<span class="line"><span>  name: heima</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span>roleRef:</span></span>
<span class="line"><span>  kind: ClusterRole</span></span>
<span class="line"><span>  name: authorization-clusterrole</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>RoleBindingå¼•ç”¨ClusterRoleè¿›è¡Œæˆæƒ</strong></p><p>RoleBindingå¯ä»¥å¼•ç”¨ClusterRoleï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…ClusterRoleå®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•å°±æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²ï¼ˆClusterRoleï¼‰ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›ClusterRoleã€‚è¿™æ ·å¯ä»¥å¤§å¹…æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™ä¸ä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># è™½ç„¶authorization-clusterroleæ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†RoleBinding</span></span>
<span class="line"><span># æ‰€ä»¥heimaåªèƒ½è¯»å–devå‘½åç©ºé—´ä¸­çš„èµ„æº</span></span>
<span class="line"><span>kind: RoleBinding</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: authorization-role-binding-ns</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>subjects:</span></span>
<span class="line"><span>- kind: User</span></span>
<span class="line"><span>  name: heima</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span>roleRef:</span></span>
<span class="line"><span>  kind: ClusterRole</span></span>
<span class="line"><span>  name: authorization-clusterrole</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®æˆ˜ï¼šåˆ›å»ºä¸€ä¸ªåªèƒ½ç®¡ç†devç©ºé—´ä¸‹Podsèµ„æºçš„è´¦å·</strong></p><ol><li>åˆ›å»ºè´¦å·</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 1) åˆ›å»ºè¯ä¹¦</span></span>
<span class="line"><span>[root@k8s-master01 pki]# cd /etc/kubernetes/pki/</span></span>
<span class="line"><span>[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 2) ç”¨apiserverçš„è¯ä¹¦å»ç­¾ç½²</span></span>
<span class="line"><span># 2-1) ç­¾åç”³è¯·ï¼Œç”³è¯·çš„ç”¨æˆ·æ˜¯devman,ç»„æ˜¯devgroup</span></span>
<span class="line"><span>[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj &quot;/CN=devman/O=devgroup&quot;     </span></span>
<span class="line"><span># 2-2) ç­¾ç½²è¯ä¹¦</span></span>
<span class="line"><span>[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 3) è®¾ç½®é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ‡æ¢è´¦æˆ·åˆ°devman</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes</span></span>
<span class="line"><span>Switched to context &quot;devman@kubernetes&quot;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹devä¸‹podï¼Œå‘ç°æ²¡æœ‰æƒé™</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl get pods -n dev</span></span>
<span class="line"><span>Error from server (Forbidden): pods is forbidden: User &quot;devman&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;dev&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ‡æ¢åˆ°adminè´¦æˆ·</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes</span></span>
<span class="line"><span>Switched to context &quot;kubernetes-admin@kubernetes&quot;.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ åˆ›å»ºRoleå’ŒRoleBindingï¼Œä¸ºdevmanç”¨æˆ·æˆæƒ</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kind: Role</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>  name: dev-role</span></span>
<span class="line"><span>rules:</span></span>
<span class="line"><span>- apiGroups: [&quot;&quot;]</span></span>
<span class="line"><span>  resources: [&quot;pods&quot;]</span></span>
<span class="line"><span>  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>kind: RoleBinding</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: authorization-role-binding</span></span>
<span class="line"><span>  namespace: dev</span></span>
<span class="line"><span>subjects:</span></span>
<span class="line"><span>- kind: User</span></span>
<span class="line"><span>  name: devman</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span>roleRef:</span></span>
<span class="line"><span>  kind: Role</span></span>
<span class="line"><span>  name: dev-role</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[root@k8s-master01 pki]# kubectl create -f dev-role.yaml</span></span>
<span class="line"><span>role.rbac.authorization.k8s.io/dev-role created</span></span>
<span class="line"><span>rolebinding.rbac.authorization.k8s.io/authorization-role-binding created</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆ‡æ¢è´¦æˆ·ï¼Œå†æ¬¡éªŒè¯</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ‡æ¢è´¦æˆ·åˆ°devman</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes</span></span>
<span class="line"><span>Switched to context &quot;devman@kubernetes&quot;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å†æ¬¡æŸ¥çœ‹</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl get pods -n dev</span></span>
<span class="line"><span>NAME                                 READY   STATUS             RESTARTS   AGE</span></span>
<span class="line"><span>nginx-deployment-66cb59b984-8wp2k    1/1     Running            0          4d1h</span></span>
<span class="line"><span>nginx-deployment-66cb59b984-dc46j    1/1     Running            0          4d1h</span></span>
<span class="line"><span>nginx-deployment-66cb59b984-thfck    1/1     Running            0          4d1h</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ä¸ºäº†ä¸å½±å“åé¢çš„å­¦ä¹ ,åˆ‡å›adminè´¦æˆ·</span></span>
<span class="line"><span>[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes</span></span>
<span class="line"><span>Switched to context &quot;kubernetes-admin@kubernetes&quot;.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-4-å‡†å…¥æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_9-4-å‡†å…¥æ§åˆ¶"><span>9.4 å‡†å…¥æ§åˆ¶</span></a></h2><p>é€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶å¤„ç†é€šè¿‡ä¹‹åï¼Œapiserveræ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p><p>å‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨Api-Serverä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›å‡†å…¥æ§åˆ¶å™¨ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,</span></span>
<span class="line"><span>                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åªæœ‰å½“æ‰€æœ‰çš„å‡†å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œapiserveræ‰æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚</p><p>å½“å‰å¯é…ç½®çš„Admission Controlå‡†å…¥æ§åˆ¶å¦‚ä¸‹ï¼š</p><ul><li><p>AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚</p></li><li><p>AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•</p></li><li><p>AlwaysPullImagesï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ</p></li><li><p>DenyExecOnPrivilegedï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨Privileged Containerä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚</p></li><li><p>ImagePolicyWebhookï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ªWebhookç¨‹åºæ¥å®Œæˆadmission controllerçš„åŠŸèƒ½ã€‚</p></li><li><p>Service Accountï¼šå®ç°ServiceAccountå®ç°äº†è‡ªåŠ¨åŒ–</p></li><li><p>SecurityContextDenyï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨SecurityContextçš„Podä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ</p></li><li><p>ResourceQuotaï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨namespaceä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡</p></li><li><p>LimitRangerï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äºnamespaceä¸Šï¼Œç¡®ä¿å¯¹Podè¿›è¡Œèµ„æºé™åˆ¶</p></li><li><p>InitialResourcesï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„Podï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½®</p></li><li><p>NamespaceLifecycleï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ç»ã€‚å½“åˆ é™¤ä¸€ä¸ªnamespaceæ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥namespaceä¸­æ‰€æœ‰å¯¹è±¡ã€‚</p></li><li><p>DefaultStorageClassï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®šStorageClassæˆ–PVçš„PVCå°è¯•åŒ¹é…é»˜è®¤çš„StorageClassï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·PVCæ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚</p></li><li><p>DefaultTolerationSecondsï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®forgiveness<br> tolerationså¹¶å…·æœ‰notready:NoExecuteå’Œunreachable:NoExecuteä¸¤ç§taintsçš„Podè®¾ç½®é»˜è®¤çš„â€œå®¹å¿â€æ—¶é—´ï¼Œä¸º5min</p></li><li><p>PodSecurityPolicyï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®Podçš„security contextå’Œå¯ç”¨çš„PodSecurityPolicyå¯¹Podçš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶</p></li></ul><h1 id="_10-dashboard" tabindex="-1"><a class="header-anchor" href="#_10-dashboard"><span>10. DashBoard</span></a></h1><p>ä¹‹å‰åœ¨kubernetesä¸­å®Œæˆçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œå·¥å…·kubectlå®Œæˆçš„ã€‚å…¶å®ï¼Œä¸ºäº†æä¾›æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒï¼Œkubernetesè¿˜å¼€å‘äº†ä¸€ä¸ªåŸºäºwebçš„ç”¨æˆ·ç•Œé¢ï¼ˆDashboardï¼‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Dashboardéƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„çŠ¶æ€ï¼Œæ‰§è¡Œæ•…éšœæ’æŸ¥ä»¥åŠç®¡ç†kubernetesä¸­å„ç§èµ„æºã€‚</p><h2 id="_10-1-éƒ¨ç½²dashboard" tabindex="-1"><a class="header-anchor" href="#_10-1-éƒ¨ç½²dashboard"><span>10.1 éƒ¨ç½²Dashboard</span></a></h2><ol><li>ä¸‹è½½yamlï¼Œå¹¶è¿è¡ŒDashboard</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># ä¸‹è½½yaml</span></span>
<span class="line"><span>[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ä¿®æ”¹kubernetes-dashboardçš„Serviceç±»å‹</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  labels:</span></span>
<span class="line"><span>    k8s-app: kubernetes-dashboard</span></span>
<span class="line"><span>  name: kubernetes-dashboard</span></span>
<span class="line"><span>  namespace: kubernetes-dashboard</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  type: NodePort  # æ–°å¢</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>    - port: 443</span></span>
<span class="line"><span>      targetPort: 8443</span></span>
<span class="line"><span>      nodePort: 30009  # æ–°å¢</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    k8s-app: kubernetes-dashboard</span></span>
<span class="line"><span></span></span>
<span class="line"><span># éƒ¨ç½²</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl create -f recommended.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹namespaceä¸‹çš„kubernetes-dashboardä¸‹çš„èµ„æº</span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard</span></span>
<span class="line"><span>NAME                                            READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>pod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     Running   0          111s</span></span>
<span class="line"><span>pod/kubernetes-dashboard-56484d4c5-z95z5        1/1     Running   0          111s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE</span></span>
<span class="line"><span>service/dashboard-metrics-scraper  ClusterIP  10.96.89.218    &lt;none&gt;       8000/TCP        111s</span></span>
<span class="line"><span>service/kubernetes-dashboard       NodePort   10.104.178.171  &lt;none&gt;       443:30009/TCP   111s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰åˆ›å»ºè®¿é—®è´¦æˆ·ï¼Œè·å–token</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># åˆ›å»ºè´¦å·</span></span>
<span class="line"><span>[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æˆæƒ</span></span>
<span class="line"><span>[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin</span></span>
<span class="line"><span></span></span>
<span class="line"><span># è·å–è´¦å·token</span></span>
<span class="line"><span>[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin</span></span>
<span class="line"><span>dashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard</span></span>
<span class="line"><span>Name:         dashboard-admin-token-xbqhh</span></span>
<span class="line"><span>Namespace:    kubernetes-dashboard</span></span>
<span class="line"><span>Labels:       &lt;none&gt;</span></span>
<span class="line"><span>Annotations:  kubernetes.io/service-account.name: dashboard-admin</span></span>
<span class="line"><span>              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Type:  kubernetes.io/service-account-token</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Data</span></span>
<span class="line"><span>====</span></span>
<span class="line"><span>namespace:  20 bytes</span></span>
<span class="line"><span>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw</span></span>
<span class="line"><span>ca.crt:     1025 bytes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰é€šè¿‡æµè§ˆå™¨è®¿é—®Dashboardçš„UI</p><p>åœ¨ç™»å½•é¡µé¢ä¸Šè¾“å…¥ä¸Šé¢çš„token</p><p>å‡ºç°ä¸‹é¢çš„é¡µé¢ä»£è¡¨æˆåŠŸ</p><h2 id="_10-2-ä½¿ç”¨dashboard" tabindex="-1"><a class="header-anchor" href="#_10-2-ä½¿ç”¨dashboard"><span>10.2 ä½¿ç”¨DashBoard</span></a></h2><p>æœ¬ç« èŠ‚ä»¥Deploymentä¸ºä¾‹æ¼”ç¤ºDashBoardçš„ä½¿ç”¨</p><p><strong>æŸ¥çœ‹</strong></p><p>é€‰æ‹©æŒ‡å®šçš„å‘½åç©ºé—´devï¼Œç„¶åç‚¹å‡»Deploymentsï¼ŒæŸ¥çœ‹devç©ºé—´ä¸‹çš„æ‰€æœ‰deployment</p><p><strong>æ‰©ç¼©å®¹</strong><br> åœ¨Deploymentä¸Šç‚¹å‡»è§„æ¨¡ï¼Œç„¶åæŒ‡å®šç›®æ ‡å‰¯æœ¬æ•°é‡ï¼Œç‚¹å‡»ç¡®å®š</p><p><strong>ç¼–è¾‘</strong><br> åœ¨Deploymentä¸Šç‚¹å‡»ç¼–è¾‘ï¼Œç„¶åä¿®æ”¹yamlæ–‡ä»¶ï¼Œç‚¹å‡»ç¡®å®š</p><p><strong>æŸ¥çœ‹Pod</strong><br> ç‚¹å‡»Pods, æŸ¥çœ‹podsåˆ—è¡¨</p><p><strong>æ“ä½œPod</strong><br> é€‰ä¸­æŸä¸ªPodï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œæ—¥å¿—ï¼ˆlogsï¼‰ã€è¿›å…¥æ‰§è¡Œï¼ˆexecï¼‰ã€ç¼–è¾‘ã€åˆ é™¤æ“ä½œ</p><p>Dashboardæä¾›äº†kubectlçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/justdoitMr/blogs//edit/master/themeHope/ContainerCloud/k8s/act_two_k8såŸºç¡€å­¦ä¹ .md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2284609302@qq.com">ä¸çˆ±æ‰“ä»£ç çš„ç¨‹åºå‘˜</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/ContainerCloud/k8s/act_none_pod%E5%BC%82%E5%B8%B8%E7%8A%B6%E6%80%81%E6%8E%92%E6%9F%A5.html" aria-label="2ã€Podå¼‚å¸¸çŠ¶æ€æ’é”™"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-file" style=""></span>2ã€Podå¼‚å¸¸çŠ¶æ€æ’é”™</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">äº‘åŸç”Ÿ</div><div class="vp-copyright">bugcode</div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.5e82dcee.js" defer></script><script src="/assets/js/9547.c8ff98a9.js" defer></script><script src="/assets/js/app.318c5c67.js" defer></script>
  </body>
</html>
